"use strict";(()=>{var il=Object.create;var Do=Object.defineProperty;var nl=Object.getOwnPropertyDescriptor;var rl=Object.getOwnPropertyNames;var ol=Object.getPrototypeOf,sl=Object.prototype.hasOwnProperty;var ko=(n,t)=>(t=Symbol[n])?t:Symbol.for("Symbol."+n),un=n=>{throw TypeError(n)};var Se=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var al=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of rl(t))!sl.call(n,r)&&r!==e&&Do(n,r,{get:()=>t[r],enumerable:!(i=nl(t,r))||i.enumerable});return n};var Pt=(n,t,e)=>(e=n!=null?il(ol(n)):{},al(t||!n||!n.__esModule?Do(e,"default",{value:n,enumerable:!0}):e,n));var No=(n,t,e)=>t.has(n)||un("Cannot "+e);var Bo=(n,t,e)=>(No(n,t,"read from private field"),e?e.call(n):t.get(n)),_o=(n,t,e)=>t.has(n)?un("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),Vo=(n,t,e,i)=>(No(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);var ze=(n,t,e)=>{if(t!=null){typeof t!="object"&&typeof t!="function"&&un("Object expected");var i,r;e&&(i=t[ko("asyncDispose")]),i===void 0&&(i=t[ko("dispose")],e&&(r=i)),typeof i!="function"&&un("Object not disposable"),r&&(i=function(){try{r.call(this)}catch(o){return Promise.reject(o)}}),n.push([e,i,t])}else e&&n.push([e]);return t},We=(n,t,e)=>{var i=typeof SuppressedError=="function"?SuppressedError:function(s,a,l,h){return h=Error(l),h.name="SuppressedError",h.error=s,h.suppressed=a,h},r=s=>t=e?new i(s,t,"An error was suppressed during disposal"):(e=!0,s),o=s=>{for(;s=n.pop();)try{var a=s[1]&&s[1].call(s[2]);if(s[0])return Promise.resolve(a).then(o,l=>(r(l),o()))}catch(l){r(l)}if(e)throw t};return o()};var Wo=Se((pc,zo)=>{"use strict";function Fe(n){if(typeof n!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=n}typeof Symbol<"u"&&(Fe.prototype[Symbol.iterator]=function(){return this});Fe.of=function(){var n=arguments,t=n.length,e=0;return new Fe(function(){return e>=t?{done:!0}:{done:!1,value:n[e++]}})};Fe.empty=function(){var n=new Fe(function(){return{done:!0}});return n};Fe.fromSequence=function(n){var t=0,e=n.length;return new Fe(function(){return t>=e?{done:!0}:{done:!1,value:n[t++]}})};Fe.is=function(n){return n instanceof Fe?!0:typeof n=="object"&&n!==null&&typeof n.next=="function"};zo.exports=Fe});var Fo=Se(ur=>{"use strict";ur.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";ur.SYMBOL_SUPPORT=typeof Symbol<"u"});var cn=Se((mc,Yo)=>{"use strict";var Ho=Fo(),hl=Ho.ARRAY_BUFFER_SUPPORT,ul=Ho.SYMBOL_SUPPORT;Yo.exports=function(t,e){var i,r,o,s,a;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof e!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||hl&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(o=0,s=t.length;o<s;o++)e(t[o],o);return}if(typeof t.forEach=="function"){t.forEach(e);return}if(ul&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(i=t,o=0;a=i.next(),a.done!==!0;)e(a.value,o),o++;return}for(r in t)t.hasOwnProperty(r)&&e(t[r],r)}});var dn=Se(He=>{"use strict";var cl=Math.pow(2,8)-1,dl=Math.pow(2,16)-1,pl=Math.pow(2,32)-1,fl=Math.pow(2,7)-1,ml=Math.pow(2,15)-1,yl=Math.pow(2,31)-1;He.getPointerArray=function(n){var t=n-1;if(t<=cl)return Uint8Array;if(t<=dl)return Uint16Array;if(t<=pl)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")};He.getSignedPointerArray=function(n){var t=n-1;return t<=fl?Int8Array:t<=ml?Int16Array:t<=yl?Int32Array:Float64Array};He.getNumberType=function(n){return n===(n|0)?Math.sign(n)===-1?n<=127&&n>=-128?Int8Array:n<=32767&&n>=-32768?Int16Array:Int32Array:n<=255?Uint8Array:n<=65535?Uint16Array:Uint32Array:Float64Array};var gl={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};He.getMinimalRepresentation=function(n,t){var e=null,i=0,r,o,s,a,l;for(a=0,l=n.length;a<l;a++)s=t?t(n[a]):n[a],o=He.getNumberType(s),r=gl[o.name],r>i&&(i=r,e=o);return e};He.isTypedArray=function(n){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(n)};He.concat=function(){var n=0,t,e,i;for(t=0,i=arguments.length;t<i;t++)n+=arguments[t].length;var r=new arguments[0].constructor(n);for(t=0,e=0;t<i;t++)r.set(arguments[t],e),e+=arguments[t].length;return r};He.indices=function(n){for(var t=He.getPointerArray(n),e=new t(n),i=0;i<n;i++)e[i]=i;return e}});var dr=Se(jt=>{"use strict";var qo=cn(),Go=dn();function bl(n){return Array.isArray(n)||Go.isTypedArray(n)}function cr(n){if(typeof n.length=="number")return n.length;if(typeof n.size=="number")return n.size}function vl(n){var t=cr(n),e=typeof t=="number"?new Array(t):[],i=0;return qo(n,function(r){e[i++]=r}),e}function Cl(n){var t=cr(n),e=typeof t=="number"?Go.getPointerArray(t):Array,i=typeof t=="number"?new Array(t):[],r=typeof t=="number"?new e(t):[],o=0;return qo(n,function(s){i[o]=s,r[o]=o++}),[i,r]}jt.isArrayLike=bl;jt.guessLength=cr;jt.toArray=vl;jt.toArrayWithIndices=Cl});var Ko=Se((bc,Xo)=>{"use strict";var pr=Wo(),Tl=cn(),xl=dn(),Sl=dr();function K(n,t,e){if(arguments.length<2&&(e=n,n=null,t=null),this.capacity=e,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var i=xl.getPointerArray(e);this.forward=new i(e),this.backward=new i(e),this.K=typeof n=="function"?new n(e):new Array(e),this.V=typeof t=="function"?new t(e):new Array(e),this.size=0,this.head=0,this.tail=0,this.items={}}K.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}};K.prototype.splayOnTop=function(n){var t=this.head;if(this.head===n)return this;var e=this.backward[n],i=this.forward[n];return this.tail===n?this.tail=e:this.backward[i]=e,this.forward[e]=i,this.backward[t]=n,this.head=n,this.forward[n]=t,this};K.prototype.set=function(n,t){var e=this.items[n];if(typeof e<"u"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?e=this.size++:(e=this.tail,this.tail=this.backward[e],delete this.items[this.K[e]]),this.items[n]=e,this.K[e]=n,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};K.prototype.setpop=function(n,t){var e=null,i=null,r=this.items[n];return typeof r<"u"?(this.splayOnTop(r),e=this.V[r],this.V[r]=t,{evicted:!1,key:n,value:e}):(this.size<this.capacity?r=this.size++:(r=this.tail,this.tail=this.backward[r],e=this.V[r],i=this.K[r],delete this.items[i]),this.items[n]=r,this.K[r]=n,this.V[r]=t,this.forward[r]=this.head,this.backward[this.head]=r,this.head=r,i?{evicted:!0,key:i,value:e}:null)};K.prototype.has=function(n){return n in this.items};K.prototype.get=function(n){var t=this.items[n];if(!(typeof t>"u"))return this.splayOnTop(t),this.V[t]};K.prototype.peek=function(n){var t=this.items[n];if(!(typeof t>"u"))return this.V[t]};K.prototype.forEach=function(n,t){t=arguments.length>1?t:this;for(var e=0,i=this.size,r=this.head,o=this.K,s=this.V,a=this.forward;e<i;)n.call(t,s[r],o[r],this),r=a[r],e++};K.prototype.keys=function(){var n=0,t=this.size,e=this.head,i=this.K,r=this.forward;return new pr(function(){if(n>=t)return{done:!0};var o=i[e];return n++,n<t&&(e=r[e]),{done:!1,value:o}})};K.prototype.values=function(){var n=0,t=this.size,e=this.head,i=this.V,r=this.forward;return new pr(function(){if(n>=t)return{done:!0};var o=i[e];return n++,n<t&&(e=r[e]),{done:!1,value:o}})};K.prototype.entries=function(){var n=0,t=this.size,e=this.head,i=this.K,r=this.V,o=this.forward;return new pr(function(){if(n>=t)return{done:!0};var s=i[e],a=r[e];return n++,n<t&&(e=o[e]),{done:!1,value:[s,a]}})};typeof Symbol<"u"&&(K.prototype[Symbol.iterator]=K.prototype.entries);K.prototype.inspect=function(){for(var n=new Map,t=this.entries(),e;e=t.next(),!e.done;)n.set(e.value[0],e.value[1]);return Object.defineProperty(n,"constructor",{value:K,enumerable:!1}),n};typeof Symbol<"u"&&(K.prototype[Symbol.for("nodejs.util.inspect.custom")]=K.prototype.inspect);K.from=function(n,t,e,i){if(arguments.length<2){if(i=Sl.guessLength(n),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var r=new K(t,e,i);return Tl(n,function(o,s){r.set(s,o)}),r};Xo.exports=K});var $o=Se((vc,jo)=>{"use strict";var Ot=Ko(),wl=cn(),El=dn(),Al=dr();function ae(n,t,e){if(arguments.length<2&&(e=n,n=null,t=null),this.capacity=e,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-map: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-map: capacity should be a finite positive integer.");var i=El.getPointerArray(e);this.forward=new i(e),this.backward=new i(e),this.K=typeof n=="function"?new n(e):new Array(e),this.V=typeof t=="function"?new t(e):new Array(e),this.size=0,this.head=0,this.tail=0,this.items=new Map}ae.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items.clear()};ae.prototype.set=function(n,t){var e=this.items.get(n);if(typeof e<"u"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?e=this.size++:(e=this.tail,this.tail=this.backward[e],this.items.delete(this.K[e])),this.items.set(n,e),this.K[e]=n,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};ae.prototype.setpop=function(n,t){var e=null,i=null,r=this.items.get(n);return typeof r<"u"?(this.splayOnTop(r),e=this.V[r],this.V[r]=t,{evicted:!1,key:n,value:e}):(this.size<this.capacity?r=this.size++:(r=this.tail,this.tail=this.backward[r],e=this.V[r],i=this.K[r],this.items.delete(i)),this.items.set(n,r),this.K[r]=n,this.V[r]=t,this.forward[r]=this.head,this.backward[this.head]=r,this.head=r,i?{evicted:!0,key:i,value:e}:null)};ae.prototype.has=function(n){return this.items.has(n)};ae.prototype.get=function(n){var t=this.items.get(n);if(!(typeof t>"u"))return this.splayOnTop(t),this.V[t]};ae.prototype.peek=function(n){var t=this.items.get(n);if(!(typeof t>"u"))return this.V[t]};ae.prototype.splayOnTop=Ot.prototype.splayOnTop;ae.prototype.forEach=Ot.prototype.forEach;ae.prototype.keys=Ot.prototype.keys;ae.prototype.values=Ot.prototype.values;ae.prototype.entries=Ot.prototype.entries;typeof Symbol<"u"&&(ae.prototype[Symbol.iterator]=ae.prototype.entries);ae.prototype.inspect=Ot.prototype.inspect;ae.from=function(n,t,e,i){if(arguments.length<2){if(i=Al.guessLength(n),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var r=new ae(t,e,i);return wl(n,function(o,s){r.set(s,o)}),r};jo.exports=ae});var Os=Se((Ps,Ei)=>{"use strict";(function(){var n,t,e,i,r,o;typeof performance<"u"&&performance!==null&&performance.now?Ei.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(Ei.exports=function(){return(n()-r)/1e6},t=process.hrtime,n=function(){var s;return s=t(),s[0]*1e9+s[1]},i=n(),o=process.uptime()*1e9,r=i-o):Date.now?(Ei.exports=function(){return Date.now()-e},e=Date.now()):(Ei.exports=function(){return new Date().getTime()-e},e=new Date().getTime())}).call(Ps)});var ks=Se((vp,bn)=>{"use strict";var ph=Os(),Ze=typeof window>"u"?global:window,yn=["moz","webkit"],Bt="AnimationFrame",_t=Ze["request"+Bt],Ai=Ze["cancel"+Bt]||Ze["cancelRequest"+Bt];for(Nt=0;!_t&&Nt<yn.length;Nt++)_t=Ze[yn[Nt]+"Request"+Bt],Ai=Ze[yn[Nt]+"Cancel"+Bt]||Ze[yn[Nt]+"CancelRequest"+Bt];var Nt;(!_t||!Ai)&&(gn=0,Mr=0,lt=[],Ls=1e3/60,_t=function(n){if(lt.length===0){var t=ph(),e=Math.max(0,Ls-(t-gn));gn=e+t,setTimeout(function(){var i=lt.slice(0);lt.length=0;for(var r=0;r<i.length;r++)if(!i[r].cancelled)try{i[r].callback(gn)}catch(o){setTimeout(function(){throw o},0)}},Math.round(e))}return lt.push({handle:++Mr,callback:n,cancelled:!1}),Mr},Ai=function(n){for(var t=0;t<lt.length;t++)lt[t].handle===n&&(lt[t].cancelled=!0)});var gn,Mr,lt,Ls;bn.exports=function(n){return _t.call(Ze,n)};bn.exports.cancel=function(){Ai.apply(Ze,arguments)};bn.exports.polyfill=function(n){n||(n=Ze),n.requestAnimationFrame=_t,n.cancelAnimationFrame=Ai}});var Ns=Se((Cp,Ds)=>{"use strict";Ds.exports=function(n){this.ok=!1,this.alpha=1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n=n.replace(/ /g,""),n=n.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};n=t[n]||n;for(var e=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3]),parseFloat(l[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],i=0;i<e.length;i++){var r=e[i].re,o=e[i].process,s=r.exec(n);if(s){var a=o(s);this.r=a[0],this.g=a[1],this.b=a[2],a.length>3&&(this.alpha=a[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var l=this.r.toString(16),h=this.g.toString(16),u=this.b.toString(16);return l.length==1&&(l="0"+l),h.length==1&&(h="0"+h),u.length==1&&(u="0"+u),"#"+l+h+u},this.getHelpXML=function(){for(var l=new Array,h=0;h<e.length;h++)for(var u=e[h].example,c=0;c<u.length;c++)l[l.length]=u[c];for(var p in t)l[l.length]=p;var d=document.createElement("ul");d.setAttribute("id","rgbcolor-examples");for(var h=0;h<l.length;h++)try{var f=document.createElement("li"),m=new RGBColor(l[h]),g=document.createElement("div");g.style.cssText="margin: 3px; border: 1px solid black; background:"+m.toHex()+"; color:"+m.toHex(),g.appendChild(document.createTextNode("test"));var y=document.createTextNode(" "+l[h]+" -> "+m.toRGB()+" -> "+m.toHex());f.appendChild(g),f.appendChild(y),d.appendChild(f)}catch{}return d}}});var pa=Se((Vn,da)=>{"use strict";(function(n,t){typeof Vn=="object"&&typeof da<"u"?t(Vn):typeof define=="function"&&define.amd?define(["exports"],t):t((n=n||self).lru_map=n.lru_map||{})})(Vn,function(n){let t=Symbol("newer"),e=Symbol("older");class i{constructor(h,u){typeof h!="number"&&(u=h,h=0),this.size=0,this.limit=h,this.oldest=this.newest=void 0,this._keymap=new Map,u&&(this.assign(u),h<1&&(this.limit=this.size))}_markEntryAsUsed(h){h!==this.newest&&(h[t]&&(h===this.oldest&&(this.oldest=h[t]),h[t][e]=h[e]),h[e]&&(h[e][t]=h[t]),h[t]=void 0,h[e]=this.newest,this.newest&&(this.newest[t]=h),this.newest=h)}assign(h){let u,c=this.limit||Number.MAX_VALUE;this._keymap.clear();let p=h[Symbol.iterator]();for(let d=p.next();!d.done;d=p.next()){let f=new r(d.value[0],d.value[1]);if(this._keymap.set(f.key,f),u?(u[t]=f,f[e]=u):this.oldest=f,u=f,c--==0)throw new Error("overflow")}this.newest=u,this.size=this._keymap.size}get(h){var u=this._keymap.get(h);return u?(this._markEntryAsUsed(u),u.value):void 0}set(h,u){var c=this._keymap.get(h);return c?(c.value=u,this._markEntryAsUsed(c),this):(this._keymap.set(h,c=new r(h,u)),this.newest?(this.newest[t]=c,c[e]=this.newest):this.oldest=c,this.newest=c,++this.size,this.size>this.limit&&this.shift(),this)}shift(){var h=this.oldest;if(h)return this.oldest[t]?(this.oldest=this.oldest[t],this.oldest[e]=void 0):(this.oldest=void 0,this.newest=void 0),h[t]=h[e]=void 0,this._keymap.delete(h.key),--this.size,[h.key,h.value]}find(h){let u=this._keymap.get(h);return u?u.value:void 0}has(h){return this._keymap.has(h)}delete(h){var u=this._keymap.get(h);return u?(this._keymap.delete(u.key),u[t]&&u[e]?(u[e][t]=u[t],u[t][e]=u[e]):u[t]?(u[t][e]=void 0,this.oldest=u[t]):u[e]?(u[e][t]=void 0,this.newest=u[e]):this.oldest=this.newest=void 0,this.size--,u.value):void 0}clear(){this.oldest=this.newest=void 0,this.size=0,this._keymap.clear()}keys(){return new s(this.oldest)}values(){return new a(this.oldest)}entries(){return this}[Symbol.iterator](){return new o(this.oldest)}forEach(h,u){typeof u!="object"&&(u=this);let c=this.oldest;for(;c;)h.call(u,c.value,c.key,this),c=c[t]}toJSON(){for(var h=new Array(this.size),u=0,c=this.oldest;c;)h[u++]={key:c.key,value:c.value},c=c[t];return h}toString(){for(var h="",u=this.oldest;u;)h+=String(u.key)+":"+u.value,u=u[t],u&&(h+=" < ");return h}}n.LRUMap=i;function r(l,h){this.key=l,this.value=h,this[t]=void 0,this[e]=void 0}function o(l){this.entry=l}o.prototype[Symbol.iterator]=function(){return this},o.prototype.next=function(){let l=this.entry;return l?(this.entry=l[t],{done:!1,value:[l.key,l.value]}):{done:!0,value:void 0}};function s(l){this.entry=l}s.prototype[Symbol.iterator]=function(){return this},s.prototype.next=function(){let l=this.entry;return l?(this.entry=l[t],{done:!1,value:l.key}):{done:!0,value:void 0}};function a(l){this.entry=l}a.prototype[Symbol.iterator]=function(){return this},a.prototype.next=function(){let l=this.entry;return l?(this.entry=l[t],{done:!1,value:l.value}):{done:!0,value:void 0}}})});var yo=Se((l0,fo)=>{"use strict";var mo=(n,t)=>Array(t).fill(0).map((e,i)=>n(i)),Zh=(n,t)=>mo(e=>n.slice(e*t,e*t+t),Math.ceil(n.length/t)),Jh=(n,t)=>n.reduce((e,i,r)=>e+i*t[r],0),O=(n,t)=>!n&&!t?{x:0,y:0}:typeof n=="object"&&"x"in n&&"y"in n?{x:n.x||0,y:n.y||0}:{x:n,y:t??n};O.components=n=>[n.x,n.y];O.fromComponents=n=>O(...n.slice(0,2));O.ux=()=>O(1,0);O.uy=()=>O(0,1);O.add=(n,t)=>({x:n.x+(t.x??t),y:n.y+(t.y??t)});O.sub=(n,t)=>({x:n.x-(t.x??t),y:n.y-(t.y??t)});O.mul=(n,t)=>({x:n.x*(t.x??t),y:n.y*(t.y??t)});O.scale=(n,t)=>O.mul(n,t);O.div=(n,t)=>({x:n.x/(t.x??t),y:n.y/(t.y??t)});O.len=n=>Math.sqrt(n.x*n.x+n.y*n.y);O.manhattan=n=>Math.abs(n.x)+Math.abs(n.y);O.nor=n=>{let t=O.len(n);return t?{x:n.x/t,y:n.y/t}:O()};O.dot=(n,t)=>n.x*t.x+n.y*t.y;O.rot=(n,t)=>{let e=Math.sin(t),i=Math.cos(t);return{x:i*n.x-e*n.y,y:e*n.x+i*n.y}};O.rotf=(n,t)=>{switch(t){case 1:return O(n.y,-n.x);case-1:return O(-n.y,n.x);case 2:case-2:return O(-n.x,-n.y);default:return n}};O.cross=(n,t)=>n.x*t.y-n.y*t.x;O.eq=(n,t)=>n.x===t.x&&n.y===t.y;O.rad=n=>Math.atan2(n.y,n.x);O.cpy=n=>O(n);O.map=(n,t)=>({x:t(n.x,"x"),y:t(n.y,"y")});O.str=(n,t=", ")=>`${n.x}${t}${n.y}`;O.swiz=(n,t="..")=>{let e=[];return t.split("").forEach((i,r)=>{switch(i){case"x":case"u":e.push(n.x);break;case"y":case"v":e.push(n.y);break;case"X":case"U":e.push(-n.x);break;case"Y":case"V":e.push(-n.y);break;case"0":e.push(0);break;case"1":e.push(1);break;case".":e.push([n.x,n.y][r]??0);break;default:e.push(0)}}),e};O.polar=n=>({r:O.len(n),theta:Math.atan2(n.y,n.x)});O.fromPolar=(n,t)=>O(n*Math.cos(t),n*Math.sin(t));var x=(n,t,e)=>!n&&!t&&!e?{x:0,y:0,z:0}:typeof n=="object"&&"x"in n&&"y"in n&&"z"in n?{x:n.x||0,y:n.y||0,z:n.z||0}:typeof n=="object"&&!("z"in n)?{x:n.x||0,y:n.y||0,z:t||0}:{x:n,y:t??n,z:e??n};x.components=n=>[n.x,n.y,n.z];x.fromComponents=n=>x(...n.slice(0,3));x.ux=()=>x(1,0,0);x.uy=()=>x(0,1,0);x.uz=()=>x(0,0,1);x.add=(n,t)=>({x:n.x+(t.x??t),y:n.y+(t.y??t),z:n.z+(t.z??t)});x.sub=(n,t)=>({x:n.x-(t.x??t),y:n.y-(t.y??t),z:n.z-(t.z??t)});x.mul=(n,t)=>({x:n.x*(t.x??t),y:n.y*(t.y??t),z:n.z*(t.z??t)});x.scale=(n,t)=>x.mul(n,t);x.div=(n,t)=>({x:n.x/(t.x??t),y:n.y/(t.y??t),z:n.z/(t.z??t)});x.len=n=>Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);x.manhattan=n=>Math.abs(n.x)+Math.abs(n.y)+Math.abs(n.z);x.nor=n=>{let t=x.len(n);return t?{x:n.x/t,y:n.y/t,z:n.z/t}:x()};x.dot=(n,t)=>n.x*t.x+n.y*t.y+n.z*t.z;x.rot=(n,t)=>x(x.dot(x.fromComponents(E.row(t,1)),n),x.dot(x.fromComponents(E.row(t,2)),n),x.dot(x.fromComponents(E.row(t,3)),n));x.rotx=(n,t)=>x(n.x,n.y*Math.cos(t)-n.z*Math.sin(t),n.y*Math.sin(t)+n.z*Math.cos(t));x.roty=(n,t)=>x(n.x*Math.cos(t)+n.z*Math.sin(t),n.y,-n.x*Math.sin(t)+n.z*Math.cos(t));x.rotz=(n,t)=>x(n.x*Math.cos(t)-n.y*Math.sin(t),n.x*Math.sin(t)+n.y*Math.cos(t),n.z);x.rotq=(n,t)=>{if(t.length!==4)return x();let e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]);if(e===0)return x();let i=[t[0]/e,t[1]/e,t[2]/e,t[3]/e],r=x(...i.slice(0,3)),o=i[3];return x.add(x.add(x.mul(r,2*x.dot(r,n)),x.mul(n,o*o-x.dot(r,r))),x.mul(x.cross(r,n),2*o))};x.rota=(n,t)=>x.rotz(x.roty(x.rotx(n,t.x),t.y),t.z);x.cross=(n,t)=>x(n.y*t.z-n.z*t.y,n.z*t.x-n.x*t.z,n.x*t.y-n.y*t.x);x.eq=(n,t)=>n.x===t.x&&n.y===t.y&&n.z===t.z;x.radx=n=>Math.atan2(n.z,n.y);x.rady=n=>Math.atan2(n.x,n.y);x.radz=n=>Math.atan2(n.y,n.z);x.cpy=n=>x(n);x.map=(n,t)=>({x:t(n.x,"x"),y:t(n.y,"y"),z:t(n.z,"z")});x.str=(n,t=", ")=>`${n.x}${t}${n.y}${t}${n.z}`;x.swiz=(n,t="...")=>{let e=[];return t.split("").forEach((i,r)=>{switch(i){case"x":case"u":case"r":e.push(n.x);break;case"y":case"v":case"g":e.push(n.y);break;case"z":case"w":case"b":e.push(n.z);break;case"X":case"U":case"R":e.push(-n.x);break;case"Y":case"V":case"G":e.push(-n.y);break;case"Z":case"W":case"B":e.push(-n.z);break;case"0":e.push(0);break;case"1":e.push(1);break;case".":e.push([n.x,n.y,n.z][r]??0);break;default:e.push(0)}}),e};x.polar=n=>{let t=x.len(n),e=Math.acos(n.y/t),i=Math.atan2(n.z,n.x);return{r:t,theta:e,phi:i}};x.fromPolar=(n,t,e)=>{let i=Math.sin(t);return x(n*i*Math.cos(e),n*Math.cos(t),n*i*Math.sin(e))};var E=(n=4,t=4,e=[])=>({m:n,n:t,entries:e.concat(Array(n*t).fill(0)).slice(0,n*t)});E.identity=n=>E(n,n,Array(n*n).fill(0).map((t,e)=>+(Math.floor(e/n)===e%n)));E.get=(n,t,e)=>n.entries[e-1+(t-1)*n.n];E.set=(n,t,e,i)=>{n.entries[e-1+(t-1)*n.n]=i};E.row=(n,t)=>{let e=(t-1)*n.n;return n.entries.slice(e,e+n.n)};E.col=(n,t)=>mo(e=>E.get(n,e+1,t),n.m);E.add=(n,t)=>n.m===t.m&&n.n===t.n&&E.map(n,(e,i)=>e+t.entries[i]);E.sub=(n,t)=>n.m===t.m&&n.n===t.n&&E.map(n,(e,i)=>e-t.entries[i]);E.mul=(n,t)=>{if(n.n!==t.m)return!1;let e=E(n.m,t.n);for(let i=1;i<=n.m;i++)for(let r=1;r<=t.n;r++)E.set(e,i,r,Jh(E.row(n,i),E.col(t,r)));return e};E.scale=(n,t)=>E.map(n,e=>e*t);E.trans=n=>E(n.n,n.m,mo(t=>E.col(n,t+1),n.n).flat());E.minor=(n,t,e)=>{if(n.m!==n.n)return!1;let i=[];for(let r=1;r<=n.m;r++)if(r!==t)for(let o=1;o<=n.n;o++)o!==e&&i.push(E.get(n,r,o));return E(n.m-1,n.n-1,i)};E.det=n=>{if(n.m!==n.n)return!1;if(n.m===1)return n.entries[0];if(n.m===2)return n.entries[0]*n.entries[3]-n.entries[1]*n.entries[2];let t=0,e=1;for(let i=1;i<=n.n;i++)t+=e*n.entries[i-1]*E.det(E.minor(n,1,i)),e*=-1;return t};E.nor=n=>{if(n.m!==n.n)return!1;let t=E.det(n);return E.map(n,e=>e*t)};E.adj=n=>{let t=E(n.m,n.n);for(let i=1;i<=n.m;i++)for(let r=1;r<=n.n;r++)E.set(t,i,r,E.det(E.minor(n,i,r)));let e=E.map(t,(i,r)=>i*(r%2?-1:1));return E.trans(e)};E.inv=n=>{if(n.m!==n.n)return!1;let t=E.det(n);return t===0?!1:E.scale(E.adj(n),1/t)};E.eq=(n,t)=>n.m===t.m&&n.n===t.n&&E.str(n)===E.str(t);E.cpy=n=>E(n.m,n.n,[...n.entries]);E.map=(n,t)=>E(n.m,n.n,n.entries.map(t));E.str=(n,t=", ",e=`
`)=>Zh(n.entries,n.n).map(i=>i.join(t)).join(e);typeof fo<"u"&&(fo.exports={vec2:O,vec3:x,mat:E})});var Ca=Se((h0,go)=>{"use strict";var eu=n=>{var t={};return function(...e){return t[e]??(t[e]=n.apply(this,e))}},tu=(n,t,e=Number.EPSILON)=>Math.abs(n-t)<e,fa=(n,t=0,e=1)=>n<t?t:n>e?e:n,ma=n=>n>=0?n-Math.floor(n):n-Math.ceil(n),iu=(n,t=0)=>{let e=Math.pow(10,t);return Math.round(n*e+Number.EPSILON)/e},qt=(n,t,e)=>n+(t-n)*e,nu=(n,t,e)=>(e-n)/(t-n),ru=(n,t,e,i,r,o)=>qt(qt(n,t,r),qt(e,i,r),o),ou=(n,t,e,i,r)=>i+(n-t)*(r-i)/(e-t),su=(n,t,e)=>qt(n,t,3*Math.pow(e,2)-2*Math.pow(e,3)),au=n=>Math.PI/180*n,lu=n=>180/Math.PI*n,hu=(n,t)=>Math.random()*(t-n)+n,uu=(n,t)=>Math.floor(Math.random()*(t-n+1))+n,ya=(n=.5,t=.5,e=2)=>{let i=0;for(let r=e;r--;)i+=Math.random();return n+(i-e/2)/(e/2)*t},cu=(n,t)=>Math.floor(n+ya(.5,.5,2)*(t+1-n)),du=n=>{let t=n.reduce((r,o)=>r+o,0),e=0,i=Math.random()*t;for(;t>i;)t-=n[e++];return e-1},pu=(n,t,e=qt)=>{let i=t*(n.length-1),r=fa(Math.trunc(i),0,n.length-1);return e(n[r]||0,n[r+1]||0,ma(i))},fu=(n,t)=>n.reduce((e,i,r)=>e+i*t[r],0),Gt=n=>{let t=1;for(let e=2;e<=n;e++)t*=e;return t},mu=(n,t)=>Gt(n)/Gt(n-t),yu=(n,t)=>Gt(n)/(Gt(t)*Gt(n-t)),ga=(n,t)=>t===1?n.map(e=>[e]):n.reduce((e,i,r)=>[...e,...ga(n.slice(0,r).concat(n.slice(r+1)),t-1).map(o=>[i,...o])],[]),ba=(n,t)=>t===1?n.map(e=>[e]):n.reduce((e,i,r)=>[...e,...ba(n.slice(r+1),t-1).map(o=>[i,...o])],[]),gu=(...n)=>n.reduce((t,e)=>t.flatMap(i=>e.map(r=>[...i,r])),[[]]),Un=(n,t)=>Array(t).fill(0).map((e,i)=>n(i)),bu=n=>Un(t=>t,n),vu=(...n)=>Un(t=>n.map(e=>e[t]),Math.max(...n.map(t=>t.length))),Cu=(n,t)=>n[t<0?n.length-Math.abs(t+1)%n.length-1:t%n.length],Tu=n=>{if(n.length)return n[n.length-1]},xu=(n,t,e)=>n+t*e,Su=(n,t)=>[n%t,Math.floor(n/t)],wu=(n,t)=>Un(e=>n.slice(e*t,e*t+t),Math.ceil(n.length/t)),Eu=n=>n.slice().sort(()=>Math.random()-.5),va=(n,t=".")=>Object.keys(n).reduce((e,i)=>{if(n[i]instanceof Date)return{...e,[i]:n[i].toISOString()};if(typeof n[i]!="object"||!n[i])return{...e,[i]:n[i]};let r=va(n[i],t);return{...e,...Object.keys(r).reduce((o,s)=>({...o,[`${i}${t}${s}`]:r[s]}),{})}},{}),Au=(n,t=".")=>{let e={},i,r,o,s;for(o in n){for(r=o.split(t),i=e,s=0;s<r.length-1;s++)r[s]in i||(isFinite(r[s+1])?i[r[s]]=[]:i[r[s]]={}),i=i[r[s]];i[r[r.length-1]]=n[o]}return e},Mu=(n,t)=>{let e=[],i=[];for(let r of n)t(r)?(i.length&&e.push(i),i=[r]):i.push(r);return e.push(i),e},Ru=(n,...t)=>t.reduce((e,i)=>Object.assign(e,{[i]:n[i]}),{}),Iu=(n,...t)=>Object.fromEntries(Object.entries(n).filter(([e])=>!t.includes(e)));typeof go<"u"&&(go.exports={memoize:eu,floatEquals:tu,clamp:fa,frac:ma,round:iu,lerp:qt,unlerp:nu,blerp:ru,remap:ou,smoothstep:su,radians:au,degrees:lu,randomBetween:hu,randomIntBetween:uu,cltRandom:ya,cltRandomInt:cu,weightedRandom:du,lerpArray:pu,dot:fu,factorial:Gt,npr:mu,ncr:yu,permutations:ga,combinations:ba,cartesian:gu,times:Un,range:bu,zip:vu,at:Cu,peek:Tu,ind:xu,pos:Su,chunk:wu,shuffle:Eu,flat:va,unflat:Au,split:Mu,pluck:Ru,exclude:Iu})});var ll=class extends Error{constructor(n,t,e){super(`Possible EventEmitter memory leak detected. ${e} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=n,this.type=t,this.count=e,this.name="MaxListenersExceededWarning"}},Uo=class{static listenerCount(n,t){return n.listenerCount(t)}constructor(){this.events=new Map,this.maxListeners=Uo.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(n,t,e){this.emit(n,t,e)}_getListeners(n){return Array.prototype.concat.apply([],this.events.get(n))||[]}_removeListener(n,t){let e=n.indexOf(t);return e>-1&&n.splice(e,1),[]}_wrapOnceListener(n,t){let e=(...i)=>(this.removeListener(n,e),t.apply(this,i));return Object.defineProperty(e,"name",{value:t.name}),e}setMaxListeners(n){return this.maxListeners=n,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(n,...t){let e=this._getListeners(n);return e.forEach(i=>{i.apply(this,t)}),e.length>0}addListener(n,t){this._emitInternalEvent("newListener",n,t);let e=this._getListeners(n).concat(t);if(this.events.set(n,e),this.maxListeners>0&&this.listenerCount(n)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;let i=new ll(this,n,this.listenerCount(n));console.warn(i)}return this}on(n,t){return this.addListener(n,t)}once(n,t){return this.addListener(n,this._wrapOnceListener(n,t))}prependListener(n,t){let e=this._getListeners(n);if(e.length>0){let i=[t].concat(e);this.events.set(n,i)}else this.events.set(n,e.concat(t));return this}prependOnceListener(n,t){return this.prependListener(n,this._wrapOnceListener(n,t))}removeListener(n,t){let e=this._getListeners(n);return e.length>0&&(this._removeListener(e,t),this.events.set(n,e),this._emitInternalEvent("removeListener",n,t)),this}off(n,t){return this.removeListener(n,t)}removeAllListeners(n){return n?this.events.delete(n):this.events.clear(),this}listeners(n){return Array.from(this._getListeners(n))}listenerCount(n){return this._getListeners(n).length}rawListeners(n){return this.listeners(n)}},Kt=Uo;Kt.defaultMaxListeners=10;var Ml=$o(),$t=class{constructor(){this.cache=new Ml(64)}get(t){return this.cache.get(t)}set(t,e){this.cache.set(t,e)}invalidate(){this.cache.clear()}};var Sc=Symbol("observerBrand");function kt(n,t){t.isRenderable&&(n.save(),t.render(n),n.restore())}var Rl=n=>n.toSorted((t,e)=>Number(t[Lt])-Number(e[Lt]));function je(n,t){for(let e of Rl(t))kt(n,e)}var is=n=>Object.keys(n),Il={onFocus:[],onBlur:[]},Pl=is(Il),Ol={onClick:[],onDown:[],onUp:[]},Ll=is(Ol);function ns(n){for(let t of Pl)if(n.listenerCount(t)>0)return!0;return!1}function rs(n){for(let t of Ll)if(n.listenerCount(t)>0)return!0;return!1}function os(n){return n.listenerCount("onScroll")>0}var ne=Symbol("obstructionAffectable"),Lt=Symbol("renderedLast"),ke=Symbol("centering"),Qo,Zo,Jo,es,ts,Ke=class Ke extends(es=Kt,Jo=ne,Zo=Lt,Qo=ke,es){constructor(){super(...arguments);this[Jo]=!0;this[Zo]=!1;this[Qo]=!1;this.isAnimating=!1;this.animationType=null;this.animationDirection=null;this.animationProgress=1;this.animationDefaultDurationOverride=null;this.animationStartTime=null;this.visible=!0;this.desiredVisible=!0;this.animationZoomShouldSlidePosition=!0;this.layoutCache=new $t;this.realX=0;this.realY=0;this.x=0;this.y=0;this.w=0;this.h=0;_o(this,ts,!0)}static{this.ANIMATION_DEFAULT_DURATIONS={0:200,1:350,2:1e3,3:750}}static{this.ANIMATION_EASING_FUNCTIONS={0:{in:function(i){return i===1?1:1-Math.pow(2,-10*i)},out:function(i){return i===0?0:Math.pow(2,10*i-10)}},1:{in:function(i){return i===1?1:1-Math.pow(2,-10*i)},out:function(i){return i===0?0:Math.pow(2,10*i-10)}},2:{in:function(i){return i},out:function(i){return i}},3:{in:function(i){return i===1?1:1-Math.pow(2,-10*i)},out:function(i){return i===0?0:Math.pow(2,10*i-10)}}}}static{this.SLIDE_DEFAULT_DEPTH_OFFSET=20}static{this.ZOOM_OUT_DEPTH=20}setX(e){this.realX=e,this.x=e}setY(e){this.realY=e,this.y=e}setW(e){this.w=e}setH(e){this.h=e}get isRenderable(){return this.visible||this.isAnimating}get isOutAnimatable(){return this.visible&&!this.isAnimating}get isLayoutable(){return Bo(this,ts)}set isLayoutable(e){Vo(this,ts,e)}cachedLayout(e){let{containerWidth:i,containerHeight:r,originX:o,originY:s}=e,{CACHE_KEY_DELIMITER:a}=Ke,l=i+a+r+a+o+a+s+a+this.getCacheKey(e),h=this.layoutCache.get(l);if(h)return h;let u=this.layout(e);return this.layoutCache.set(l,u),u}static{this.CACHE_KEY_DELIMITER="_"}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=Ke;return this.x+i+this.y+i+this.w+i+this.h}render(e){if(this.isAnimating){let i=performance.now();this.animationStartTime===null&&(this.animationStartTime=i);let r=this.animationDefaultDurationOverride||Ke.ANIMATION_DEFAULT_DURATIONS[this.animationType],o=i-this.animationStartTime,s=Math.max(0,Math.min(o/r,1));this.animationProgress=this.animationDirection==="in"?s:1-s,o>=r&&(this.animationDirection==="out"&&(this.visible=!1,this.emit("onOutAnimationEnd")),this.x=this.realX,this.y=this.realY,this.isAnimating=!1,this.animationStartTime=null)}if(Ke.ANIMATION_EASING_FUNCTIONS[this.animationType]?.[this.animationDirection]){let i=Ke.ANIMATION_EASING_FUNCTIONS[this.animationType][this.animationDirection],r=i(this.animationProgress);switch(this.animationType){case 0:{let o=this.x+this.w/2,s=this.y+this.h/2;this.animationDirection==="out"?e.translate(o,this.y+-(1-r)*Ke.ZOOM_OUT_DEPTH+this.h/2):e.translate(o,s),e.scale(r,r),e.translate(-o,-s);break}case 1:{let{animationSlideOffset:o,animationSlideOffsetSign:s,animationSlideFadeEffectEnabled:a,x:l,y:h,w:u,h:c}=this;a&&(e.globalAlpha=r);let p=l+u/2,d=h+c/2;if(this.animationSlideDirection==="v"){let f=s*(c+o)*(1-r);e.translate(p,this.realY-f+c/2)}else{let f=s*(u+o)*(1-r);e.translate(this.realX-f+u/2,d)}e.translate(-p,-d);break}case 2:{e.globalAlpha=r;break}case 3:{let o=this.x+this.w/2,s=this.y+this.h/2;e.translate(o,s),e.rotate(r*Math.PI*2),e.scale(r,r),e.translate(-o,-s);break}}}}static computePointerLike(e){return e instanceof Function?e():e}isOpener(e,i){return e}setVisible(e,i,r,o,s={}){if(!(e===this.visible&&!this.isAnimating))if(this.desiredVisible=e,this.isOpener(e,i)?this.lastOpener=i:this.lastCloser=i,this.isAnimating&&(this.isAnimating=!1),r){switch(this.isAnimating=!0,this.animationType=o??null,this.animationDirection=e?"in":"out","defaultDurationOverride"in s?this.animationDefaultDurationOverride=s.defaultDurationOverride:this.animationDefaultDurationOverride=null,o){case 0:case 2:case 3:break;case 1:{this.animationSlideDirection="direction"in s?s.direction:"v",this.animationSlideOffset="offset"in s?s.offset:Ke.SLIDE_DEFAULT_DEPTH_OFFSET,this.animationSlideOffsetSign="offsetSign"in s?s.offsetSign:1,this.animationSlideFadeEffectEnabled="fadeEffectEnabled"in s?s.fadeEffectEnabled:!0;break}}this.animationStartTime=null,this.animationProgress=+!e,this.realX=this.x,this.realY=this.y,e&&(this.visible=!0)}else this.visible=e}revertAnimation(e){if(!this.animationType)return;let i=this.visible,r=this.animationType,o={defaultDurationOverride:this.animationDefaultDurationOverride,...r===1&&{direction:this.animationSlideDirection,offset:this.animationSlideOffset,offsetSign:this.animationSlideOffsetSign,fadeEffectEnabled:this.animationSlideFadeEffectEnabled}};this.setVisible(!i,e,!0,r,o)}destroy(){this.removeAllListeners(),this.layoutCache.invalidate(),this.context.removeComponent(this),this.context=null}};ts=new WeakMap;var v=Ke;var Qt=Symbol("blacklisted");function fr(n){var e,i;class t extends(i=n,e=Qt,i){static{this[e]=Qt}constructor(...o){super(...o),this[Qt]=!0}}return t}function kl(...n){return JSON.stringify(n,(t,e)=>typeof e=="object"?e:String(e))}function Re(n,t={}){let{hash:e=kl,cache:i=new Map}=t;return function(...r){let o=e.apply(this,r);if(i.has(o))return i.get(o);let s=n.apply(this,r);return s instanceof Promise&&(s=s.catch(a=>{throw i.delete(o),a})),i.set(o,s),s}}var de=.1875,we=Re((n,t)=>{let e=parseInt(n.slice(1,3),16),i=parseInt(n.slice(3,5),16),r=parseInt(n.slice(5,7),16);return e=Math.floor(e*(1-t)),i=Math.floor(i*(1-t)),r=Math.floor(r*(1-t)),`#${e.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}`}),ss=Re((n,t)=>{let e=parseInt(n.slice(1,3),16),i=parseInt(n.slice(3,5),16),r=parseInt(n.slice(5,7),16);return e=Math.min(255,Math.floor(e*(1+t))),i=Math.min(255,Math.floor(i*(1+t))),r=Math.min(255,Math.floor(r*(1+t))),`#${e.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}`});var X=class{static parseSize(t,e){return typeof t=="number"?t:parseFloat(t)/100*e}static layout(t,{containerWidth:e=0,containerHeight:i=0,originX:r=0,originY:o=0}){let s=this.parseSize(t.w,e),a=this.parseSize(t.h,i),l=0,h=0;return typeof t.x=="string"&&t.x.endsWith("%")?l=this.parseSize(t.x,e):typeof t.x=="number"&&(l=t.x,l=t.invertXCoordinate?e-l:l,l=t.alignFromCenterX?e/2+l:l),typeof t.y=="string"&&t.y.endsWith("%")?h=this.parseSize(t.y,i):typeof t.y=="number"&&(h=t.y,h=t.invertYCoordinate?i-h:h,h=t.alignFromCenterY?i/2+h:h),{x:l+r,y:h+o,w:s,h:a}}};var $e=class extends v{constructor(e){super();this.layoutOptions=e;this.children=new Array;this.wasInitialized=!1;this.afterInitializedOperationQueue=new Set;this.animationZoomShouldSlidePosition=!1;this.once("onInitialized",()=>{this.wasInitialized=!0,this.afterInitializedOperationQueue.forEach(i=>i()),this.afterInitializedOperationQueue.clear(),this.afterInitializedOperationQueue=null})}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v;return super.getCacheKey(e)+i+Object.values(v.computePointerLike(this.layoutOptions)).join(i)+i+Array.from(this.children).map(r=>r.getCacheKey(e)).join(i)}invalidateLayoutCache(){this.layoutCache.invalidate(),this.children.forEach(e=>e.invalidateLayoutCache())}setVisible(e,i,r,o,s={}){super.setVisible(...arguments);let a=()=>{this.children.forEach(l=>{l.setVisible(e,i,!1)})};!e&&r?this.once("onOutAnimationEnd",a):a()}destroy(){this.children.forEach(e=>{e.destroy(),this.context.removeChildComponent(e)}),this.children=null,super.destroy()}addChildren(...e){return e.forEach(i=>this.addChild(i)),this}getChildren(){return this.children.slice()}sortChildren(e){this.children.sort(e)}addChild(e){this.children.push(e);let i=()=>{this.context.addChildComponent(e)};return this.wasInitialized?i():this.afterInitializedOperationQueue.add(i),this}removeChild(e){let i=this.children.indexOf(e);i>-1&&this.children.splice(i,1);let r=()=>{this.context.removeChildComponent(e)};return this.wasInitialized?r():this.afterInitializedOperationQueue.add(r),this}hasChild(e){return this.children.includes(e)}},le=class extends $e{constructor(e,i=!1,r="#ffffff",o=1,s=5,a=.07){super(e);this.color=r;this.rectRadii=o;this.strokeWidthLimit=s;this.strokeWidthCoef=a;i&&this.on("onClickedOutside",()=>{this.desiredVisible&&this.revertAnimation(this)})}getStrokeWidth(){return Math.min(v.computePointerLike(this.strokeWidthLimit),Math.min(this.w,this.h)*v.computePointerLike(this.strokeWidthCoef))}layout(e){let{ctx:i,containerWidth:r,containerHeight:o}=e,s=0,a=0;this.children.length>0&&this.children.forEach(u=>{let{x:c,y:p,w:d,h:f}=u.layout({ctx:i,containerWidth:r,containerHeight:o,originX:0,originY:0});s=Math.max(s,c+d),a=Math.max(a,p+f)});let l=this.getStrokeWidth(),h=Object.assign({w:s,h:a},v.computePointerLike(this.layoutOptions));return typeof h.w=="number"&&(h.w+=l*2),typeof h.h=="number"&&(h.h+=l*2),X.layout(h,e)}render(e){super.render(e);{e.save();let r=v.computePointerLike(this.color),o=v.computePointerLike(this.rectRadii);e.lineWidth=this.getStrokeWidth(),e.fillStyle=r,e.strokeStyle=we(r,de),e.beginPath(),e.roundRect(this.x,this.y,this.w,this.h,o),e.fill(),e.stroke(),e.closePath(),e.restore()}let{children:i}=this;if(i.length>0){let r=this.getStrokeWidth();i.forEach(o=>{let s=o.cachedLayout({ctx:e,containerWidth:this.w-r*4,containerHeight:this.h-r*4,originX:this.x+r,originY:this.y+r});o.setX(s.x),o.setY(s.y),o.setW(s.w),o.setH(s.h)}),je(e,i)}}},ot=class extends $e{constructor(e,i=3,r){super(e);this.rectRadii=i;this.alphaOverride=r}layout(e){let{ctx:i,containerWidth:r,containerHeight:o}=e,s=0,a=0;return this.children.length>0&&this.children.forEach(l=>{let{x:h,y:u,w:c,h:p}=l.layout({ctx:i,containerWidth:r,containerHeight:o,originX:0,originY:0});s=Math.max(s,h+c),a=Math.max(a,u+p)}),X.layout(Object.assign({w:s,h:a},v.computePointerLike(this.layoutOptions)),e)}render(e){super.render(e);let i=typeof this.alphaOverride<"u"?v.computePointerLike(this.alphaOverride):e.globalAlpha/2;if(i>0){e.save();let o=v.computePointerLike(this.rectRadii);e.globalAlpha=i,e.fillStyle="black",e.beginPath(),e.roundRect(this.x,this.y,this.w,this.h,o),e.fill(),e.closePath(),e.restore()}let{children:r}=this;r.length>0&&(r.forEach(o=>{let s=o.cachedLayout({ctx:e,containerWidth:this.w,containerHeight:this.h,originX:this.x,originY:this.y});o.setX(s.x),o.setY(s.y),o.setW(s.w),o.setH(s.h)}),je(e,r))}},as,ls,Dt=class extends(ls=$e,as=ne,ls){constructor(e,i,r,o){super(e);this.lerpChildren=i;this.spacingOverride=r;this.reverseRender=o;this[as]=!1;this.childPositions=new Map}static{this.POSITION_LERP_FACTOR=.1}destroy(){this.childPositions.clear(),this.childPositions=null,super.destroy()}},Ee=class extends Dt{constructor(t,e=!1,i=null,r=!1){super(t,e,i,r)}layout(t){let{ctx:e,containerWidth:i,containerHeight:r}=t,o=0,s=0,a=v.computePointerLike(this.spacingOverride),l=v.computePointerLike(this.reverseRender);if(this.children.length>0){let h=0;l&&a&&(h=a*(this.children.length-1)),this.children.forEach(u=>{let{w:c,h:p}=u.layout({ctx:e,containerWidth:i,containerHeight:r,originX:h,originY:0});s=Math.max(s,p),a!==null?(o=Math.max(o,h+c),h+=(l?-1:1)*a):(o=Math.max(o,h+c),h+=(l?-1:1)*c)}),l&&a===null&&(o=h*-1)}return X.layout({...v.computePointerLike(this.layoutOptions),w:o,h:s},t)}render(t){super.render(t);let{children:e}=this;if(e.length>0){let i=v.computePointerLike(this.lerpChildren),r=v.computePointerLike(this.spacingOverride),o=v.computePointerLike(this.reverseRender),s=0;if(o&&(r!==null?s+=r*(e.length-1):(e.forEach(a=>{let l=a.cachedLayout({ctx:t,containerWidth:this.w,containerHeight:this.h,originX:this.x+s,originY:this.y});s+=l.w}),s-=e[0]?.cachedLayout({ctx:t,containerWidth:this.w,containerHeight:this.h,originX:this.x,originY:this.y}).w??0)),i){e.forEach(a=>{let l=a.cachedLayout({ctx:t,containerWidth:this.w,containerHeight:this.h,originX:this.x+s,originY:this.y}),h=l.x;this.childPositions.has(a)||this.childPositions.set(a,h);let u=this.childPositions.get(a),c=u+(h-u)*Dt.POSITION_LERP_FACTOR;if(this.childPositions.set(a,c),a.isLayoutable){let p=a[ke]?this.y+(this.h-l.h)/2:l.y;a.setX(c),a.setY(p),a.setW(l.w),a.setH(l.h)}s+=(o?-1:1)*(r??l.w)}),je(t,e);for(let a of this.childPositions.keys())e.includes(a)||this.childPositions.delete(a)}else e.forEach(a=>{let l=a.cachedLayout({ctx:t,containerWidth:this.w,containerHeight:this.h,originX:this.x+s,originY:this.y});if(a.isLayoutable){let h=a[ke]?this.y+(this.h-l.h)/2:l.y;a.setX(l.x),a.setY(h),a.setW(l.w),a.setH(l.h)}s+=(o?-1:1)*(r??l.w)}),je(t,e)}}},he=class extends Dt{constructor(t,e=!1,i=null,r=!1){super(t,e,i,r)}layout(t){let{ctx:e,containerWidth:i,containerHeight:r}=t,o=0,s=0,a=v.computePointerLike(this.spacingOverride),l=v.computePointerLike(this.reverseRender);if(this.children.length>0){let h=0;l&&a&&(h=a*(this.children.length-1)),this.children.forEach(u=>{let{w:c,h:p}=u.layout({ctx:e,containerWidth:i,containerHeight:r,originX:0,originY:h});s=Math.max(s,c),a!==null?(o=Math.max(o,h+p),h+=(l?-1:1)*a):(o=Math.max(o,h+p),h+=(l?-1:1)*p)}),l&&a===null&&(o=h*-1)}return X.layout({...v.computePointerLike(this.layoutOptions),w:s,h:o},t)}render(t){super.render(t);let{children:e}=this;if(e.length>0){let i=v.computePointerLike(this.lerpChildren),r=v.computePointerLike(this.spacingOverride),o=v.computePointerLike(this.reverseRender),s=0;if(o)if(r!==null)s=r*(e.length-1);else{for(let a of e){let l=a.cachedLayout({ctx:t,containerWidth:this.w,containerHeight:this.h,originX:this.x,originY:this.y});s+=l.h}s-=e[0]?.cachedLayout({ctx:t,containerWidth:this.w,containerHeight:this.h,originX:this.x,originY:this.y}).h??0}if(i){e.forEach(a=>{let l=a.cachedLayout({ctx:t,containerWidth:this.w,containerHeight:this.h,originX:this.x,originY:this.y+s}),h=l.y;this.childPositions.has(a)||this.childPositions.set(a,h);let u=this.childPositions.get(a),c=u+(h-u)*Dt.POSITION_LERP_FACTOR;if(this.childPositions.set(a,c),a.isLayoutable){let p=a[ke]?this.x+(this.w-l.w)/2:l.x;a.setX(p),a.setY(c),a.setW(l.w),a.setH(l.h)}s+=(o?-1:1)*(r??l.h)}),je(t,e);for(let a of this.childPositions.keys())e.includes(a)||this.childPositions.delete(a)}else e.forEach(a=>{let l=a.cachedLayout({ctx:t,containerWidth:this.w,containerHeight:this.h,originX:this.x,originY:this.y+s});if(a.isLayoutable){let h=a[ke]?this.x+(this.w-l.w)/2:l.x;a.setX(h),a.setY(l.y),a.setW(l.w),a.setH(l.h)}s+=(o?-1:1)*(r??l.h)}),je(t,e)}}};function Dl(n,t,e){return n*(1-e)+t*e}var pn=class n extends $e{constructor(e,i=5.5,r=30){super(e);this.scrollBarWidth=i;this.scrollBarHeight=r;this.currentScrollY=0;this.targetScrollY=0;this.scrollYAlpha=1;this.isDragging=!1;this.wasPointed=!1;this.lastMouseY=0;this.contentHeight=0;this.on("onMouseDown",o=>this.handleMouseDown(o)),this.on("onMouseMove",o=>this.handleMouseMove(o)),this.on("onMouseUp",()=>this.handleMouseUp()),this.on("onScroll",o=>this.handleScroll(o))}static{this.ON_SCROLLED_ALPHA=.075}static{this.SCROLLED_WITH_BAR_ALPHA=.2}static{this.SCROLL_SPEED=15}get scrollBarMetrics(){let{currentScrollY:e,scrollBarWidth:i,scrollBarHeight:r,contentHeight:o,x:s,y:a,w:l,h}=this,u=h-r,c=a+e/o*u;return{x:s+l-i,y:c,width:i,height:r,visibleHeight:u}}isPointInScrollBar(e,i){let{x:r,y:o,width:s,height:a}=this.scrollBarMetrics;return e>=r&&e<=r+s&&i>=o&&i<=o+a}handleMouseDown(e){let i=this.context.mouseX,r=this.context.mouseY;this.isPointInScrollBar(i,r)&&(this.isDragging=!0,this.lastMouseY=r)}updateCursor(){let{mouseX:e,mouseY:i}=this.context,r=this.isPointInScrollBar(e,i);r&&!this.wasPointed?(this.context.canvas.style.cursor="pointer",this.wasPointed=!0):!r&&this.wasPointed&&(this.context.canvas.style.cursor="default",this.wasPointed=!1)}handleMouseMove(e){if(this.updateCursor(),!this.isDragging)return;let i=this.context.mouseY,r=i-this.lastMouseY;this.lastMouseY=i;let s=this.scrollBarMetrics.visibleHeight/this.contentHeight,a=r/s;this.targetScrollY=Math.max(0,Math.min(this.contentHeight,this.targetScrollY+a)),this.scrollYAlpha=n.SCROLLED_WITH_BAR_ALPHA}handleMouseUp(){this.isDragging=!1}handleScroll(e){this.targetScrollY=Math.max(0,Math.min(this.contentHeight,this.targetScrollY+(e.deltaY>=0?n.SCROLL_SPEED:-n.SCROLL_SPEED))),this.scrollYAlpha=n.ON_SCROLLED_ALPHA}cachedLayout(e){return this.layout(e)}getCacheKey(e){return""}layout(e){let{ctx:i}=e,r=X.layout(v.computePointerLike(this.layoutOptions),e);if(this.children.length>0){let o=0,s=0;this.children.forEach(a=>{let{y:l,h}=a.layout({ctx:i,containerWidth:r.w-this.scrollBarWidth*2,containerHeight:r.h,originX:0,originY:0});o+=h,s=Math.max(s,l)}),this.contentHeight=o+(s-r.h)}return r}render(e){if(super.render(e),this.currentScrollY=Dl(this.currentScrollY,this.targetScrollY,this.scrollYAlpha),e.save(),e.beginPath(),e.rect(this.x,this.y,this.w-this.scrollBarWidth,this.h),e.clip(),this.children.length>0){let r=-this.currentScrollY;this.children.forEach(o=>{let s=o.layout({ctx:e,containerWidth:this.w-this.scrollBarWidth*2,containerHeight:this.h,originX:this.x,originY:this.y+r});if(o.isLayoutable){let a=o[ke]?this.x+(this.w-s.w)/2:s.x;o.setX(a),o.setY(s.y),o.setW(s.w),o.setH(s.h)}s.y+s.h>=this.y&&s.y<=this.y+this.h&&kt(e,o),r+=s.h})}e.restore();let i=this.scrollBarMetrics;e.fillStyle="black",e.globalAlpha=.2,e.beginPath(),e.roundRect(i.x,i.y,i.width,i.height,i.width/2),e.fill()}},hs,us,k=class extends(us=v,hs=ne,us){constructor(e,i){super();this.sw=e;this.sh=i;this[hs]=!1}layout({originX:e,originY:i}){return{x:e,y:i,w:v.computePointerLike(this.sw),h:v.computePointerLike(this.sh)}}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v;return super.getCacheKey(e)+i+v.computePointerLike(this.sw)+i+v.computePointerLike(this.sh)}invalidateLayoutCache(){this.layoutCache.invalidate()}render(e){}},j=class extends k{constructor(e,i,r,o){super(e,i);this.sx=r;this.sy=o}layout({originX:e,originY:i}){return{x:e+v.computePointerLike(this.sx),y:i+v.computePointerLike(this.sy),w:v.computePointerLike(this.sw),h:v.computePointerLike(this.sh)}}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v;return super.getCacheKey(e)+i+v.computePointerLike(this.sx)+i+v.computePointerLike(this.sy)}};var P=1,Nl=1300,Bl=650,yt=class extends Kt{constructor(e){super();this.canvas=e;this.mouseX=0;this.mouseY=0;this.components=new Set;this.childComponents=new Set;this.hoveredComponent=null;this.clickedComponent=null;let i=this.canvas.getContext("2d");if(!i)throw new Error("Cannot get context of canvas");this.ctx=i,this.mousedown=this.handleMouseDown.bind(this),this.mouseup=this.handleMouseUp.bind(this),this.mousemove=this.handleMouseMove.bind(this),this.wheel=this.handleWheel.bind(this),this.touchmove=r=>{r.preventDefault();let o=r.touches[0];this.handleMouseMove({isTrusted:r.isTrusted,clientX:o.clientX,clientY:o.clientY})},this.touchstart=r=>{if(r.preventDefault(),r.touches.length>1)return;let o=r.touches[0],s=this.canvas.getBoundingClientRect();this.mouseX=(o.clientX-s.left)*(this.canvas.width/s.width)/P,this.mouseY=(o.clientY-s.top)*(this.canvas.height/s.height)/P,this.handleMouseDown({isTrusted:r.isTrusted,clientX:o.clientX,clientY:o.clientY,button:0})},this.touchend=r=>{r.preventDefault(),this.handleMouseUp({isTrusted:r.isTrusted,clientX:this.mouseX*P,clientY:this.mouseY*P,button:0})},this.keydown=this.handleKeyDown.bind(this),this.keyup=this.handleKeyUp.bind(this),this.onresize=()=>{this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,P=Math.max(this.canvas.width/Nl,this.canvas.height/Bl),this.updateComponentsLayout(!0)};{this.canvasEventOptions={capture:!0};let{canvasEventOptions:r}=this;this.canvas.addEventListener("mousedown",this.mousedown,r),this.canvas.addEventListener("mouseup",this.mouseup,r),this.canvas.addEventListener("mousemove",this.mousemove,r),this.canvas.addEventListener("wheel",this.wheel,r),this.canvas.addEventListener("touchmove",this.touchmove,r),this.canvas.addEventListener("touchstart",this.touchstart,r),this.canvas.addEventListener("touchend",this.touchend,r)}window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),window.addEventListener("resize",this.onresize),this.onInitialize(),this.onresize(),this.onresize(),e.style.touchAction="none"}removeEventListeners(){{let{canvasEventOptions:e}=this;this.canvas.removeEventListener("mousedown",this.mousedown,e),this.canvas.removeEventListener("mouseup",this.mouseup,e),this.canvas.removeEventListener("mousemove",this.mousemove,e),this.canvas.removeEventListener("wheel",this.wheel,e),this.canvas.removeEventListener("touchmove",this.touchmove,e),this.canvas.removeEventListener("touchstart",this.touchstart,e),this.canvas.removeEventListener("touchend",this.touchend,e)}window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("resize",this.onresize),this.mousedown=null,this.mouseup=null,this.mousemove=null,this.keydown=null,this.keyup=null,this.hoveredComponent&&(this.hoveredComponent.emit("onBlur"),this.hoveredComponent=null)}addComponents(...e){e.forEach(i=>this.addComponent(i))}addComponent(e){e.context=this,this.components.add(e),e.emit("onInitialized")}removeComponent(e){this.components.delete(e)}addChildComponent(e){this.addComponent(e),this.childComponents.add(e)}removeChildComponent(e){this.removeComponent(e),this.childComponents.delete(e)}overlapsComponent(e,i,r){return i>=e.x&&i<=e.x+e.w&&r>=e.y&&r<=e.y+e.h}componentOverlapsComponent({x:e,y:i,w:r,h:o},{x:s,y:a,w:l,h}){return!(e+r<=s||e>=s+l||i+o<=a||i>=a+h)}isComponentNotOverlappingWithOtherComponents(e){for(let i of this.components)if(i!==e&&!this.isChildComponent(i)&&!this.isComponentAnimatingOut(i)&&this.isComponentObstructable(i)&&this.componentOverlapsComponent(e,i))return!1;return!0}isComponentObstructed(e,i,r){let o=Array.from(this.components),s=o.indexOf(e);if(s===-1)return!1;for(let a=s+1;a<o.length;a++){let l=o[a];if(this.isComponentObstructable(l)&&this.overlapsComponent(l,i,r))return!0}return!1}isComponentObstructable({[ne]:e,isRenderable:i}){return e&&i}isComponentInteractable(e){return!this.isAncestorAnimatingOut(e)&&this.isComponentObstructable(e)&&(ns(e)||rs(e)||os(e))}isComponentInteractableAtPosition(e,i,r){return this.isComponentInteractable(e)&&this.overlapsComponent(e,i,r)&&!this.isComponentObstructed(e,i,r)}isChildComponent(e){return this.childComponents.has(e)}getRootComponents(){return Array.from(this.components.values().filter(e=>!this.childComponents.has(e)))}getTopLevelRenderableComponents(){return this.getRootComponents().filter(e=>!e[Qt])}updateComponentsLayout(e){let i=this.canvas.width/P,r=this.canvas.height/P;this.getRootComponents().forEach(o=>{if(e&&o.invalidateLayoutCache(),!o.isLayoutable)return;let s=o.cachedLayout({ctx:this.ctx,containerWidth:i,containerHeight:r,originX:0,originY:0});o.setX(s.x),o.setY(s.y),o.setW(s.w),o.setH(s.h)})}broadcastUnconditionalEvent(e,...i){this.emit(e,...i),this.components.forEach(r=>r.emit(e,...i))}handleKeyDown(e){e.isTrusted&&this.broadcastUnconditionalEvent("onKeyDown",e)}handleKeyUp(e){e.isTrusted&&this.broadcastUnconditionalEvent("onKeyUp",e)}handleMouseDown(e){if(e.isTrusted&&(this.broadcastUnconditionalEvent("onMouseDown",e),e.button===0)){let{mouseX:i,mouseY:r}=this;for(let o of this.components)if(this.isComponentInteractableAtPosition(o,i,r)){this.clickedComponent=o,this.clickedComponent.emit("onDown");break}this.components.values().filter(o=>o!==this.clickedComponent&&o.lastOpener!==this.clickedComponent&&!this.overlapsComponent(o,i,r)&&!(o instanceof $e&&this.isComponentDescendant(o,this.clickedComponent))).forEach(o=>o.emit("onClickedOutside"))}}handleMouseUp(e){if(e.isTrusted&&(this.broadcastUnconditionalEvent("onMouseUp",e),e.button===0&&this.clickedComponent)){let{mouseX:i,mouseY:r}=this;this.isComponentInteractableAtPosition(this.clickedComponent,i,r)&&(this.clickedComponent.emit("onUp"),this.clickedComponent.emit("onClick")),this.clickedComponent=null}}handleMouseMove(e){if(!e.isTrusted)return;let i=this.canvas.getBoundingClientRect();this.mouseX=(e.clientX-i.left)*(this.canvas.width/i.width)/P,this.mouseY=(e.clientY-i.top)*(this.canvas.height/i.height)/P,this.broadcastUnconditionalEvent("onMouseMove",e)}handleWheel(e){if(!e.isTrusted)return;this.broadcastUnconditionalEvent("onWheel",e);let{mouseX:i,mouseY:r}=this;for(let o of this.components)if(this.isComponentInteractableAtPosition(o,i,r)){o.emit("onScroll",e);break}}findParentContainer(e){for(let i of this.components)if(i instanceof $e&&i.hasChild(e))return i;return null}isComponentAnimatingOut(e){return e.isAnimating&&e.animationDirection==="out"}isAncestorAnimatingOut(e){let i=this.findParentContainer(e);return i===null?!1:this.isComponentAnimatingOut(i)?!0:this.isAncestorAnimatingOut(i)}isComponentDescendant(e,i){if(e.hasChild(i))return!0;let r=this.findParentContainer(i);return r===null?!1:e===r?!0:this.isComponentDescendant(e,r)}emitInteractiveEvents(){this.hoveredComponent&&this.isAncestorAnimatingOut(this.hoveredComponent)&&(this.hoveredComponent.emit("onBlur"),this.hoveredComponent=null),this.components.forEach(e=>{if(e[ne]&&!this.isAncestorAnimatingOut(e))switch(this.isComponentInteractableAtPosition(e,this.mouseX,this.mouseY)){case!0:{this.hoveredComponent!==e&&(this.hoveredComponent?.emit?.("onBlur"),this.hoveredComponent=e,this.hoveredComponent.emit("onFocus"));break}case!1:{this.hoveredComponent===e&&(this.hoveredComponent.emit("onBlur"),this.hoveredComponent=null);break}}})}cleanupComponentHierarchy(){this.getRootComponents().forEach(e=>e.destroy()),this.components.clear(),this.components=null,this.childComponents.clear(),this.childComponents=null,this.hoveredComponent=null,this.clickedComponent=null}renderComponents(){this.emitInteractiveEvents(),this.updateComponentsLayout(!1),je(this.ctx,this.getTopLevelRenderableComponents())}destroy(){this.removeAllListeners()}};var cs=Math.PI*2;function _l(n,t){let e=(t-n)%cs;return e*2%cs-e}var Vl=(n,t,e)=>n+_l(n,t)*e,Ul=(n,t,e)=>n+(t-n)*Math.min(1,W/e),gt=class{constructor(t,e,i,r,o,s){this.id=t;this.x=this.nx=this.ox=e,this.y=this.ny=this.oy=i,this.angle=this.nAngle=this.oAngle=r,this.size=this.nSize=this.oSize=o,this.redHealth=this.health=this.nHealth=this.oHealth=s,this.redHealthTimer=0,this.eyeX=1,this.eyeY=0,this.updateT=0,this.hurtT=0,this.deadT=0,this.isDead=!1,this.moveCounter=0,this.hpAlpha=1}update(){this.isDead&&(this.deadT+=W/200),this.hurtT>0&&(this.hurtT-=W/150,this.hurtT<0&&(this.hurtT=0)),this.updateT+=W/100,this.t=Math.min(1,this.updateT),this.x=this.ox+(this.nx-this.ox)*this.t,this.y=this.oy+(this.ny-this.oy)*this.t,this.health=this.oHealth+(this.nHealth-this.oHealth)*this.t,this.size=this.oSize+(this.nSize-this.oSize)*this.t;let t=Math.min(1,W/100);this.eyeX+=(Math.cos(this.nAngle)-this.eyeX)*t,this.eyeY+=(Math.sin(this.nAngle)-this.eyeY)*t,this.angle=Vl(this.oAngle,this.nAngle,this.t),this.moveCounter+=Math.hypot(this.x-this.nx,this.y-this.ny)/50*W/18,this.redHealthTimer>0&&(this.redHealthTimer-=W/600,this.redHealthTimer<0&&(this.redHealthTimer=0)),this.health<1&&(this.hpAlpha=Ul(this.hpAlpha,1,200)),this.redHealthTimer===0&&(this.redHealth+=(this.health-this.redHealth)*Math.min(1,W/200))}};var J=class n extends gt{constructor(e,i,r,o,s,a,l,h,u,c){super(e,i,r,o,s,a);this.type=l;this.rarity=h;this.isPet=u;this.isFirstSegment=c;this.legD=Array(n.STARFISH_LEG_AMOUNT).fill(150);this.sandstormAngle=0}static{this.STARFISH_LEG_AMOUNT=5}};function ds(n){return[(n&1)!==0,(n&2)!==0]}var Ie=class extends gt{constructor(e,i,r,o,s,a,l,h){super(e,i,r,o,s,a);this.mood=l;this.name=h;this.angryT=0,this.sadT=0,this.isRemoved=!1,this.isDev=!1}update(){if(super.update(),this.isDead)this.sadT=1,this.angryT=0;else{let e=W/100,[i,r]=ds(this.mood);this.angryT=Math.min(1,Math.max(0,this.angryT+(i?e:-e))),this.sadT=Math.min(1,Math.max(0,this.sadT+(!i&&r?e:-e)))}}};var ps={"15":{"0":{damage:10,health:10,petalReload:2.5,count:1},"1":{damage:30,health:30,petalReload:2.5,count:1},"2":{damage:90,health:90,petalReload:2.5,count:1},"3":{damage:270,health:270,petalReload:2.5,count:1},"4":{damage:810,health:810,petalReload:2.5,count:1},"5":{damage:2430,health:2430,petalReload:2.5,count:1},"6":{damage:7290,health:7290,petalReload:2.5,count:1},i18n:{name:"Basic",fullName:"Basic",description:"A nice petal, not too strong but not too weak."},collision:{fraction:20,radius:20}},"16":{"0":{damage:8,health:5,petalReload:2.5,count:1,extra:{rad:.5}},"1":{damage:24,health:15,petalReload:2.5,count:1,extra:{rad:.7}},"2":{damage:72,health:45,petalReload:2.5,count:1,extra:{rad:.9}},"3":{damage:216,health:135,petalReload:2.5,count:1,extra:{rad:1.1}},"4":{damage:648,health:405,petalReload:2.5,count:1,extra:{rad:1.3}},"5":{damage:1944,health:1215,petalReload:2.5,count:2,extra:{rad:1.5}},"6":{damage:5832,health:3645,petalReload:2.5,count:3,extra:{rad:1.7}},i18n:{name:"Faster",fullName:"Faster",description:"It's so light it makes your other petals spin faster."},collision:{fraction:20,radius:20}},"17":{"0":{damage:0,health:25,petalReload:1,count:1,extra:{usageReload:15}},"1":{damage:0,health:75,petalReload:1,count:1,extra:{usageReload:19.2}},"2":{damage:0,health:225,petalReload:1,count:1,extra:{usageReload:23.5}},"3":{damage:0,health:675,petalReload:1,count:1,extra:{usageReload:32}},"4":{damage:0,health:2025,petalReload:1,count:1,extra:{usageReload:1.8}},"5":{damage:0,health:6075,petalReload:1,count:1,extra:{usageReload:7.4}},"6":{damage:0,health:18225,petalReload:1,count:1,extra:{usageReload:16.9}},i18n:{name:"Egg",fullName:"Beetle Egg",description:"Something interesting might pop out of this."},collision:{fraction:20,radius:40}},"18":{"0":{damage:0,health:1,petalReload:5.5,count:1,extra:{usageReload:.5}},"1":{damage:0,health:1,petalReload:4.5,count:1,extra:{usageReload:.5}},"2":{damage:0,health:1,petalReload:3.5,count:1,extra:{usageReload:.5}},"3":{damage:0,health:1,petalReload:2.5,count:1,extra:{usageReload:.5}},"4":{damage:0,health:1,petalReload:1.5,count:1,extra:{usageReload:.5}},"5":{damage:0,health:1,petalReload:.8,count:1,extra:{usageReload:.5}},"6":{damage:0,health:1,petalReload:.5,count:1,extra:{usageReload:.5}},i18n:{name:"Bubble",fullName:"Bubble",description:"Physics are for the weak."},collision:{fraction:15,radius:20}},"19":{"0":{damage:90,health:90,petalReload:2,count:1},"1":{damage:90,health:90,petalReload:2,count:1},"2":{damage:90,health:90,petalReload:2,count:1},"3":{damage:90,health:90,petalReload:2,count:1},"4":{damage:90,health:90,petalReload:2,count:1},"5":{damage:90,health:90,petalReload:2,count:1},"6":{damage:90,health:90,petalReload:2,count:1},i18n:{name:"Yin Yang",fullName:"Yin Yang",description:"This mysterious petal affects the rotation of your petals in unpredictable ways."},collision:{fraction:20,radius:20}},"20":{"0":{damage:0,health:0,petalReload:99,count:1,extra:{usageReload:99}},"1":{damage:0,health:0,petalReload:99,count:1,extra:{usageReload:99}},"2":{damage:0,health:0,petalReload:99,count:1,extra:{usageReload:99}},"3":{damage:27,health:270,petalReload:4,count:1,extra:{usageReload:2.5}},"4":{damage:81,health:810,petalReload:4,count:1,extra:{usageReload:3.7}},"5":{damage:243,health:2430,petalReload:4,count:1,extra:{usageReload:10.7}},"6":{damage:729,health:7290,petalReload:4,count:1,extra:{usageReload:22.3}},i18n:{name:"Stick",fullName:"Stick",description:"I DONT KNOW SHITTTT"},collision:{fraction:10,radius:10}}};var Qe=Re(n=>n in ps);var fs={"0":{"0":{health:37.5,bodyDamage:50},"1":{health:140.7,bodyDamage:150},"2":{health:506.25,bodyDamage:450},"3":{health:2025,bodyDamage:1350},"4":{health:15187.5,bodyDamage:4050},"5":{health:91125,bodyDamage:12150},"6":{health:2737500,bodyDamage:36450},baseSize:30,i18n:{name:"Bee",description:"It stings. Don't touch it."},collision:{fraction:30,radius:25}},"1":{"0":{health:62.5,bodyDamage:15},"1":{health:234.5,bodyDamage:45},"2":{health:843.75,bodyDamage:135},"3":{health:3375,bodyDamage:405},"4":{health:25312.5,bodyDamage:1215},"5":{health:151875,bodyDamage:3645},"6":{health:4562500,bodyDamage:10935},baseSize:20,i18n:{name:"Spider",description:"Spooky."},collision:{fraction:25,radius:35}},"2":{"0":{health:100,bodyDamage:30},"1":{health:375.2,bodyDamage:90},"2":{health:1350,bodyDamage:270},"3":{health:5400,bodyDamage:810},"4":{health:40500,bodyDamage:2430},"5":{health:243e3,bodyDamage:7290},"6":{health:73e5,bodyDamage:21870},baseSize:30,i18n:{name:"Beetle",description:"It's hungry and flowers are its favorite meal."},collision:{fraction:40,radius:40}},"3":{"0":{health:125,bodyDamage:40},"1":{health:469,bodyDamage:120},"2":{health:1687.5,bodyDamage:360},"3":{health:6750,bodyDamage:1080},"4":{health:50625,bodyDamage:3240},"5":{health:303750,bodyDamage:9720},"6":{health:9125e3,bodyDamage:29160},baseSize:30,i18n:{name:"Sandstorm",description:"Darude (1999)"},collision:{fraction:20,radius:22}},"4":{"0":{health:75,bodyDamage:5},"1":{health:281.4,bodyDamage:15},"2":{health:1012.5,bodyDamage:45},"3":{health:4050,bodyDamage:135},"4":{health:30375,bodyDamage:405},"5":{health:182250,bodyDamage:1215},"6":{health:5475e3,bodyDamage:3654},baseSize:30,i18n:{name:"Cactus",description:"Avoid touching it, it hurts"},collision:{fraction:30,radius:35}},"5":{"0":{health:100,bodyDamage:15},"1":{health:375.2,bodyDamage:45},"2":{health:1350,bodyDamage:135},"3":{health:5400,bodyDamage:405},"4":{health:40500,bodyDamage:1215},"5":{health:243e3,bodyDamage:3654},"6":{health:73e5,bodyDamage:10935},baseSize:30,i18n:{name:"Scorpion",description:"IT STINGS"},collision:{fraction:30,radius:27.5}},"6":{"0":{health:87.5,bodyDamage:10},"1":{health:328.3,bodyDamage:30},"2":{health:1181.25,bodyDamage:90},"3":{health:4725,bodyDamage:270},"4":{health:35437.5,bodyDamage:810},"5":{health:243e3,bodyDamage:2430},"6":{health:6387500,bodyDamage:7290},baseSize:30,i18n:{name:"Shiny Ladybug",description:"Shiny, cute and mostly harmless."},collision:{fraction:30,radius:30}},"7":{"0":{health:150,bodyDamage:20},"1":{health:562.8,bodyDamage:60},"2":{health:2025,bodyDamage:180},"3":{health:8100,bodyDamage:540},"4":{health:60750,bodyDamage:1620},"5":{health:364500,bodyDamage:4860},"6":{health:1095e4,bodyDamage:14580},baseSize:20,i18n:{name:"Starfish",description:"His name is Patrick"},collision:{fraction:120,radius:100}},"8":{"0":{health:125,bodyDamage:25,extra:{lightning:7,bounces:2}},"1":{health:469,bodyDamage:75,extra:{lightning:21,bounces:3}},"2":{health:1687.5,bodyDamage:225,extra:{lightning:63,bounces:4}},"3":{health:6750,bodyDamage:675,extra:{lightning:189,bounces:5}},"4":{health:50625,bodyDamage:2025,extra:{lightning:567,bounces:6}},"5":{health:303750,bodyDamage:6075,extra:{lightning:1701,bounces:7}},"6":{health:9125e3,bodyDamage:18225,extra:{lightning:5103,bounces:8}},baseSize:30,i18n:{name:"Jellyfish",description:"Makes the most delicious jam."},collision:{fraction:20,radius:20}},"9":{"0":{health:.5,bodyDamage:5},"1":{health:1.876,bodyDamage:15},"2":{health:6.75,bodyDamage:45},"3":{health:27,bodyDamage:135},"4":{health:202.5,bodyDamage:405},"5":{health:1215,bodyDamage:1215},"6":{health:36500,bodyDamage:3645},baseSize:40,i18n:{name:"Bubble",description:"Pop"},collision:{fraction:20,radius:20}},"10":{"0":{health:100,bodyDamage:10},"1":{health:375.2,bodyDamage:30},"2":{health:1350,bodyDamage:90},"3":{health:5400,bodyDamage:270},"4":{health:40500,bodyDamage:810},"5":{health:243e3,bodyDamage:2430},"6":{health:73e5,bodyDamage:7290},baseSize:30,i18n:{name:"Sponge",description:"Bob"},collision:{fraction:20,radius:20}},"11":{"0":{health:225,bodyDamage:10},"1":{health:844.2,bodyDamage:30},"2":{health:3037.5,bodyDamage:90},"3":{health:12150,bodyDamage:270},"4":{health:91125,bodyDamage:810},"5":{health:546750,bodyDamage:2430},"6":{health:16425e3,bodyDamage:7290},baseSize:30,i18n:{name:"Shell",description:"Not an advertisement."},collision:{fraction:20,radius:30}},"12":{"0":{health:25,bodyDamage:10},"1":{health:93.8,bodyDamage:30},"2":{health:337.5,bodyDamage:90},"3":{health:1350,bodyDamage:270},"4":{health:10125,bodyDamage:810},"5":{health:60750,bodyDamage:2430},"6":{health:1825e3,bodyDamage:7290},baseSize:40,i18n:{name:"Centipede",description:"It's just there doing its thing."},collision:{fraction:40,radius:40}},"13":{"0":{health:25,bodyDamage:10},"1":{health:93.8,bodyDamage:30},"2":{health:337.5,bodyDamage:90},"3":{health:1350,bodyDamage:270},"4":{health:10125,bodyDamage:810},"5":{health:60750,bodyDamage:2430},"6":{health:1825e3,bodyDamage:7290},baseSize:40,i18n:{name:"Centipede",description:"This one loves flowers."},collision:{fraction:40,radius:40}},"14":{"0":{health:25,bodyDamage:10},"1":{health:93.8,bodyDamage:30},"2":{health:337.5,bodyDamage:90},"3":{health:1350,bodyDamage:270},"4":{health:10125,bodyDamage:810},"5":{health:60750,bodyDamage:2430},"6":{health:1825e3,bodyDamage:7290},baseSize:40,i18n:{name:"Centipede",description:"Gotta go fast."},collision:{fraction:40,radius:40}}};var Fl=Re(n=>[parseInt(n.slice(1,3),16),parseInt(n.slice(3,5),16),parseInt(n.slice(5,7),16)]),mr=[255,0,0],De=class{render(t){let{ctx:e,entity:{x:i,y:r},entity:o,isSpecimen:s}=t;e.translate(i,r),s||(this.applyDeathAnimation(t),o instanceof J&&Qe(o.type)||this.drawEntityStatus(t))}isRenderingCandidate({entity:t,isSpecimen:e}){return!(!e&&t.isDead&&t.deadT>1)}guard(t){return t.save(),{[Symbol.dispose]:()=>{t.restore()}}}calculateDamageEffectColor({entity:t},e){let i=1-t.hurtT;if(i>=1)return e;let r=i*.25+.75,o=Fl(e),s=Math.round(o[0]*r+mr[0]*(1-r)),a=Math.round(o[1]*r+mr[1]*(1-r)),l=Math.round(o[2]*r+mr[2]*(1-r));return`rgb(${s},${a},${l})`}applyDeathAnimation({ctx:t,entity:{isDead:e,deadT:i}}){if(e){let r=Math.sin(i*Math.PI/2),o=1+r;t.scale(o,o),t.globalAlpha*=1-r}}drawEntityStatus({ctx:t,entity:e}){if(e.hpAlpha<=0)return;e instanceof Ie&&Ce.currentCtx instanceof bt&&e.id!==Ce.currentCtx.waveSelfId&&(t.save(),t.translate(0,-(e.size+10)),t.scale(.2,.2),t.font="4em Ubuntu",t.textBaseline="middle",t.textAlign="center",t.lineWidth=8,t.strokeStyle="#000000",t.fillStyle="#ffffff",t.strokeText(e.name,0,0),t.fillText(e.name,0,0),t.restore());let i=45;if(!e.isDead&&1>e.health){let s=function(a){t.globalAlpha=a<.05?a/.05:1};var r=s;t.save(),t.globalAlpha=e.hpAlpha,t.strokeStyle="#222",t.beginPath();let o;if(e instanceof Ie)o=5,t.translate(0,e.size),t.translate(-i/2,9/2+5);else if(e instanceof J){o=6.5;let{collision:{radius:a,fraction:l}}=fs[e.type],h=a*2*(e.size/l)/30;t.scale(h,h),t.translate(-i/2,25)}t.beginPath(),t.moveTo(0,0),t.lineTo(i,0),t.lineCap="round",t.lineWidth=o,t.strokeStyle="#222",t.stroke(),e.redHealth>0&&(s(e.redHealth),t.beginPath(),t.moveTo(0,0),t.lineTo(i*e.redHealth,0),t.lineWidth=o*.44,t.strokeStyle="#f22",t.stroke()),e.health>0&&(s(e.health),t.beginPath(),t.moveTo(0,0),t.lineTo(i*e.health,0),t.lineWidth=o*.66,t.strokeStyle="#75dd34",t.stroke()),t.restore()}}};var vt=class extends De{render(t){}drawDeadEyes({ctx:t},e,i){t.beginPath(),t.moveTo(e-4,i-4),t.lineTo(e+4,i+4),t.moveTo(e+4,i-4),t.lineTo(e-4,i+4),t.lineWidth=3,t.lineCap="round",t.strokeStyle="#000000",t.stroke(),t.closePath()}};var fn=Math.PI*2,Zt=class extends vt{render(t){let{ctx:e,entity:i}=t,{eyeX:r,eyeY:o,isDead:s,sadT:a,angryT:l}=i;if(e.save(),e.lineCap="round",e.fillStyle="#ffe763",e.lineWidth=2,e.strokeStyle="#cebb50",e.beginPath(),e.moveTo(27,-.5),e.quadraticCurveTo(19,35,4,25.5),e.quadraticCurveTo(-21,18,-23,5),e.quadraticCurveTo(-27,-32,-1,-23),e.quadraticCurveTo(18,-24,27,-.5),e.fill(),e.stroke(),e.closePath(),e.restore(),s)this.drawDeadEyes(t,11,8),this.drawDeadEyes(t,-10,-8);else{var u=[];try{let f=ze(u,this.guard(e));e.beginPath();this.drawEyeOutline(t,.7);this.drawEyeOutline(t,0);e.clip();e.beginPath();e.arc(11+r*2,8+o*3.5,3.1,0,fn);e.moveTo(-8,-5);e.arc(-10+-r*2,-8+-o*3.5,3.1,0,fn);e.fillStyle="#eee";e.fill()}catch(c){var p=c,d=!0}finally{We(u,p,d)}}let h=l*-10.5+a*-9;e.beginPath(),e.translate(-7,8),e.rotate(.5),e.moveTo(-3,0),e.quadraticCurveTo(0,5.5+h,3,0),e.lineCap="round",e.strokeStyle="#000000",e.lineWidth=1.5,e.stroke()}drawEyeOutline({ctx:t},e=0){t.beginPath(),t.ellipse(11,8,2.5+e,6+e,-.15,0,fn),t.moveTo(-8,-5),t.ellipse(-10,-8,2.5+e,6+e,-.15,0,fn),t.strokeStyle=t.fillStyle="#111111",t.fill()}};var Jt=Math.PI*2,ei=class extends vt{render(t){let{ctx:e,entity:i}=t,{eyeX:r,eyeY:o,isDead:s,sadT:a,angryT:l}=i;e.fillStyle=this.calculateDamageEffectColor(t,"#ffe763"),e.lineWidth=2.75,e.strokeStyle=this.calculateDamageEffectColor(t,"#cfbb50"),e.beginPath(),e.arc(0,0,25,0,Jt),e.fill(),e.stroke();let h=l*6;if(s)this.drawDeadEyes(t,7,-5),this.drawDeadEyes(t,-7,-5);else{var c=[];try{let m=ze(c,this.guard(e));e.beginPath();this.drawEyeShape(t,7,-5,3.5999999999999996,7.3,h,1);this.drawEyeShape(t,-7,-5,3.5999999999999996,7.3,h,0);e.clip();this.drawEyeOutline(t,.7);this.drawEyeOutline(t,0);e.clip();e.beginPath();e.arc(7+r*2,-5+o*3.5,3.1,0,Jt);e.moveTo(-7,-5);e.arc(-7+r*2,-5+o*3.5,3.1,0,Jt);e.fillStyle="#eee";e.fill()}catch(p){var d=p,f=!0}finally{We(c,d,f)}}let u=l*-10.5+a*-9;e.beginPath(),e.translate(0,9.7),e.moveTo(-6.1,0),e.quadraticCurveTo(0,5.5+u,6.1,0),e.lineCap="round",e.strokeStyle="#000000",e.lineWidth=1.5,e.stroke()}drawEyeShape({ctx:t},e,i,r,o,s,a=0){let l=a^1;t.moveTo(e-r,i-o+a*s),t.lineTo(e+r,i-o+l*s+a),t.lineTo(e+r,i+o),t.lineTo(e-r,i+o),t.lineTo(e-r,i-o)}drawEyeOutline({ctx:t},e=0){t.beginPath(),t.ellipse(7,-5,2.5+e,6+e,0,0,Jt),t.moveTo(-7,-5),t.ellipse(-7,-5,2.5+e,6+e,0,0,Jt),t.strokeStyle=t.fillStyle="#111111",t.fill()}};var ti=class extends De{constructor(){super(...arguments);this.dev=new Zt;this.normal=new ei}render(e){super.render(e);let{ctx:i,entity:r}=e,o=r.size/25;i.scale(o,o),r.isDev?this.dev.render(e):this.normal.render(e)}};var ms=[15,16,17,18,19,20];var ys=Math.PI*2,D=class extends De{render(t){}drawBubble(t,e){let{ctx:i,entity:r}=t;i.rotate(r.angle);let o=r.size/20;i.scale(o,o);let s=i.globalAlpha;i.strokeStyle=i.fillStyle=this.calculateDamageEffectColor(t,"#ffffff"),i.globalAlpha=s*.4,i.save(),i.beginPath(),i.lineWidth=5,i.lineJoin=i.lineCap="round",i.arc(10,0,2,0,ys),i.stroke(),i.closePath(),i.restore(),i.beginPath(),i.arc(0,0,20,0,ys),i.fill(),i.clip(),i.globalAlpha=s*.5,i.lineWidth=e?8:3,i.stroke()}};var Hl=Math.PI*2,ge=class extends D{render(t){}drawBasicLike(t,e,i){let{ctx:r,entity:o}=t;r.rotate(o.angle);let s=o.size/20;r.scale(s,s),r.beginPath(),r.arc(0,0,20,0,Hl),r.fillStyle=this.calculateDamageEffectColor(t,e),r.fill(),r.strokeStyle=this.calculateDamageEffectColor(t,i),r.stroke()}};var ii=class extends ge{render(t){this.drawBasicLike(t,"#ffffff","#cfcfcf")}};var ni=class extends ge{render(t){this.drawBubble(t,!0)}};var Yl=Math.PI*2,ri=class extends ge{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/20;e.scale(r,r),e.beginPath(),e.ellipse(0,0,30,40,0,0,Yl),e.fillStyle=this.calculateDamageEffectColor(t,"#fff0b8"),e.fill(),e.strokeStyle=this.calculateDamageEffectColor(t,"#cfc295"),e.stroke()}};var oi=class extends ge{render(t){this.drawBasicLike(t,"#feffc9","#cecfa3")}};var ql=Math.PI*2,si=Math.PI/2,yr=Math.PI*3/2,ai=class extends ge{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/20;e.scale(r,r);let o=(s,a)=>{e.save(),e.clip(),e.lineCap="round",e.fillStyle=this.calculateDamageEffectColor(t,s),e.strokeStyle=this.calculateDamageEffectColor(t,a),e.fill(),e.stroke(),e.restore()};e.lineCap="round",e.beginPath(),e.arc(0,0,20,0,ql),o("#333333","#222222"),e.rotate(Math.PI),e.beginPath(),e.arc(0,0,20,-si,si),e.arc(0,10,10,si,yr),e.arc(0,-10,10,si,yr,!0),o("#ffffff","#cfcfcf"),e.rotate(-Math.PI),e.beginPath(),e.arc(0,10,10,si,yr),o("#333333","#222222")}};var gr=Math.PI*2,li=class extends D{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/30;e.scale(r,r);let o=this.calculateDamageEffectColor(t,"#333333"),s="#ffe763",a=we(s,de);e.lineJoin=e.lineCap="round",e.lineWidth=5,e.fillStyle="#333333",e.strokeStyle=this.calculateDamageEffectColor(t,we("#333333",de)),e.beginPath(),e.moveTo(-37,0),e.lineTo(-25,-9),e.lineTo(-25,9),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.ellipse(0,0,30,20,0,0,gr),e.fillStyle=s,e.fill();{var l=[];try{let p=ze(l,this.guard(e));e.clip();e.fillStyle=o;e.fillRect(10,-20,10,40);e.fillRect(-10,-20,10,40);e.fillRect(-30,-20,10,40)}catch(h){var u=h,c=!0}finally{We(l,u,c)}}e.beginPath(),e.ellipse(0,0,30,20,0,0,gr),e.strokeStyle=a,e.stroke();{e.strokeStyle=e.fillStyle=o,e.lineWidth=3;for(let p=-1;p<=1;p+=2)e.beginPath(),e.moveTo(25,5*p),e.quadraticCurveTo(35,5*p,40,15*p),e.stroke(),e.beginPath(),e.arc(40,15*p,5,0,gr),e.fill()}}};var Gl=Math.PI*2;function Xl(){let n=new Path2D;return n.moveTo(0,-30),n.quadraticCurveTo(40,-30,40,0),n.quadraticCurveTo(40,30,0,30),n.quadraticCurveTo(-40,30,-40,0),n.quadraticCurveTo(-40,-30,0,-30),n.closePath(),n}var gs=Xl(),hi=class extends D{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/40;e.scale(r,r);{e.fillStyle=e.strokeStyle="#333333",e.lineCap=e.lineJoin="round";for(let s=0;s<2;s++){let a=s===0?1:-1;e.save(),e.translate(34,a*12),e.rotate(Math.sin(i.moveCounter*1.24)*.1*a),e.beginPath(),e.moveTo(0,a*7),e.quadraticCurveTo(25,a*16,40,0),e.quadraticCurveTo(20,a*6,0,0),e.closePath(),e.fill(),e.stroke(),e.restore()}}{e.lineWidth=7;let s=i.isPet?"#ffe667":"#8f5db0";e.fillStyle=this.calculateDamageEffectColor(t,s),e.fill(gs),e.fillStyle=e.strokeStyle=this.calculateDamageEffectColor(t,we(s,de)),e.stroke(gs)}e.lineWidth=6,e.beginPath(),e.moveTo(-21,0),e.quadraticCurveTo(0,-3,21,0),e.lineCap="round",e.stroke();let o=[[-17,-12],[17,-12],[0,-15]];e.beginPath();for(let s=0;s<2;s++){let a=s===1?1:-1;for(let l=0;l<o.length;l++){let[h,u]=o[l];u*=a,e.moveTo(h,u),e.arc(h,u,5,0,Gl)}}e.fill(),e.fill()}};var ui=class extends D{render(t){this.drawBubble(t,!1)}};var mn=Math.PI*2,ci=class extends D{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/40;if(e.scale(r,r),this.drawCentiBody(t),i.isFirstSegment){let o=this.calculateDamageEffectColor(t,"#333333");e.strokeStyle=o,e.fillStyle=o,e.lineWidth=3;for(let s=-1;s<=1;s+=2)e.beginPath(),e.moveTo(25,10.21*s),e.quadraticCurveTo(47.54,11.62*s,55.28,30.63*s),e.stroke(),e.beginPath(),e.arc(55.28,30.63*s,5,0,mn),e.fill()}}drawCentiBody(t){let{ctx:e,entity:i}=t;e.beginPath(),e.arc(0,33,18,0,mn),e.arc(0,-33,18,0,mn),e.lineWidth=7,e.lineJoin=e.lineCap="round",e.strokeStyle=e.fillStyle=this.calculateDamageEffectColor(t,"#333333"),e.fill();let r;i.type===14?r="#d3c66d":i.type===13?r="#8f5db0":r="#8ac255",e.beginPath(),e.arc(0,0,40,0,mn),e.fillStyle=this.calculateDamageEffectColor(t,r),e.fill(),e.lineWidth=8,e.strokeStyle=this.calculateDamageEffectColor(t,we(r,de)),e.stroke()}};var bs=Math.PI*2,di=class extends D{render(t){let{ctx:e,entity:i,isSpecimen:r}=t;e.rotate(i.angle);let o=i.size/20;e.scale(o,o);let s=e.globalAlpha;e.strokeStyle=e.fillStyle=this.calculateDamageEffectColor(t,"#ffffff"),e.globalAlpha=s*.6,e.lineCap="round",e.lineWidth=2.3,e.beginPath();for(let c=0;c<10;c++){let p=c/10*bs,d=r?500:Date.now();e.save(),e.rotate(p),e.translate(17.5,0),e.moveTo(0,0);let f=Math.sin(p+d/500);e.rotate(f*.5),e.quadraticCurveTo(4,f*-2,14,0),e.restore()}e.stroke();{var a=[];try{let c=ze(a,this.guard(e));e.beginPath();e.arc(0,0,20,0,bs);e.globalAlpha=s*.5;e.fill();e.clip();e.lineWidth=3;e.stroke()}catch(l){var h=l,u=!0}finally{We(a,h,u)}}}};var jl=Math.PI*2,br=new Array;function st(n,t,e=6){t*=-1;let i=Math.cos(n),r=Math.sin(n),o=i*25,s=r*25;br.push({dir:t,start:[o,s],curve:[o+i*23+-r*t*e,s+r*23+i*t*e,o+i*46,s+r*46]})}st(Math.PI/180*45,1);st(Math.PI/180*75,1,3);st(Math.PI/180*105,-1,3);st(Math.PI/180*135,-1);st(-Math.PI/180*45,-1);st(-Math.PI/180*75,-1,3);st(-Math.PI/180*105,1,3);st(-Math.PI/180*135,1);var pi=class extends D{render(t){let{ctx:e,entity:i,isSpecimen:r}=t;e.rotate(i.angle);let o=i.size/(r?60:25);e.scale(o,o);for(let u=0;u<br.length;u++){let c=br[u];e.save(),e.rotate(c.dir*Math.sin(i.moveCounter+u)*.15),e.beginPath(),e.moveTo(...c.start),e.quadraticCurveTo(...c.curve),e.strokeStyle=this.calculateDamageEffectColor(t,"#323032"),e.lineWidth=10,e.lineCap="round",e.stroke(),e.restore()}{var s=[];try{e.fillStyle=this.calculateDamageEffectColor(t,"#4f412e");e.strokeStyle="rgba(0,0,0,0.15)";e.lineWidth=20;e.beginPath();e.arc(0,0,35,0,jl);e.fill();let u=ze(s,this.guard(e));e.clip();e.stroke()}catch(a){var l=a,h=!0}finally{We(s,l,h)}}}};var fi=Math.PI*2,mi=class extends D{render(t){let{ctx:e,entity:i,isSpecimen:r}=t;e.rotate(i.angle);let o=i.size/120;e.scale(o,o);let s=r?2e3:Date.now();e.rotate(s/2e3%fi+i.moveCounter*.4);let{STARFISH_LEG_AMOUNT:a}=J,l=i.legD,h=r?a:i.isDead?0:Math.floor(i.nHealth*a);e.beginPath();for(let u=0;u<a;u++){let c=(u+.5)/a*fi,p=(u+1)/a*fi;l[u]+=((u<h?175:105)-l[u])*.5;let d=l[u];u===0&&e.moveTo(d,0),e.quadraticCurveTo(Math.cos(c)*15,Math.sin(c)*15,Math.cos(p)*d,Math.sin(p)*d)}e.closePath(),e.lineCap=e.lineJoin="round",e.lineWidth=52,e.strokeStyle=this.calculateDamageEffectColor(t,we("#d0504e",de)),e.stroke(),e.lineWidth=26,e.strokeStyle=e.fillStyle=this.calculateDamageEffectColor(t,"#d0504e"),e.fill(),e.stroke(),e.beginPath();for(let u=0;u<a;u++){let c=u/a*fi;e.save(),e.rotate(c);let p=3,d=l[u]/175,f=56;for(let m=0;m<p;m++){let g=(1-m/p*.8)*24*d;e.moveTo(f,0),e.arc(f,0,g,0,fi),f+=g*2+d*5}e.restore()}e.fillStyle="#d3756b",e.fill()}};var $l=Math.PI*2,yi=class extends D{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/20;e.scale(r,r),e.beginPath(),e.arc(0,0,20,0,$l),e.fillStyle="#efc99b",e.fill(),e.strokeStyle="#c1a37d",e.stroke(),e.closePath()}};var gi=class extends D{render(t){let{ctx:e,entity:i,isSpecimen:r}=t,o=i.size/20;e.scale(o,o);let s=r?0:i.sandstormAngle++,a=i.isPet?"#ffe763":"#D5C7A6",l=i.isPet?"#e6d059":"#BFB295",h=i.isPet?"#cfbb50":"#A99E84";e.lineJoin="round",e.lineWidth=6,e.save(),e.rotate(s*.02),e.rotate(Math.PI/4),e.scale(-.95,.95),e.fillStyle=e.strokeStyle=this.calculateDamageEffectColor(t,a),e.beginPath(),e.moveTo(28,0),e.lineTo(14,24.24871253967285),e.lineTo(-14,24.24871063232422),e.lineTo(-28,0),e.lineTo(-14,-24.24871253967285),e.lineTo(14,-24.24871253967285),e.closePath(),e.fill(),e.stroke(),e.restore(),e.save(),e.rotate(s*-.03),e.fillStyle=e.strokeStyle=this.calculateDamageEffectColor(t,l),e.beginPath(),e.moveTo(18,0),e.lineTo(9,15.588458061218262),e.lineTo(-9,15.588457107543945),e.lineTo(-18,0),e.lineTo(-9,-15.588458061218262),e.lineTo(9,-15.588458061218262),e.closePath(),e.fill(),e.stroke(),e.restore(),e.save(),e.rotate(s*.04),e.fillStyle=e.strokeStyle=this.calculateDamageEffectColor(t,h),e.beginPath(),e.moveTo(8,0),e.lineTo(4,6.928203582763672),e.lineTo(-4,6.928203105926514),e.lineTo(-8,0),e.lineTo(-4,-6.928203582763672),e.lineTo(4,-6.928203582763672),e.closePath(),e.fill(),e.stroke(),e.restore()}};var Ye=function(){let n=new Path2D;return n.moveTo(10,0),n.lineTo(.44663524627685547,-2.955202579498291),n.lineTo(.44663524627685547,2.955203056335449),n.lineTo(10,0),n.closePath(),n}(),Ql=function(){let n=new Path2D;return n.moveTo(50,0),n.quadraticCurveTo(40.702884674072266,13.225168228149414,40.45085144042969,29.389263153076172),n.quadraticCurveTo(25.155765533447266,34.62394332885742,15.450848579406738,47.552825927734375),n.quadraticCurveTo(-1287460349885805e-21,42.797542572021484,-15.450851440429688,47.552825927734375),n.quadraticCurveTo(-25.155765533447266,34.623939514160156,-40.45085144042969,29.389259338378906),n.quadraticCurveTo(-40.702884674072266,13.225165367126465,-50,-4371138857095502e-21),n.quadraticCurveTo(-40.702884674072266,-13.225172996520996,-40.45084762573242,-29.38926887512207),n.quadraticCurveTo(-25.155765533447266,-34.62394332885742,-15.450854301452637,-47.552825927734375),n.quadraticCurveTo(8583068620282575e-22,-42.797542572021484,15.45085620880127,-47.552825927734375),n.quadraticCurveTo(25.155765533447266,-34.62394332885742,40.45084762573242,-29.389265060424805),n.quadraticCurveTo(40.702884674072266,-13.225165367126465,50,8742277714191005e-21),n.lineTo(50,0),n.closePath(),n}(),Zl=function(){let n=new Path2D;return n.moveTo(52.86328887939453,2.0128533840179443),n.quadraticCurveTo(44.1856689453125,14.356807708740234,43.95042419433594,29.443828582763672),n.quadraticCurveTo(43.93316650390625,30.550823211669922,43.28240966796875,31.446510314941406),n.quadraticCurveTo(42.631656646728516,32.34219741821289,41.58417510986328,32.7006950378418),n.quadraticCurveTo(27.308242797851562,37.586570739746094,18.249988555908203,49.653968811035156),n.quadraticCurveTo(17.585350036621094,50.539398193359375,16.532405853271484,50.88152313232422),n.quadraticCurveTo(15.479463577270508,51.2236442565918,14.42131519317627,50.897979736328125),n.quadraticCurveTo(0,46.45954895019531,-14.421318054199219,50.897979736328125),n.quadraticCurveTo(-15.479469299316406,51.22364807128906,-16.532413482666016,50.881526947021484),n.quadraticCurveTo(-17.585355758666992,50.539405822753906,-18.2499942779541,49.653968811035156),n.quadraticCurveTo(-27.30825424194336,37.58656311035156,-41.58417510986328,32.70069122314453),n.quadraticCurveTo(-42.631656646728516,32.342193603515625,-43.282413482666016,31.44650650024414),n.quadraticCurveTo(-43.93316650390625,30.550819396972656,-43.9504280090332,29.443824768066406),n.quadraticCurveTo(-44.18565368652344,14.356803894042969,-52.86328887939453,2.0128512382507324),n.quadraticCurveTo(-53.5,1.1071265935897827,-53.5,-3933906555175781e-21),n.quadraticCurveTo(-53.5,-1.1071343421936035,-52.86328887939453,-2.0128579139709473),n.quadraticCurveTo(-44.1856689453125,-14.356813430786133,-43.95042419433594,-29.44383430480957),n.quadraticCurveTo(-43.93316650390625,-30.550832748413086,-43.28240966796875,-31.446517944335938),n.quadraticCurveTo(-42.631656646728516,-32.34220504760742,-41.584171295166016,-32.70069885253906),n.quadraticCurveTo(-27.308242797851562,-37.586578369140625,-18.249998092651367,-49.653968811035156),n.quadraticCurveTo(-17.585359573364258,-50.539405822753906,-16.53241539001465,-50.881526947021484),n.quadraticCurveTo(-15.479471206665039,-51.22364807128906,-14.421321868896484,-50.897979736328125),n.quadraticCurveTo(0,-46.45954895019531,14.421323776245117,-50.897979736328125),n.quadraticCurveTo(15.479473114013672,-51.22364807128906,16.53241539001465,-50.881526947021484),n.quadraticCurveTo(17.585359573364258,-50.53940200805664,18.249998092651367,-49.653968811035156),n.quadraticCurveTo(27.308246612548828,-37.586578369140625,41.584171295166016,-32.70069885253906),n.quadraticCurveTo(42.63165283203125,-32.342201232910156,43.28240966796875,-31.446514129638672),n.quadraticCurveTo(43.933162689208984,-30.550827026367188,43.95042419433594,-29.443832397460938),n.quadraticCurveTo(44.1856689453125,-14.356796264648438,52.86328887939453,-2.01284122467041),n.quadraticCurveTo(53.5,-1.1071189641952515,53.5,9894371032714844e-21),n.quadraticCurveTo(53.5,1.107138752937317,52.86328887939453,2.012861967086792),n.lineTo(52.86328887939453,2.0128533840179443),n.closePath(),n.moveTo(47.13671112060547,-2.0128445625305176),n.lineTo(50,8742277714191005e-21),n.lineTo(47.13671112060547,2.012864112854004),n.quadraticCurveTo(37.2200927734375,-12.093551635742188,36.951271057128906,-29.334697723388672),n.lineTo(40.45084762573242,-29.389265060424805),n.lineTo(39.31752395629883,-26.077835083007812),n.quadraticCurveTo(23.003299713134766,-31.66131591796875,12.651713371276855,-45.451683044433594),n.lineTo(15.45085620880127,-47.552825927734375),n.lineTo(16.480388641357422,-44.207672119140625),n.quadraticCurveTo(0,-39.135528564453125,-16.48038673400879,-44.207672119140625),n.lineTo(-15.450854301452637,-47.552825927734375),n.lineTo(-12.651712417602539,-45.451683044433594),n.quadraticCurveTo(-23.0032958984375,-31.66131591796875,-39.31752395629883,-26.077836990356445),n.lineTo(-40.45084762573242,-29.38926887512207),n.lineTo(-36.951271057128906,-29.334699630737305),n.quadraticCurveTo(-37.2200927734375,-12.093571662902832,-47.13671112060547,2.0128490924835205),n.lineTo(-50,-4371138857095502e-21),n.lineTo(-47.13671112060547,-2.012855052947998),n.quadraticCurveTo(-37.22010803222656,12.093559265136719,-36.95127868652344,29.334693908691406),n.lineTo(-40.45085144042969,29.389259338378906),n.lineTo(-39.317527770996094,26.07782745361328),n.quadraticCurveTo(-23.0032958984375,31.661300659179688,-12.651708602905273,45.451683044433594),n.lineTo(-15.450851440429688,47.552825927734375),n.lineTo(-16.480382919311523,44.207672119140625),n.quadraticCurveTo(0,39.135528564453125,16.48038101196289,44.207672119140625),n.lineTo(15.450848579406738,47.552825927734375),n.lineTo(12.651705741882324,45.451683044433594),n.quadraticCurveTo(23.0032958984375,31.66130828857422,39.317527770996094,26.077831268310547),n.lineTo(40.45085144042969,29.389263153076172),n.lineTo(36.95127868652344,29.334697723388672),n.quadraticCurveTo(37.22010803222656,12.093557357788086,47.13671112060547,-2.0128533840179443),n.lineTo(47.13671112060547,-2.0128445625305176),n.closePath(),n}(),bi=class extends D{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/30;e.scale(r,r),e.lineJoin="round",e.fillStyle="#292929",e.save(),e.translate(36.84709930419922-64,36.847103118896484-64),e.rotate(-2.356194599949769),e.scale(.7679999578592127,.7679999578592127),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(57.99291229248047-64,26.072772979736328-64),e.rotate(-1.727876073089609),e.scale(.7679999314763519,.7679999314763519),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(81.4332275390625-64,29.78534698486328-64),e.rotate(-1.0995575482314048),e.scale(.7679999769464505,.7679999769464505),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(98.21464538574219-64,46.5667610168457-64),e.rotate(-.47123902191012434),e.scale(.7679999383800523,.7679999383800523),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(101.92723083496094-64,70.007080078125-64),e.rotate(.1570795425170259),e.scale(.767999967036611,.767999967036611),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(91.15290069580078-64,91.15289306640625-64),e.rotate(.7853980536400242),e.scale(.7679999578592127,.7679999578592127),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(70.00708770751953-64,101.92723083496094-64),e.rotate(1.4137165805001843),e.scale(.7679999314763519,.7679999314763519),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(46.566768646240234-64,98.21465301513672-64),e.rotate(2.0420351053583885),e.scale(.7679999769464505,.7679999769464505),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(29.785354614257812-64,81.43324279785156-64),e.rotate(2.670353631679669),e.scale(.7679999383800523,.7679999383800523),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.translate(26.072769165039062-64,57.992919921875-64),e.rotate(-2.984513111072767),e.scale(.767999967036611,.767999967036611),e.fill(Ye,"nonzero"),e.restore(),e.save(),e.fillStyle=this.calculateDamageEffectColor(t,"#32A852"),e.rotate(-2.356194599949769),e.scale(.7679999578592127,.7679999578592127),e.fill(Ql,"nonzero"),e.fillStyle=this.calculateDamageEffectColor(t,"#288842"),e.fill(Zl,"nonzero"),e.restore()}};var Jl=function(){let n=new Path2D;return n.moveTo(.6085600256919861,36.22243881225586),n.bezierCurveTo(.834030032157898,59.97243881225586,9.074830055236816,71.84744262695312,32.05949020385742,71.72244262695312),n.bezierCurveTo(55.044151306152344,71.59744262695312,83.05949401855469,58.722442626953125,92.48587036132812,36.222442626953125),n.bezierCurveTo(78.25892639160156,-.24285000562667847,-2.8690900802612305,-21.410219192504883,.6085600256919861,36.22243881225586),n.closePath(),n}(),eh=function(){let n=new Path2D;return n.moveTo(8.108222007751465,36.151241302490234),n.quadraticCurveTo(8.25671672821045,51.79310607910156,13.548282623291016,58.108978271484375),n.quadraticCurveTo(18.73090362548828,64.2948226928711,32.018699645996094,64.2225570678711),n.quadraticCurveTo(48.49220275878906,64.13297271728516,63.757965087890625,55.78304672241211),n.quadraticCurveTo(79.84596252441406,46.98338317871094,85.56841278076172,33.32437515258789),n.lineTo(92.48587036132812,36.222442626953125),n.lineTo(85.49881744384766,38.94844436645508),n.quadraticCurveTo(81.18331146240234,27.887290954589844,67.55020141601562,19.021472930908203),n.quadraticCurveTo(54.011810302734375,10.217248916625977,38.99715042114258,8.380192756652832),n.quadraticCurveTo(24.207897186279297,6.570713043212891,16.02060890197754,12.762636184692383),n.quadraticCurveTo(7.113079071044922,19.499269485473633,8.094919204711914,35.77069854736328),n.quadraticCurveTo(8.100666046142578,35.8657341003418,8.103991508483887,35.96088409423828),n.quadraticCurveTo(8.107316970825195,36.05603790283203,8.108221054077148,36.151241302490234),n.lineTo(8.108222007751465,36.151241302490234),n.closePath(),n.moveTo(-6.891101837158203,36.293636322021484),n.lineTo(.6085600256919861,36.22243881225586),n.lineTo(-6.877847194671631,36.674171447753906),n.quadraticCurveTo(-8.34365463256836,12.38224983215332,6.972555637359619,.7988262176513672),n.quadraticCurveTo(20.002670288085938,-9.055655479431152,40.81882858276367,-6.5087785720825195),n.quadraticCurveTo(59.27922821044922,-4.250129699707031,75.72781372070312,6.44663143157959),n.quadraticCurveTo(93.40434265136719,17.941944122314453,99.4729232788086,33.49644088745117),n.quadraticCurveTo(100.00334930419922,34.855995178222656,99.98529052734375,36.31524658203125),n.quadraticCurveTo(99.96723937988281,37.774497985839844,99.40332794189453,39.12051010131836),n.quadraticCurveTo(91.65159606933594,57.623260498046875,70.95611572265625,68.94308471679688),n.quadraticCurveTo(52.36455154418945,79.11212158203125,32.10027313232422,79.22232818603516),n.quadraticCurveTo(-6.4815673828125,79.43215942382812,-6.891101837158203,36.293636322021484),n.closePath(),n}(),th=function(){let n=new Path2D;return n.moveTo(-24.127342224121094,-3.297753095626831),n.quadraticCurveTo(-25.364002227783203,0,-24.127342224121094,3.297753095626831),n.quadraticCurveTo(-23.83646011352539,4.073432922363281,-24.17926597595215,4.827605247497559),n.quadraticCurveTo(-24.522071838378906,5.581777572631836,-25.297752380371094,5.8726582527160645),n.quadraticCurveTo(-26.07343101501465,6.163537979125977,-26.82760238647461,5.820732593536377),n.quadraticCurveTo(-27.581775665283203,5.477927207946777,-27.872657775878906,4.70224666595459),n.quadraticCurveTo(-29.635997772216797,-476837158203125e-21,-27.872657775878906,-4.70224666595459),n.quadraticCurveTo(-27.581775665283203,-5.477927207946777,-26.827604293823242,-5.820732593536377),n.quadraticCurveTo(-26.07343101501465,-6.163537979125977,-25.297752380371094,-5.8726582527160645),n.quadraticCurveTo(-24.522071838378906,-5.581777572631836,-24.17926597595215,-4.827605247497559),n.quadraticCurveTo(-23.83646011352539,-4.073432922363281,-24.127342224121094,-3.297753095626831),n.closePath(),n}(),ih=function(){let n=new Path2D;return n.moveTo(-34.28501510620117,-3.971008539199829),n.quadraticCurveTo(-36.66761779785156,476837158203125e-21,-34.28501510620117,3.971008539199829),n.quadraticCurveTo(-33.85879135131836,4.681378364562988,-34.059715270996094,5.485071182250977),n.quadraticCurveTo(-34.26063537597656,6.288763046264648,-34.97100830078125,6.7149858474731445),n.quadraticCurveTo(-35.681373596191406,7.141207695007324,-36.485069274902344,6.940284729003906),n.quadraticCurveTo(-37.288761138916016,6.739361763000488,-37.71498489379883,6.02899169921875),n.quadraticCurveTo(-41.33238220214844,0,-37.71498489379883,-6.02899169921875),n.quadraticCurveTo(-37.288761138916016,-6.739361763000488,-36.485069274902344,-6.940284729003906),n.quadraticCurveTo(-35.681373596191406,-7.141207695007324,-34.97100830078125,-6.7149858474731445),n.quadraticCurveTo(-34.26063537597656,-6.288763046264648,-34.05971145629883,-5.485071182250977),n.quadraticCurveTo(-33.85879135131836,-4.681378364562988,-34.28501510620117,-3.971008539199829),n.closePath(),n}(),vi=class extends D{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/30;e.scale(r,r),e.lineJoin=e.lineCap="round",e.lineWidth=7;{e.save(),e.fillStyle=e.strokeStyle="#333333",e.translate(21,67.80140686035156-64),e.scale(.6628867661928461,.6628867198043205);let o=Math.sin(i.moveCounter);e.save(),e.rotate(o*.1),e.beginPath(),e.moveTo(-10,5),e.quadraticCurveTo(15,30,35,10),e.quadraticCurveTo(15,20,-10,5),e.closePath(),e.fill(),e.stroke(),e.restore(),e.save(),e.rotate(o*-.1),e.beginPath(),e.moveTo(-10,-5),e.quadraticCurveTo(15,-30,35,-10),e.quadraticCurveTo(15,-20,-10,-5),e.closePath(),e.fill(),e.stroke(),e.restore(),e.restore()}{e.save(),e.translate(67.80140686035156-64,67.80140686035156-64),e.scale(.7679999578592127,.7679999578592127);{e.strokeStyle="#333333";let o=35;e.beginPath();for(let s=0;s<8;s++){let a=(.25+s%4/3*.4)*Math.PI+Math.sin(s+i.moveCounter*1.3)*.2;s>=4&&(a*=-1),e.moveTo(0,0),e.lineTo(Math.cos(a)*o,Math.sin(a)*o)}e.stroke()}e.beginPath(),e.moveTo(0,-30),e.quadraticCurveTo(40,-20,40,0),e.quadraticCurveTo(40,20,0,30),e.quadraticCurveTo(-40,35,-40,0),e.quadraticCurveTo(-40,-35,0,-30),e.closePath(),e.fillStyle=this.calculateDamageEffectColor(t,"#C69A2D"),e.strokeStyle=this.calculateDamageEffectColor(t,"#9E7C24"),e.lineWidth=7,e.fill(),e.stroke(),e.lineWidth=7,e.strokeStyle=this.calculateDamageEffectColor(t,"#9E7C24"),e.beginPath(),e.moveTo(22,-12),e.quadraticCurveTo(26,0,22,12),e.stroke(),e.beginPath(),e.moveTo(7,-18),e.quadraticCurveTo(10.5,0,7,18),e.stroke(),e.beginPath(),e.moveTo(-7,-18),e.quadraticCurveTo(-10.5,0,-7,18),e.stroke(),e.beginPath(),e.moveTo(-22,-15),e.quadraticCurveTo(-27,0,-22,15),e.stroke(),e.restore()}e.save(),e.translate(-34,-7),e.scale(.30719998103634244,.30719998103634244),e.fillStyle=this.calculateDamageEffectColor(t,"#DBAB32"),e.fill(Jl,"nonzero"),e.fillStyle=this.calculateDamageEffectColor(t,"#B18B28"),e.fill(eh,"nonzero"),e.restore(),e.save(),e.translate(67.80140686035156-64,67.80140686035156-64),e.scale(.7679999578592127,.7679999578592127),e.fillStyle=this.calculateDamageEffectColor(t,"#B18B28"),e.fill(th,"nonzero"),e.fill(ih,"nonzero"),e.restore(),e.save(),e.lineWidth=4,e.fillStyle="#333333",e.strokeStyle="#292929",e.translate(-5,67.80140686035156-64),e.scale(.7679999578592127,.7679999578592127),e.beginPath(),e.moveTo(3.5,0),e.lineTo(-3.5,-7),e.lineTo(-3.5,7),e.closePath(),e.fill(),e.stroke(),e.restore()}};var vr=Math.PI*2,nh=3,vs=1,rh=10,Cs=25;function oh(n,t){let e=Math.sin(n*9999+t)*1e4,i=e-Math.floor(e);return[i*3%1,(i*3+1)%1,(i*3+2)%1]}var Ts=function(){let n=new Path2D;return n.moveTo(24.760068893432617,16.939273834228516),n.quadraticCurveTo(17.74359130859375,27.195228576660156,5.530137062072754,29.485885620117188),n.quadraticCurveTo(-6.683317184448242,31.77654266357422,-16.939273834228516,24.760068893432617),n.quadraticCurveTo(-27.195228576660156,17.74359130859375,-29.485885620117188,5.530137062072754),n.quadraticCurveTo(-31.77654266357422,-6.683317184448242,-24.760068893432617,-16.939273834228516),n.quadraticCurveTo(-17.74359130859375,-27.195228576660156,-5.530137062072754,-29.485885620117188),n.quadraticCurveTo(6.683317184448242,-31.77654266357422,16.939273834228516,-24.760068893432617),n.quadraticCurveTo(19.241104125976562,-23.185302734375,21.213199615478516,-21.213207244873047),n.quadraticCurveTo(23.18529510498047,-19.241111755371094,24.76006507873535,-16.939281463623047),n.quadraticCurveTo(10,0,24.760068893432617,16.939273834228516),n.closePath(),n}(),sh=function(){let n=new Path2D;return n.moveTo(27.64874267578125,18.915523529052734),n.quadraticCurveTo(19.813682556152344,30.36800765991211,6.175320625305176,32.925907135009766),n.quadraticCurveTo(-7.463029861450195,35.48381042480469,-18.91551971435547,27.648746490478516),n.quadraticCurveTo(-30.36800765991211,19.813682556152344,-32.925907135009766,6.175320625305176),n.quadraticCurveTo(-35.48381042480469,-7.463029861450195,-27.648746490478516,-18.91551971435547),n.quadraticCurveTo(-19.813682556152344,-30.36800765991211,-6.175320625305176,-32.925907135009766),n.quadraticCurveTo(7.463029861450195,-35.48381042480469,18.91551971435547,-27.648746490478516),n.quadraticCurveTo(24.10110092163086,-24.101102828979492,27.648740768432617,-18.915529251098633),n.quadraticCurveTo(28.323867797851562,-17.928699493408203,28.25410270690918,-16.73506736755371),n.quadraticCurveTo(28.18433952331543,-15.541435241699219,27.398849487304688,-14.639973640441895),n.quadraticCurveTo(14.642288208007812,0,27.398853302001953,14.639965057373047),n.quadraticCurveTo(28.184345245361328,15.541427612304688,28.254108428955078,16.735061645507812),n.quadraticCurveTo(28.323871612548828,17.928693771362305,27.64874267578125,18.9155216217041),n.lineTo(27.64874267578125,18.915523529052734),n.closePath(),n.moveTo(21.871395111083984,14.963025093078613),n.lineTo(24.760068893432617,16.939273834228516),n.lineTo(22.12128448486328,19.238582611083984),n.quadraticCurveTo(5.3577117919921875,0,22.121280670166016,-19.238590240478516),n.lineTo(24.76006507873535,-16.939281463623047),n.lineTo(21.871389389038086,-14.963033676147461),n.quadraticCurveTo(19.065046310424805,-19.0650577545166,14.96302318572998,-21.871395111083984),n.quadraticCurveTo(5.903592586517334,-28.06928253173828,-4.884955406188965,-26.045866012573242),n.quadraticCurveTo(-15.673511505126953,-24.022449493408203,-21.871395111083984,-14.96302318572998),n.quadraticCurveTo(-28.06928253173828,-5.903592586517334,-26.045866012573242,4.884955406188965),n.quadraticCurveTo(-24.022449493408203,15.673511505126953,-14.96302318572998,21.871395111083984),n.quadraticCurveTo(-5.903592586517334,28.06928253173828,4.884955406188965,26.045866012573242),n.quadraticCurveTo(15.673511505126953,24.022449493408203,21.871395111083984,14.963025093078613),n.closePath(),n}(),Ci=class extends D{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/30;e.scale(r,r),e.lineJoin="round";let o=this.calculateDamageEffectColor(t,"#EBEB34"),s=this.calculateDamageEffectColor(t,"#0E0E0E"),a=this.calculateDamageEffectColor(t,"#111111");e.fillStyle=s,e.beginPath(),e.arc(15,0,18.5,0,vr,!1),e.fill(),e.fillStyle=a,e.beginPath(),e.arc(15,0,11.5,0,vr,!1),e.fill(),e.fillStyle=o,e.fill(Ts,"nonzero"),e.save(),e.clip(Ts),e.fillStyle=a,e.strokeStyle=s;for(let l=0;l<nh;l++){let[h,u,c]=oh(i.id,l),p=(h*2-1)*Cs,d=(u*2-1)*Cs,f=vs+c*(rh-vs);e.beginPath(),e.arc(p,d,f,0,vr,!1),e.fill()}e.restore(),e.fillStyle=this.calculateDamageEffectColor(t,"#BEBE2A"),e.fill(sh,"nonzero")}};var ah=function(){let n=new Path2D;return n.moveTo(-3.5,10),n.lineTo(-3.5,0),n.quadraticCurveTo(-3.5,-.45682066679000854,-3.382748603820801,-.898337721824646),n.quadraticCurveTo(-3.2654974460601807,-1.3398547172546387,-3.038851022720337,-1.7364861965179443),n.lineTo(.9611489772796631,-8.736486434936523),n.quadraticCurveTo(1.6804250478744507,-9.995218276977539,3.0790889263153076,-10.376672744750977),n.quadraticCurveTo(4.477752685546875,-10.758126258850098,5.736486434936523,-10.038850784301758),n.quadraticCurveTo(6.9952192306518555,-9.319574356079102,7.376672744750977,-7.920910358428955),n.quadraticCurveTo(7.758126258850098,-6.522246360778809,7.038850784301758,-5.263513565063477),n.lineTo(3.038851022720337,1.7364861965179443),n.lineTo(0,0),n.lineTo(3.5,0),n.lineTo(3.5,10),n.quadraticCurveTo(3.499999761581421,11.449747085571289,2.4748735427856445,12.474872589111328),n.quadraticCurveTo(1.4497473239898682,13.499999046325684,0,13.5),n.quadraticCurveTo(-1.4497473239898682,13.499999046325684,-2.4748735427856445,12.474872589111328),n.quadraticCurveTo(-3.499999761581421,11.449747085571289,-3.5,10),n.closePath(),n.moveTo(-3.001225233078003,1.8007349967956543),n.lineTo(-9.001225471496582,-8.199264526367188),n.quadraticCurveTo(-9.747114181518555,-9.442412376403809,-9.395498275756836,-10.84887409210205),n.quadraticCurveTo(-9.043882369995117,-12.255335807800293,-7.800734996795654,-13.001225471496582),n.quadraticCurveTo(-6.557586193084717,-13.747113227844238,-5.151124954223633,-13.39549732208252),n.quadraticCurveTo(-3.7446634769439697,-13.043882369995117,-2.998774766921997,-11.800735473632812),n.lineTo(3.001225233078003,-1.8007349967956543),n.quadraticCurveTo(3.7471137046813965,-.5575867295265198,3.395498275756836,.8488747477531433),n.quadraticCurveTo(3.0438828468322754,2.255336284637451,1.8007349967956543,3.001225233078003),n.quadraticCurveTo(.5575867295265198,3.7471137046813965,-.8488747477531433,3.395498275756836),n.quadraticCurveTo(-2.255336284637451,3.0438828468322754,-3.001225233078003,1.8007349967956543),n.closePath(),n}(),lh=function(){let n=new Path2D;return n.moveTo(-1.5,10),n.lineTo(-1.5,0),n.quadraticCurveTo(-1.5,-.19578027725219727,-1.4497493505477905,-.38500186800956726),n.quadraticCurveTo(-1.3994989395141602,-.5742234587669373,-1.302364706993103,-.7442083954811096),n.lineTo(2.6976351737976074,-7.744208335876465),n.quadraticCurveTo(3.0058960914611816,-8.28366470336914,3.605323553085327,-8.447145462036133),n.quadraticCurveTo(4.204751014709473,-8.610625267028809,4.744208335876465,-8.302364349365234),n.quadraticCurveTo(5.283665180206299,-7.994102954864502,5.447145462036133,-7.3946757316589355),n.quadraticCurveTo(5.610625267028809,-6.795248031616211,5.302364826202393,-6.255791664123535),n.lineTo(1.302364706993103,.7442083954811096),n.lineTo(0,0),n.lineTo(1.5,0),n.lineTo(1.5,10),n.quadraticCurveTo(1.5,10.621319770812988,1.0606601238250732,11.060659408569336),n.quadraticCurveTo(.6213203072547913,11.5,0,11.5),n.quadraticCurveTo(-.6213203072547913,11.5,-1.0606601238250732,11.060659408569336),n.quadraticCurveTo(-1.5,10.621319770812988,-1.5,10),n.closePath(),n.moveTo(-1.2862393856048584,.7717435956001282),n.lineTo(-7.2862396240234375,-9.228256225585938),n.quadraticCurveTo(-7.605905532836914,-9.76103401184082,-7.45521354675293,-10.363802909851074),n.quadraticCurveTo(-7.304521560668945,-10.966571807861328,-6.7717437744140625,-11.286239624023438),n.quadraticCurveTo(-6.2389655113220215,-11.605905532836914,-5.636196136474609,-11.455212593078613),n.quadraticCurveTo(-5.033426761627197,-11.304520606994629,-4.7137603759765625,-10.771743774414062),n.lineTo(1.2862393856048584,-.7717435956001282),n.quadraticCurveTo(1.6059060096740723,-.23896579444408417,1.4552136659622192,.3638034462928772),n.quadraticCurveTo(1.3045213222503662,.966572642326355,.7717435956001282,1.2862393856048584),n.quadraticCurveTo(.23896579444408417,1.6059060096740723,-.3638034462928772,1.4552136659622192),n.quadraticCurveTo(-.966572642326355,1.3045213222503662,-1.2862393856048584,.7717435956001282),n.closePath(),n}(),Ti=class extends ge{render(t){let{ctx:e,entity:i}=t;e.rotate(i.angle);let r=i.size/10;e.scale(r,r),e.lineJoin="round",e.fillStyle=this.calculateDamageEffectColor(t,"#654A19"),e.fill(ah,"nonzero"),e.fillStyle=this.calculateDamageEffectColor(t,"#7D5B1F"),e.fill(lh,"nonzero")}};var xi=class extends D{render(t){let{ctx:e,entity:i,isSpecimen:r}=t;e.rotate(i.angle);let o=i.size/(r?25:20);e.scale(o,o),e.lineWidth=5,e.lineJoin=e.lineCap="round",e.fillStyle=e.strokeStyle=this.calculateDamageEffectColor(t,"#CCB36D"),e.beginPath(),e.moveTo(-20,-15),e.quadraticCurveTo(-15,0,-20,15),e.lineTo(0,3),e.lineTo(0,-3),e.closePath(),e.fill(),e.stroke(),e.fillStyle=this.calculateDamageEffectColor(t,"#FCDD86"),e.beginPath(),e.arc(0,0,30,-1.2566370964050293,1.2566370964050293,!1),e.quadraticCurveTo(0,20,-15,8),e.quadraticCurveTo(-20,0,-15,-8),e.quadraticCurveTo(0,-20,9.270508766174316,-28.531696319580078),e.closePath(),e.fill(),e.stroke();{e.lineWidth=4;for(let s=-1;s<=1;s+=2)e.beginPath(),e.moveTo(12,15*s),e.quadraticCurveTo(0,8*s,-8,5*s),e.stroke(),e.beginPath(),e.moveTo(17.399999618530273,6*s),e.quadraticCurveTo(0,3.200000047683716*s,-6.199999809265137,2*s),e.stroke()}}};var Cr=new ci,uh={1:new pi,0:new li,2:new hi,3:new gi,4:new bi,5:new vi,6:new Ci,7:new mi,8:new di,9:new ui,10:new yi,11:new xi,12:Cr,14:Cr,13:Cr,15:new ii,16:new oi,18:new ni,17:new ri,19:new ai,20:new Ti},Si=class extends De{render(t){super.render(t);let{ctx:e,entity:i}=t;e.lineWidth=6,uh[i.type].render(t)}};var Tr=new Map;Tr.set(Ie,new ti);Tr.set(J,new Si);function ch(n){return Tr.get(n)}function qe(n){let{entity:t,ctx:e}=n,i=ch(t.constructor);i&&i.isRenderingCandidate(n)&&(e.save(),i.render(n),e.restore())}var xr=Math.PI*2,Sr=3/40*(3+Math.cbrt(1187-Math.sqrt(110)*80)+Math.cbrt(1187+Math.sqrt(110)*80)),wr=class n{static bounceOut(t,e,i,r){let o=t/r;if(o<1/2.75)return i*(7.5625*o*o)+e;if(o<2/2.75){let a=o-.5454545454545454;return i*(7.5625*a*a+.75)+e}if(o<2.5/2.75){let a=o-.8181818181818182;return i*(7.5625*a*a+.9375)+e}let s=o-2.625/2.75;return i*(7.5625*s*s+.984375)+e}static elastic(t,e,i,r,o,s){if(t===0)return e;if((t/=r)===1)return e+i;s=s||r*.3;let a=s/xr*Math.asin(i/o);return o<Math.abs(i)&&(o=i,a=s/4),o*Math.pow(2,-10*t)*Math.sin((t*r-a)*xr/s)+i+e}static{this.functions={linear:(t,e,i,r)=>i*(t/r)+e,easeInQuad:(t,e,i,r)=>i*(t/=r)*t+e,easeOutQuad:(t,e,i,r)=>-i*(t/=r)*(t-2)+e,easeInOutQuad:(t,e,i,r)=>(t/=r/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e,easeInCubic:(t,e,i,r)=>i*(t/=r)*t*t+e,easeOutCubic:(t,e,i,r)=>i*((t=t/r-1)*t*t+1)+e,easeInOutCubic:(t,e,i,r)=>(t/=r/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e,easeInQuart:(t,e,i,r)=>i*(t/=r)*t*t*t+e,easeOutQuart:(t,e,i,r)=>-i*((t=t/r-1)*t*t*t-1)+e,easeInOutQuart:(t,e,i,r)=>(t/=r/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e,easeInQuint:(t,e,i,r)=>i*(t/=r)*t*t*t*t+e,easeOutQuint:(t,e,i,r)=>i*((t=t/r-1)*t*t*t*t+1)+e,easeInOutQuint:(t,e,i,r)=>(t/=r/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e,easeInSine:(t,e,i,r)=>-i*Math.cos(t/r*(Math.PI/2))+i+e,easeOutSine:(t,e,i,r)=>i*Math.sin(t/r*(Math.PI/2))+e,easeInOutSine:(t,e,i,r)=>-i/2*(Math.cos(Math.PI*t/r)-1)+e,easeInExpo:(t,e,i,r)=>t===0?e:i*Math.pow(2,10*(t/r-1))+e,easeOutExpo:(t,e,i,r)=>t===r?e+i:i*(-Math.pow(2,-10*t/r)+1)+e,easeInOutExpo:(t,e,i,r)=>t===0?e:t===r?e+i:(t/=r/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e,easeInCirc:(t,e,i,r)=>-i*(Math.sqrt(1-(t/=r)*t)-1)+e,easeOutCirc:(t,e,i,r)=>i*Math.sqrt(1-(t=t/r-1)*t)+e,easeInOutCirc:(t,e,i,r)=>(t/=r/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInBack:(t,e,i,r,o=Sr)=>i*(t/=r)*t*((o+1)*t-o)+e,easeOutBack:(t,e,i,r,o=Sr)=>i*((t=t/r-1)*t*((o+1)*t+o)+1)+e,easeInOutBack:(t,e,i,r,o=Sr)=>(t/=r/2)<1?i/2*(t*t*(((o*=1.525)+1)*t-o))+e:i/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+e,easeInBounce:(t,e,i,r)=>i-n.bounceOut(r-t,0,i,r)+e,easeOutBounce:n.bounceOut,easeInOutBounce:(t,e,i,r)=>t<r/2?n.functions.easeInBounce(t*2,0,i,r)*.5+e:n.functions.easeOutBounce(t*2-r,0,i,r)*.5+i*.5+e,easeOutElastic:(t,e,i,r)=>n.elastic(t,e,i,r,i,r*.3),easeInElastic:(t,e,i,r)=>-(i*Math.pow(2,10*(t/r-1))*Math.sin((t*r-.3)*xr/(r*.3))),easeInOutElastic:(t,e,i,r)=>t<r/2?n.functions.easeInElastic(t*2,e,i/2,r):n.functions.easeOutElastic(t*2-r,e+i/2,i/2,r)}}},xs=wr.functions;function Er(n,t,e){return n+(t-n)*Math.min(1,W/e)}var wi=class{get isInterpolating(){return this.interpolation.startTime?Date.now()-this.interpolation.startTime<=this.options.duration:!1}constructor(t={}){this.oldValue=null,this.lastUpdatedAt=null,this.currentValue=0,this.interpolation={startTime:null,startValue:NaN,endValue:NaN},this.options={easingType:"easeLinear",duration:1e3,initValue:null,range:null,...t},typeof this.options.initValue=="number"&&this.setValue(this.options.initValue)}setValue(t){if(typeof this.oldValue=="number"){if(this.currentValue===t)return;this.oldValue=this.currentValue}else this.oldValue=t;this.currentValue=t,this.lastUpdatedAt=Date.now();let e=this.getInterpolatedValue();this.interpolation.startValue=this.oldValue,this.interpolation.startTime&&Date.now()-this.interpolation.startTime<this.options.duration&&(this.interpolation.startValue=e),this.interpolation.endValue=this.currentValue,this.interpolation.startTime=Date.now(),this.handleRangeWrapping()}handleRangeWrapping(){if(typeof this.options.range!="number")return;let t=this.interpolation.endValue-this.interpolation.startValue,e=this.options.range/2;Math.abs(t)>=e&&(this.interpolation.endValue<=e?this.interpolation.startValue>=0&&(this.interpolation.endValue+=this.options.range):this.interpolation.startValue>=0&&(this.interpolation.startValue+=this.options.range))}getValue(){return this.currentValue}getOldValue(){return this.oldValue}getInterpolatedValue(){return this.calculateInterpolatedValue()}calculateInterpolatedValue(){if(typeof this.oldValue!="number")throw new TypeError("Cannot calculate interpolated value: Old value is not set");if(this.options.duration===0)return this.currentValue;if(!this.interpolation.startTime)return this.currentValue;let t=Date.now()-this.interpolation.startTime;t=Math.max(0,Math.min(t,this.options.duration));let e=this.interpolation.endValue-this.interpolation.startValue,i=xs[this.options.easingType](t,this.interpolation.startValue,e,this.options.duration);return typeof this.options.range=="number"&&(i%=this.options.range),i}};var Ge=class n{static{this.PREFIX="flooooio_"}static{this.DEFAULT_SETTINGS={keyboard_control:!1,movement_helper:!1}}static getFullKey(t){return this.PREFIX+t}static boolToSettingValue(t){return t?"Y":"N"}static settingValueToBool(t){return t==="Y"}static get(t){let e=this.getFullKey(t),i=localStorage.getItem(e);return i===null?(this.set(t,!1),!1):this.settingValueToBool(i)}static set(t,e){let i=this.getFullKey(t);localStorage.setItem(i,this.boolToSettingValue(e))}static remove(t){let e=this.getFullKey(t);localStorage.removeItem(e)}static clear(){Object.keys(localStorage).filter(t=>t.startsWith(this.PREFIX)).forEach(t=>localStorage.removeItem(t))}static getAllSettings(){return Object.keys(localStorage).filter(t=>t.startsWith(this.PREFIX)).reduce((t,e)=>({...t,[e.replace(this.PREFIX,"")]:this.settingValueToBool(localStorage.getItem(e))}),n.DEFAULT_SETTINGS)}};var Ss={0:"Garden",1:"Desert",2:"Ocean"},ws={0:"#1ea761",1:"#ecdcb8",2:"#4e77a7"};var Es={0:"#7eef6d",1:"#ffe65d",2:"#4d52e3",3:"#861fde",4:"#de1f1f",5:"#1fdbde",6:"#ff2b75"};var dh=Re(n=>25*Math.floor(n*Math.pow(1.05,n-1))),tp=Re(n=>{let t=1;for(;dh(t)<=n;)t++;return t-1}),Ms=n=>Math.max(60,n**.2*18.9287+30),Ar=[6e4,15e3,2500,100,5,.1,.001],ip=(()=>{let n=new Array(Ar.length).fill(0),t=Ar.reduce((i,r)=>i+r,0),e=0;for(let i=0;i<n.length;i++)n[i]=e/t,e+=Ar[i];return n})();var np=5;var Pe=Re(n=>n/8.333333830038736),Rs,Is,A=class n extends(Is=v,Rs=ne,Is){constructor(e,i,r,o="#ffffff",s="center",a=null,l=!1,h){super();this.layoutOptions=e;this.text=i;this.fontSize=r;this.fillStyle=o;this.textAlign=s;this.wordWrapMaxWidth=a;this[Rs]=!1;if(l&&!h)throw new Error("Text: text is copyable, but source string is not computable");l&&(this[ne]=!0);let u=!1;this.on("onFocus",()=>{v.computePointerLike(l)&&(this.context.canvas.style.cursor="pointer",u=!0)}),this.on("onBlur",()=>{v.computePointerLike(l)&&(this.context.canvas.style.cursor="default",u=!1)}),this.on("onClick",()=>{if(!u)return;let c=v.computePointerLike(h);navigator.clipboard.writeText(c).then(()=>this.emit("onCopySucceed"),()=>this.emit("onCopyFailed"))})}static{this.TEXT_WIDTH_OFFSET=10}static{this.LINE_HEIGHT_MULTIPLIER=1.4}getWrappedLines(e,i,r){let o=i.split(" "),s=new Array,a=o[0];for(let l=1;l<o.length;l++){let h=o[l];e.measureText(a+" "+h).width<r?a+=" "+h:(s.push(a),a=h)}return s.push(a),s}calculateSize(e){let i=v.computePointerLike(this.fontSize),r=v.computePointerLike(this.text),o=v.computePointerLike(this.textAlign),s=v.computePointerLike(this.wordWrapMaxWidth);e.save(),e.textAlign=o,e.font=`${i}px Ubuntu`;let{LINE_HEIGHT_MULTIPLIER:a,TEXT_WIDTH_OFFSET:l}=n,h,u;if(s){let c=this.getWrappedLines(e,r,s),p=i*a;h=s,u=p*c.length}else{let c=e.measureText(r);h=c.width+(o==="center"?l:0),u=c.fontBoundingBoxAscent+c.fontBoundingBoxDescent}return e.restore(),{w:h,h:u}}layout(e){let{ctx:i}=e;return X.layout(Object.assign(this.calculateSize(i),v.computePointerLike(this.layoutOptions)),e)}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v,{ctx:r}=e;return super.getCacheKey(e)+i+Object.values(v.computePointerLike(this.layoutOptions)).join(i)+i+Object.values(this.calculateSize(r)).join(i)}invalidateLayoutCache(){this.layoutCache.invalidate()}render(e){super.render(e),e.save();let i=v.computePointerLike(this.fillStyle),r=v.computePointerLike(this.fontSize),o=v.computePointerLike(this.text),s=v.computePointerLike(this.textAlign),a=v.computePointerLike(this.wordWrapMaxWidth);e.lineJoin="round",e.lineCap="round",e.textBaseline="middle",e.textAlign=s,e.fillStyle=i,e.strokeStyle="#000000",e.font=`${r}px Ubuntu`,e.lineWidth=Pe(r);let l=this.x;switch(s){case"center":l+=this.w/2;break;case"right":l+=this.w;break;case"left":default:break}let{LINE_HEIGHT_MULTIPLIER:h}=n;if(a){let u=this.getWrappedLines(e,o,a),c=r*h;u.forEach((p,d)=>{let f=this.y+c*(d+.5);e.strokeText(p,l,f),e.fillText(p,l,f)})}else{let u=this.y+this.h/2;e.strokeText(o,l,u),e.fillText(o,l,u)}e.restore()}};var Xe=new Array,at=class extends v{constructor(e,i){super();this.layoutOptions=e;this._canvas=i.canvas,this._ctx=this._canvas?this._canvas.getContext("2d"):null,this.value=(i.value||i.placeHolder||"")+"",this.fontSize=i.fontSize||14,this.fontFamily=i.fontFamily||"Arial",this.fontColor=i.fontColor||"#000",this.fontWeight=i.fontWeight||"normal",this.fontStyle=i.fontStyle||"normal",this.placeHolderColor=i.placeHolderColor||"#bfbebd",this.backgroundColor=i.backgroundColor||"#fff",this.padding=i.padding>=0?i.padding:5,this.borderWidth=i.borderWidth>=0?i.borderWidth:1,this.borderColor=i.borderColor||"#959595",this.borderRadius=i.borderRadius>=0?i.borderRadius:3,this.selectionColor=i.selectionColor||"#909090",this.readonly=i.readonly||!1,this.maxlength=i.maxlength||null,this.hasFocus=!1,this.cursorGlobalAlpha=0,this.cursorGlobalAlphaDirectionBack=!1,this.cursorPos=0,this.selection=[0,0],this.placeHolder=i.placeHolder||"",this.placeHolderUnfocused=i.placeHolderUnfocused||"",this.placeHolderDisplayUnfocusedState=i.placeHolderDisplayUnfocusedState||!1,this.onsubmit=i.onsubmit||function(){},this.onkeydown=i.onkeydown||function(){},this.onkeyup=i.onkeyup||function(){},this.onfocus=i.onfocus||function(){},this.onblur=i.onblur||function(){},this._canvas&&(this._canvas.addEventListener("mousemove",this.onmousemoveListen=r=>{this.visible&&this.mousemove(r,this)}),this._canvas.addEventListener("mousedown",this.onmousedownListen=r=>{this.visible&&this.mousedown(r,this)}),this._canvas.addEventListener("mouseup",this.onmouseupListen=r=>{this.visible&&this.mouseup(r,this)})),this._hiddenInput=document.createElement("input"),this._hiddenInput.type="text",this._hiddenInput.style.position="absolute",this._hiddenInput.style.opacity="0",this._hiddenInput.style.pointerEvents="none",this._hiddenInput.style.zIndex="0",this._hiddenInput.style.transform="scale(0)",this.maxlength&&(this._hiddenInput.maxLength=this.maxlength),document.body.appendChild(this._hiddenInput),this._hiddenInput.value=this.value,this._hiddenInput.addEventListener("keydown",r=>{this.visible&&this.hasFocus&&(this._hiddenInput.focus(),this.keydown(r,this))}),this._hiddenInput.addEventListener("keyup",r=>{this.visible&&(this.value=this._hiddenInput.value,this.cursorPos=this._hiddenInput.selectionStart,this.selection=[this._hiddenInput.selectionStart,this._hiddenInput.selectionEnd],this.hasFocus&&this.onkeyup(r,this))}),this.on("onBlur",()=>{this._canvas.style.cursor="default"}),Xe.push(this),this._inputsIndex=Xe.length-1}get value(){return this._value}set value(e){this._hiddenInput&&(this._hiddenInput.value=e),this._value=e}setW(e){this.w=e+this.padding*2+this.borderWidth*2}setH(e){this.h=e+this.padding*2+this.borderWidth*2}layout(e){return X.layout(v.computePointerLike(this.layoutOptions),e)}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v;return super.getCacheKey(e)+i+Object.values(v.computePointerLike(this.layoutOptions)).join(i)}invalidateLayoutCache(){this.layoutCache.invalidate()}render(e){super.render(e),e.save(),e.translate(this.x,this.y);let i=this.clipText();this.placeHolderDisplayUnfocusedState?this.renderPlaceholderState(i):this.renderTextInput(i),e.restore()}renderPlaceholderState(e){if(this.hasFocus){this.renderTextInput(e);return}this.setupTextContext(),this.value.length>0?this.renderFilledUnfocusedState(e):this.renderEmptyUnfocusedState()}renderFilledUnfocusedState(e){let{_ctx:i,h:r}=this;this.drawBackgroundOverlay(),i.fillStyle="#000000",i.strokeStyle="#ffffff",i.lineWidth=Pe(this.fontSize),i.translate(this.padding+this.borderWidth,r/2),i.strokeText(e,0,0),i.fillText(e,0,0)}renderEmptyUnfocusedState(){let{_ctx:e,h:i}=this;this.setupTextContext(!0),this.drawBackgroundOverlay(),e.fillStyle="#ffffff",e.strokeStyle="#000000",e.lineWidth=Pe(this.fontSize),e.translate(this.padding+this.borderWidth,i/2),e.strokeText(this.placeHolderUnfocused,0,0),e.fillText(this.placeHolderUnfocused,0,0)}drawBackgroundOverlay(){let{_ctx:e,w:i,h:r,borderRadius:o}=this;e.save(),e.globalAlpha=.4,e.fillStyle="#000000",e.beginPath(),e.roundRect(0,0,i,r,o),e.fill(),e.restore()}setupTextContext(e=!1){let{_ctx:i}=this;i.lineJoin="round",i.lineCap="round",i.font=`${this.fontStyle} ${this.fontWeight} ${this.fontSize-(e?1:0)}px ${this.fontFamily}`,i.textAlign="left",i.textBaseline="middle"}renderTextInput(e){this.drawBorder(),this.drawTextBox(()=>this.renderTextContent(e))}drawBorder(){let{_ctx:e,w:i,h:r,borderRadius:o}=this;this.borderWidth<=0||(e.fillStyle=this.borderColor,e.beginPath(),e.roundRect(0,0,i,r,o),e.fill(),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0)}renderTextContent(e){this.clearShadow(),this.selection[1]-this.selection[0]>0?this.renderSelection(e):this.renderCursor(e),this.renderText(e)}clearShadow(){let{_ctx:e}=this;e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0}renderSelection(e){let{_ctx:i,h:r}=this,o=this.padding+this.borderWidth,s=this.textWidth(e.substring(this.selection[0],this.selection[1]));i.save();let a=this.textWidth(e.substring(0,this.selection[0]));i.fillStyle=this.selectionColor;let l=r*.64,h=4;i.fillRect(o+a-h/2,(r-l)/2,s+h,l),i.restore()}renderCursor(e){let{_ctx:i,h:r}=this,o=this.padding+this.borderWidth;i.save(),i.globalAlpha=this.cursorGlobalAlpha;let s=1.8,a=12,l=this.textWidth(e.slice(0,this.cursorPos));i.fillStyle="#000000",i.fillRect(o+l-1,a/2,s,r-a);let h=s*.65;i.fillStyle="#ffffff",i.fillRect(o+l+(s-h)/2-1,a/2,h,r-a),i.restore()}renderText(e){let{_ctx:i,h:r}=this;this.setupTextContext();let o=e||this.placeHolder,s=this.value&&this.value!==this.placeHolder?this.fontColor:this.placeHolderColor,a=this.padding+this.borderWidth,l=Math.round(r/2);i.translate(0,l);for(let h=0;h<o.length;h++){let u=o[h];h>=this.selection[0]&&h<this.selection[1]?this.renderSelectedChar(u,a):this.renderNormalChar(u,a,s),a+=this.textWidth(u)}}renderSelectedChar(e,i){let{_ctx:r}=this;r.strokeStyle="#000000",r.fillStyle="#ffffff",r.lineWidth=Pe(this.fontSize),r.strokeText(e,i,0),r.fillText(e,i,0)}renderNormalChar(e,i,r){let{_ctx:o}=this;o.fillStyle=r,o.fillText(e,i,0)}destroy(){let e=Xe.indexOf(this);e!=-1&&Xe.splice(e,1),this.hasFocus&&this.blur(),this._canvas.removeEventListener("mousemove",this.onmousemoveListen),this._canvas.removeEventListener("mousedown",this.onmousedownListen),this._canvas.removeEventListener("mouseup",this.onmouseupListen),document.body.removeChild(this._hiddenInput),super.destroy()}updateCursorStyle(e){e&&(this._canvas.style.cursor=this.hasFocus?"text":"pointer")}focus(e=void 0){if(!this.hasFocus){this.onfocus(this);for(let r=0;r<Xe.length;r++)Xe[r].hasFocus&&Xe[r].blur()}this.selectionUpdated?delete this.selectionUpdated:this.selection=[0,0],this.hasFocus=!0,this.readonly?this._hiddenInput.readOnly=!0:(this._hiddenInput.readOnly=!1,this.cursorPos=typeof e=="number"?e:this.clipText().length,this.placeHolder===this.value&&(this.value="",this._hiddenInput.value=""),this.cursorInterval&&clearInterval(this.cursorInterval),this.cursorInterval=setInterval(()=>{this.cursorGlobalAlphaDirectionBack?(this.cursorGlobalAlpha-=.1,this.cursorGlobalAlpha<=0&&(this.cursorGlobalAlphaDirectionBack=!1,this.cursorGlobalAlpha=0)):(this.cursorGlobalAlpha+=.1,this.cursorGlobalAlpha>=1&&(this.cursorGlobalAlphaDirectionBack=!0,this.cursorGlobalAlpha=1))},22.5));let i=this.selection[0]>0||this.selection[1]>0;this._hiddenInput.focus(),this._hiddenInput.selectionStart=i?this.selection[0]:this.cursorPos,this._hiddenInput.selectionEnd=i?this.selection[1]:this.cursorPos}blur(){this.onblur(this),this.cursorInterval&&clearInterval(this.cursorInterval),this.hasFocus=!1,this.cursorGlobalAlpha=0,this.cursorGlobalAlphaDirectionBack=!1,this.selection=[0,0],this._hiddenInput.blur(),this.value===""&&(this.value=this.placeHolder)}keydown(e,i){let r=e.which;if(this.readonly||!this.hasFocus){e.preventDefault();return}if(r===65&&(e.ctrlKey||e.metaKey)){e.preventDefault(),this.selectText();return}if(!(r===17||e.metaKey||e.ctrlKey)){if(r===13)e.preventDefault(),this.onsubmit(e,i);else if(r===9&&(e.preventDefault(),Xe.length>1)){let o=Xe[this._inputsIndex+1]?this._inputsIndex+1:0;i.blur(),setTimeout(function(){Xe[o].focus()},10)}requestAnimationFrame(()=>{this.value=this._hiddenInput.value,this.cursorPos=this._hiddenInput.selectionStart,this.selection=[this._hiddenInput.selectionStart,this._hiddenInput.selectionEnd],this.onkeydown(e,i)})}}mousemove(e,i){let r=this.context.mouseX,o=this.context.mouseY,s=this.overInput(r,o);if(this.updateCursorStyle(s),this.hasFocus&&this.selectionStart>=0){let a=this.clickPos(r,o);s||(r<i.x?a=0:r>i.x+i.w&&(a=this.value.length));let l=Math.min(this.selectionStart,a),h=Math.max(this.selectionStart,a);(this.selection[0]!==l||this.selection[1]!==h)&&(this.selection=[l,h])}}mousedown(e,i){let r=this.context.mouseX,o=this.context.mouseY,s=this.overInput(r,o);if(this.hasFocus&&!s){i.blur();return}s&&(this.hasFocus=!0,i.focus(this.clickPos(r,o)),this.selectionStart=this.clickPos(r,o)),this.updateCursorStyle(s)}mouseup(e,i){let r=this.context.mouseX,o=this.context.mouseY,s=this.clickPos(r,o)!==this.selectionStart;this.hasFocus&&this.selectionStart>=0&&s&&(this.selectionUpdated=!0),this.hasFocus&&i.focus(this.clickPos(r,o)),delete this.selectionStart}drawTextBox(e){let i=this._ctx,r=this.w,o=this.h,s=this.borderWidth;i.fillStyle=this.backgroundColor,i.beginPath(),i.roundRect(s,s,r-s*2,o-s*2,.1),i.fill(),e()}clipText(e=void 0){e=typeof e>"u"?this.value:e;let i=this.padding+this.borderWidth,r=this.w-i*2;if(this.textWidth(e)<=r)return e;let s=0,a=e.length,l=0,h=this.textWidth(e.substring(0,this.cursorPos));if(h>r){for(let u=0;u<e.length;u++)if(l+=this.textWidth(e[u]),l+i>h-r+i*2){s=u;break}}l=0;for(let u=s;u<e.length;u++)if(l+=this.textWidth(e[u]),l>r){a=u;break}return e.substring(s,a)}textWidth(e){let i=this._ctx;return i.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,i.textAlign="left",i.fontKerning="none",i.measureText(e).width}selectText(e=void 0){e=e||[0,this.value.length],this.selection=e.slice(),this._hiddenInput.selectionStart=e[0],this._hiddenInput.selectionEnd=e[1]}overInput(e,i){let r=e>=this.x,o=e<=this.x+this.w,s=i>=this.y,a=i<=this.y+this.h;return r&&o&&s&&a}clickPos(e,i){let r=this.clipText(),o=r.length,s=e-(this.x+this.padding+this.borderWidth),a=this.textWidth(r);if(s<=0)return 0;if(s>=a)return r.length;let l=0;for(let h=0;h<r.length;h++){let u=this.textWidth(r[h]),c=l+u;if(s<=l+u/2)return h;l=c}return o}};var _=class n extends le{constructor(e,i=1,r=2,o=1,s,a,l,h){super(e,!1,()=>this.getButtonColor(),i,r,o);this.callback=a;this.buttonColor=l;this.validate=h;this.isPressed=!1;this.isHovered=!1;this.isValid=!0;this.once("onInitialized",()=>{this.addChild(new Ee({}).addChildren(...s)),s=null}),this.on("onFocus",()=>{this.isValid&&(this.context.canvas.style.cursor="pointer",this.isHovered=!0)}),this.on("onBlur",()=>{this.isValid&&(this.context.canvas.style.cursor="default",this.isHovered=!1,this.isPressed=!1)}),this.on("onClick",()=>{this.isValid&&this.callback()}),this.on("onDown",()=>{this.isValid&&(this.isPressed=!0)}),this.on("onUp",()=>{this.isValid&&(this.isPressed=!1)})}static{this.INVALID_COLOR="#aaaaa9"}render(e){super.render(e),this.isValid=v.computePointerLike(this.validate),this.isValid||(this.isHovered=!1,this.isPressed=!1)}getButtonColor(){if(!this.isValid)return n.INVALID_COLOR;let e=v.computePointerLike(this.buttonColor);return this.isPressed?we(e,.106):this.isHovered?ss(e,.1):e}};var xn=Pt(ks(),1),Sn=Pt(Ns(),1);var Fs=function(n,t){return(Fs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])})(n,t)};function Hs(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=n}Fs(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function fh(n){var t="";Array.isArray(n)||(n=[n]);for(var e=0;e<n.length;e++){var i=n[e];if(i.type===b.CLOSE_PATH)t+="z";else if(i.type===b.HORIZ_LINE_TO)t+=(i.relative?"h":"H")+i.x;else if(i.type===b.VERT_LINE_TO)t+=(i.relative?"v":"V")+i.y;else if(i.type===b.MOVE_TO)t+=(i.relative?"m":"M")+i.x+" "+i.y;else if(i.type===b.LINE_TO)t+=(i.relative?"l":"L")+i.x+" "+i.y;else if(i.type===b.CURVE_TO)t+=(i.relative?"c":"C")+i.x1+" "+i.y1+" "+i.x2+" "+i.y2+" "+i.x+" "+i.y;else if(i.type===b.SMOOTH_CURVE_TO)t+=(i.relative?"s":"S")+i.x2+" "+i.y2+" "+i.x+" "+i.y;else if(i.type===b.QUAD_TO)t+=(i.relative?"q":"Q")+i.x1+" "+i.y1+" "+i.x+" "+i.y;else if(i.type===b.SMOOTH_QUAD_TO)t+=(i.relative?"t":"T")+i.x+" "+i.y;else{if(i.type!==b.ARC)throw new Error('Unexpected command type "'+i.type+'" at index '+e+".");t+=(i.relative?"a":"A")+i.rX+" "+i.rY+" "+i.xRot+" "+ +i.lArcFlag+" "+ +i.sweepFlag+" "+i.x+" "+i.y}}return t}function Ir(n,t){var e=n[0],i=n[1];return[e*Math.cos(t)-i*Math.sin(t),e*Math.sin(t)+i*Math.cos(t)]}function Be(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];for(var e=0;e<n.length;e++)if(typeof n[e]!="number")throw new Error("assertNumbers arguments["+e+"] is not a number. "+typeof n[e]+" == typeof "+n[e]);return!0}var ht=Math.PI;function Rr(n,t,e){n.lArcFlag=n.lArcFlag===0?0:1,n.sweepFlag=n.sweepFlag===0?0:1;var i=n.rX,r=n.rY,o=n.x,s=n.y;i=Math.abs(n.rX),r=Math.abs(n.rY);var a=Ir([(t-o)/2,(e-s)/2],-n.xRot/180*ht),l=a[0],h=a[1],u=Math.pow(l,2)/Math.pow(i,2)+Math.pow(h,2)/Math.pow(r,2);1<u&&(i*=Math.sqrt(u),r*=Math.sqrt(u)),n.rX=i,n.rY=r;var c=Math.pow(i,2)*Math.pow(h,2)+Math.pow(r,2)*Math.pow(l,2),p=(n.lArcFlag!==n.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(r,2)-c)/c)),d=i*h/r*p,f=-r*l/i*p,m=Ir([d,f],n.xRot/180*ht);n.cX=m[0]+(t+o)/2,n.cY=m[1]+(e+s)/2,n.phi1=Math.atan2((h-f)/r,(l-d)/i),n.phi2=Math.atan2((-h-f)/r,(-l-d)/i),n.sweepFlag===0&&n.phi2>n.phi1&&(n.phi2-=2*ht),n.sweepFlag===1&&n.phi2<n.phi1&&(n.phi2+=2*ht),n.phi1*=180/ht,n.phi2*=180/ht}function Bs(n,t,e){Be(n,t,e);var i=n*n+t*t-e*e;if(0>i)return[];if(i===0)return[[n*e/(n*n+t*t),t*e/(n*n+t*t)]];var r=Math.sqrt(i);return[[(n*e+t*r)/(n*n+t*t),(t*e-n*r)/(n*n+t*t)],[(n*e-t*r)/(n*n+t*t),(t*e+n*r)/(n*n+t*t)]]}var $,Je=Math.PI/180;function _s(n,t,e){return(1-e)*n+e*t}function Vs(n,t,e,i){return n+Math.cos(i/180*ht)*t+Math.sin(i/180*ht)*e}function Us(n,t,e,i){var r=1e-6,o=t-n,s=e-t,a=3*o+3*(i-e)-6*s,l=6*(s-o),h=3*o;return Math.abs(a)<r?[-h/l]:function(u,c,p){p===void 0&&(p=1e-6);var d=u*u/4-c;if(d<-p)return[];if(d<=p)return[-u/2];var f=Math.sqrt(d);return[-u/2-f,-u/2+f]}(l/a,h/a,r)}function zs(n,t,e,i,r){var o=1-r;return n*(o*o*o)+t*(3*o*o*r)+e*(3*o*r*r)+i*(r*r*r)}(function(n){function t(){return r(function(a,l,h){return a.relative&&(a.x1!==void 0&&(a.x1+=l),a.y1!==void 0&&(a.y1+=h),a.x2!==void 0&&(a.x2+=l),a.y2!==void 0&&(a.y2+=h),a.x!==void 0&&(a.x+=l),a.y!==void 0&&(a.y+=h),a.relative=!1),a})}function e(){var a=NaN,l=NaN,h=NaN,u=NaN;return r(function(c,p,d){return c.type&b.SMOOTH_CURVE_TO&&(c.type=b.CURVE_TO,a=isNaN(a)?p:a,l=isNaN(l)?d:l,c.x1=c.relative?p-a:2*p-a,c.y1=c.relative?d-l:2*d-l),c.type&b.CURVE_TO?(a=c.relative?p+c.x2:c.x2,l=c.relative?d+c.y2:c.y2):(a=NaN,l=NaN),c.type&b.SMOOTH_QUAD_TO&&(c.type=b.QUAD_TO,h=isNaN(h)?p:h,u=isNaN(u)?d:u,c.x1=c.relative?p-h:2*p-h,c.y1=c.relative?d-u:2*d-u),c.type&b.QUAD_TO?(h=c.relative?p+c.x1:c.x1,u=c.relative?d+c.y1:c.y1):(h=NaN,u=NaN),c})}function i(){var a=NaN,l=NaN;return r(function(h,u,c){if(h.type&b.SMOOTH_QUAD_TO&&(h.type=b.QUAD_TO,a=isNaN(a)?u:a,l=isNaN(l)?c:l,h.x1=h.relative?u-a:2*u-a,h.y1=h.relative?c-l:2*c-l),h.type&b.QUAD_TO){a=h.relative?u+h.x1:h.x1,l=h.relative?c+h.y1:h.y1;var p=h.x1,d=h.y1;h.type=b.CURVE_TO,h.x1=((h.relative?0:u)+2*p)/3,h.y1=((h.relative?0:c)+2*d)/3,h.x2=(h.x+2*p)/3,h.y2=(h.y+2*d)/3}else a=NaN,l=NaN;return h})}function r(a){var l=0,h=0,u=NaN,c=NaN;return function(p){if(isNaN(u)&&!(p.type&b.MOVE_TO))throw new Error("path must start with moveto");var d=a(p,l,h,u,c);return p.type&b.CLOSE_PATH&&(l=u,h=c),p.x!==void 0&&(l=p.relative?l+p.x:p.x),p.y!==void 0&&(h=p.relative?h+p.y:p.y),p.type&b.MOVE_TO&&(u=l,c=h),d}}function o(a,l,h,u,c,p){return Be(a,l,h,u,c,p),r(function(d,f,m,g){var y=d.x1,C=d.x2,T=d.relative&&!isNaN(g),S=d.x!==void 0?d.x:T?0:f,N=d.y!==void 0?d.y:T?0:m;function L(Le){return Le*Le}d.type&b.HORIZ_LINE_TO&&l!==0&&(d.type=b.LINE_TO,d.y=d.relative?0:m),d.type&b.VERT_LINE_TO&&h!==0&&(d.type=b.LINE_TO,d.x=d.relative?0:f),d.x!==void 0&&(d.x=d.x*a+N*h+(T?0:c)),d.y!==void 0&&(d.y=S*l+d.y*u+(T?0:p)),d.x1!==void 0&&(d.x1=d.x1*a+d.y1*h+(T?0:c)),d.y1!==void 0&&(d.y1=y*l+d.y1*u+(T?0:p)),d.x2!==void 0&&(d.x2=d.x2*a+d.y2*h+(T?0:c)),d.y2!==void 0&&(d.y2=C*l+d.y2*u+(T?0:p));var R=a*u-l*h;if(d.xRot!==void 0&&(a!==1||l!==0||h!==0||u!==1))if(R===0)delete d.rX,delete d.rY,delete d.xRot,delete d.lArcFlag,delete d.sweepFlag,d.type=b.LINE_TO;else{var V=d.xRot*Math.PI/180,q=Math.sin(V),re=Math.cos(V),oe=1/L(d.rX),ie=1/L(d.rY),ue=L(re)*oe+L(q)*ie,Z=2*q*re*(oe-ie),G=L(q)*oe+L(re)*ie,ce=ue*u*u-Z*l*u+G*l*l,se=Z*(a*u+l*h)-2*(ue*h*u+G*a*l),xe=ue*h*h-Z*a*h+G*a*a,F=(Math.atan2(se,ce-xe)+Math.PI)%Math.PI/2,U=Math.sin(F),ye=Math.cos(F);d.rX=Math.abs(R)/Math.sqrt(ce*L(ye)+se*U*ye+xe*L(U)),d.rY=Math.abs(R)/Math.sqrt(ce*L(U)-se*U*ye+xe*L(ye)),d.xRot=180*F/Math.PI}return d.sweepFlag!==void 0&&0>R&&(d.sweepFlag=+!d.sweepFlag),d})}function s(){return function(a){var l={};for(var h in a)l[h]=a[h];return l}}n.ROUND=function(a){function l(h){return Math.round(h*a)/a}return a===void 0&&(a=1e13),Be(a),function(h){return h.x1!==void 0&&(h.x1=l(h.x1)),h.y1!==void 0&&(h.y1=l(h.y1)),h.x2!==void 0&&(h.x2=l(h.x2)),h.y2!==void 0&&(h.y2=l(h.y2)),h.x!==void 0&&(h.x=l(h.x)),h.y!==void 0&&(h.y=l(h.y)),h.rX!==void 0&&(h.rX=l(h.rX)),h.rY!==void 0&&(h.rY=l(h.rY)),h}},n.TO_ABS=t,n.TO_REL=function(){return r(function(a,l,h){return a.relative||(a.x1!==void 0&&(a.x1-=l),a.y1!==void 0&&(a.y1-=h),a.x2!==void 0&&(a.x2-=l),a.y2!==void 0&&(a.y2-=h),a.x!==void 0&&(a.x-=l),a.y!==void 0&&(a.y-=h),a.relative=!0),a})},n.NORMALIZE_HVZ=function(a,l,h){return a===void 0&&(a=!0),l===void 0&&(l=!0),h===void 0&&(h=!0),r(function(u,c,p,d,f){if(isNaN(d)&&!(u.type&b.MOVE_TO))throw new Error("path must start with moveto");return l&&u.type&b.HORIZ_LINE_TO&&(u.type=b.LINE_TO,u.y=u.relative?0:p),h&&u.type&b.VERT_LINE_TO&&(u.type=b.LINE_TO,u.x=u.relative?0:c),a&&u.type&b.CLOSE_PATH&&(u.type=b.LINE_TO,u.x=u.relative?d-c:d,u.y=u.relative?f-p:f),u.type&b.ARC&&(u.rX===0||u.rY===0)&&(u.type=b.LINE_TO,delete u.rX,delete u.rY,delete u.xRot,delete u.lArcFlag,delete u.sweepFlag),u})},n.NORMALIZE_ST=e,n.QT_TO_C=i,n.INFO=r,n.SANITIZE=function(a){a===void 0&&(a=0),Be(a);var l=NaN,h=NaN,u=NaN,c=NaN;return r(function(p,d,f,m,g){var y=Math.abs,C=!1,T=0,S=0;if(p.type&b.SMOOTH_CURVE_TO&&(T=isNaN(l)?0:d-l,S=isNaN(h)?0:f-h),p.type&(b.CURVE_TO|b.SMOOTH_CURVE_TO)?(l=p.relative?d+p.x2:p.x2,h=p.relative?f+p.y2:p.y2):(l=NaN,h=NaN),p.type&b.SMOOTH_QUAD_TO?(u=isNaN(u)?d:2*d-u,c=isNaN(c)?f:2*f-c):p.type&b.QUAD_TO?(u=p.relative?d+p.x1:p.x1,c=p.relative?f+p.y1:p.y2):(u=NaN,c=NaN),p.type&b.LINE_COMMANDS||p.type&b.ARC&&(p.rX===0||p.rY===0||!p.lArcFlag)||p.type&b.CURVE_TO||p.type&b.SMOOTH_CURVE_TO||p.type&b.QUAD_TO||p.type&b.SMOOTH_QUAD_TO){var N=p.x===void 0?0:p.relative?p.x:p.x-d,L=p.y===void 0?0:p.relative?p.y:p.y-f;T=isNaN(u)?p.x1===void 0?T:p.relative?p.x:p.x1-d:u-d,S=isNaN(c)?p.y1===void 0?S:p.relative?p.y:p.y1-f:c-f;var R=p.x2===void 0?0:p.relative?p.x:p.x2-d,V=p.y2===void 0?0:p.relative?p.y:p.y2-f;y(N)<=a&&y(L)<=a&&y(T)<=a&&y(S)<=a&&y(R)<=a&&y(V)<=a&&(C=!0)}return p.type&b.CLOSE_PATH&&y(d-m)<=a&&y(f-g)<=a&&(C=!0),C?[]:p})},n.MATRIX=o,n.ROTATE=function(a,l,h){l===void 0&&(l=0),h===void 0&&(h=0),Be(a,l,h);var u=Math.sin(a),c=Math.cos(a);return o(c,u,-u,c,l-l*c+h*u,h-l*u-h*c)},n.TRANSLATE=function(a,l){return l===void 0&&(l=0),Be(a,l),o(1,0,0,1,a,l)},n.SCALE=function(a,l){return l===void 0&&(l=a),Be(a,l),o(a,0,0,l,0,0)},n.SKEW_X=function(a){return Be(a),o(1,0,Math.atan(a),1,0,0)},n.SKEW_Y=function(a){return Be(a),o(1,Math.atan(a),0,1,0,0)},n.X_AXIS_SYMMETRY=function(a){return a===void 0&&(a=0),Be(a),o(-1,0,0,1,a,0)},n.Y_AXIS_SYMMETRY=function(a){return a===void 0&&(a=0),Be(a),o(1,0,0,-1,0,a)},n.A_TO_C=function(){return r(function(a,l,h){return b.ARC===a.type?function(u,c,p){var d,f,m,g;u.cX||Rr(u,c,p);for(var y=Math.min(u.phi1,u.phi2),C=Math.max(u.phi1,u.phi2)-y,T=Math.ceil(C/90),S=new Array(T),N=c,L=p,R=0;R<T;R++){var V=_s(u.phi1,u.phi2,R/T),q=_s(u.phi1,u.phi2,(R+1)/T),re=q-V,oe=4/3*Math.tan(re*Je/4),ie=[Math.cos(V*Je)-oe*Math.sin(V*Je),Math.sin(V*Je)+oe*Math.cos(V*Je)],ue=ie[0],Z=ie[1],G=[Math.cos(q*Je),Math.sin(q*Je)],ce=G[0],se=G[1],xe=[ce+oe*Math.sin(q*Je),se-oe*Math.cos(q*Je)],F=xe[0],U=xe[1];S[R]={relative:u.relative,type:b.CURVE_TO};var ye=function(Le,Ue){var rt=Ir([Le*u.rX,Ue*u.rY],u.xRot),Rt=rt[0],en=rt[1];return[u.cX+Rt,u.cY+en]};d=ye(ue,Z),S[R].x1=d[0],S[R].y1=d[1],f=ye(F,U),S[R].x2=f[0],S[R].y2=f[1],m=ye(ce,se),S[R].x=m[0],S[R].y=m[1],u.relative&&(S[R].x1-=N,S[R].y1-=L,S[R].x2-=N,S[R].y2-=L,S[R].x-=N,S[R].y-=L),N=(g=[S[R].x,S[R].y])[0],L=g[1]}return S}(a,a.relative?0:l,a.relative?0:h):a})},n.ANNOTATE_ARCS=function(){return r(function(a,l,h){return a.relative&&(l=0,h=0),b.ARC===a.type&&Rr(a,l,h),a})},n.CLONE=s,n.CALCULATE_BOUNDS=function(){var a=function(p){var d={};for(var f in p)d[f]=p[f];return d},l=t(),h=i(),u=e(),c=r(function(p,d,f){var m=u(h(l(a(p))));function g(U){U>c.maxX&&(c.maxX=U),U<c.minX&&(c.minX=U)}function y(U){U>c.maxY&&(c.maxY=U),U<c.minY&&(c.minY=U)}if(m.type&b.DRAWING_COMMANDS&&(g(d),y(f)),m.type&b.HORIZ_LINE_TO&&g(m.x),m.type&b.VERT_LINE_TO&&y(m.y),m.type&b.LINE_TO&&(g(m.x),y(m.y)),m.type&b.CURVE_TO){g(m.x),y(m.y);for(var C=0,T=Us(d,m.x1,m.x2,m.x);C<T.length;C++)0<(F=T[C])&&1>F&&g(zs(d,m.x1,m.x2,m.x,F));for(var S=0,N=Us(f,m.y1,m.y2,m.y);S<N.length;S++)0<(F=N[S])&&1>F&&y(zs(f,m.y1,m.y2,m.y,F))}if(m.type&b.ARC){g(m.x),y(m.y),Rr(m,d,f);for(var L=m.xRot/180*Math.PI,R=Math.cos(L)*m.rX,V=Math.sin(L)*m.rX,q=-Math.sin(L)*m.rY,re=Math.cos(L)*m.rY,oe=m.phi1<m.phi2?[m.phi1,m.phi2]:-180>m.phi2?[m.phi2+360,m.phi1+360]:[m.phi2,m.phi1],ie=oe[0],ue=oe[1],Z=function(U){var ye=U[0],Le=U[1],Ue=180*Math.atan2(Le,ye)/Math.PI;return Ue<ie?Ue+360:Ue},G=0,ce=Bs(q,-R,0).map(Z);G<ce.length;G++)(F=ce[G])>ie&&F<ue&&g(Vs(m.cX,R,q,F));for(var se=0,xe=Bs(re,-V,0).map(Z);se<xe.length;se++){var F;(F=xe[se])>ie&&F<ue&&y(Vs(m.cY,V,re,F))}}return p});return c.minX=1/0,c.maxX=-1/0,c.minY=1/0,c.maxY=-1/0,c}})($||($={}));var Ne,Ys=function(){function n(){}return n.prototype.round=function(t){return this.transform($.ROUND(t))},n.prototype.toAbs=function(){return this.transform($.TO_ABS())},n.prototype.toRel=function(){return this.transform($.TO_REL())},n.prototype.normalizeHVZ=function(t,e,i){return this.transform($.NORMALIZE_HVZ(t,e,i))},n.prototype.normalizeST=function(){return this.transform($.NORMALIZE_ST())},n.prototype.qtToC=function(){return this.transform($.QT_TO_C())},n.prototype.aToC=function(){return this.transform($.A_TO_C())},n.prototype.sanitize=function(t){return this.transform($.SANITIZE(t))},n.prototype.translate=function(t,e){return this.transform($.TRANSLATE(t,e))},n.prototype.scale=function(t,e){return this.transform($.SCALE(t,e))},n.prototype.rotate=function(t,e,i){return this.transform($.ROTATE(t,e,i))},n.prototype.matrix=function(t,e,i,r,o,s){return this.transform($.MATRIX(t,e,i,r,o,s))},n.prototype.skewX=function(t){return this.transform($.SKEW_X(t))},n.prototype.skewY=function(t){return this.transform($.SKEW_Y(t))},n.prototype.xSymmetry=function(t){return this.transform($.X_AXIS_SYMMETRY(t))},n.prototype.ySymmetry=function(t){return this.transform($.Y_AXIS_SYMMETRY(t))},n.prototype.annotateArcs=function(){return this.transform($.ANNOTATE_ARCS())},n}(),mh=function(n){return n===" "||n==="	"||n==="\r"||n===`
`},Ws=function(n){return 48<=n.charCodeAt(0)&&n.charCodeAt(0)<=57},yh=function(n){function t(){var e=n.call(this)||this;return e.curNumber="",e.curCommandType=-1,e.curCommandRelative=!1,e.canParseCommandOrComma=!0,e.curNumberHasExp=!1,e.curNumberHasExpDigits=!1,e.curNumberHasDecimal=!1,e.curArgs=[],e}return Hs(t,n),t.prototype.finish=function(e){if(e===void 0&&(e=[]),this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e},t.prototype.parse=function(e,i){var r=this;i===void 0&&(i=[]);for(var o=function(c){i.push(c),r.curArgs.length=0,r.canParseCommandOrComma=!0},s=0;s<e.length;s++){var a=e[s],l=!(this.curCommandType!==b.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),h=Ws(a)&&(this.curNumber==="0"&&a==="0"||l);if(!Ws(a)||h)if(a!=="e"&&a!=="E")if(a!=="-"&&a!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(a!=="."||this.curNumberHasExp||this.curNumberHasDecimal||l){if(this.curNumber&&this.curCommandType!==-1){var u=Number(this.curNumber);if(isNaN(u))throw new SyntaxError("Invalid number ending at "+s);if(this.curCommandType===b.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>u)throw new SyntaxError('Expected positive number, got "'+u+'" at index "'+s+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+s+'"')}this.curArgs.push(u),this.curArgs.length===gh[this.curCommandType]&&(b.HORIZ_LINE_TO===this.curCommandType?o({type:b.HORIZ_LINE_TO,relative:this.curCommandRelative,x:u}):b.VERT_LINE_TO===this.curCommandType?o({type:b.VERT_LINE_TO,relative:this.curCommandRelative,y:u}):this.curCommandType===b.MOVE_TO||this.curCommandType===b.LINE_TO||this.curCommandType===b.SMOOTH_QUAD_TO?(o({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),b.MOVE_TO===this.curCommandType&&(this.curCommandType=b.LINE_TO)):this.curCommandType===b.CURVE_TO?o({type:b.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===b.SMOOTH_CURVE_TO?o({type:b.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===b.QUAD_TO?o({type:b.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===b.ARC&&o({type:b.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!mh(a))if(a===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(a!=="+"&&a!=="-"&&a!==".")if(h)this.curNumber=a,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+s+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+a+'" at index '+s+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,a!=="z"&&a!=="Z")if(a==="h"||a==="H")this.curCommandType=b.HORIZ_LINE_TO,this.curCommandRelative=a==="h";else if(a==="v"||a==="V")this.curCommandType=b.VERT_LINE_TO,this.curCommandRelative=a==="v";else if(a==="m"||a==="M")this.curCommandType=b.MOVE_TO,this.curCommandRelative=a==="m";else if(a==="l"||a==="L")this.curCommandType=b.LINE_TO,this.curCommandRelative=a==="l";else if(a==="c"||a==="C")this.curCommandType=b.CURVE_TO,this.curCommandRelative=a==="c";else if(a==="s"||a==="S")this.curCommandType=b.SMOOTH_CURVE_TO,this.curCommandRelative=a==="s";else if(a==="q"||a==="Q")this.curCommandType=b.QUAD_TO,this.curCommandRelative=a==="q";else if(a==="t"||a==="T")this.curCommandType=b.SMOOTH_QUAD_TO,this.curCommandRelative=a==="t";else{if(a!=="a"&&a!=="A")throw new SyntaxError('Unexpected character "'+a+'" at index '+s+".");this.curCommandType=b.ARC,this.curCommandRelative=a==="a"}else i.push({type:b.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=a,this.curNumberHasDecimal=a==="."}else this.curNumber+=a,this.curNumberHasDecimal=!0;else this.curNumber+=a;else this.curNumber+=a,this.curNumberHasExp=!0;else this.curNumber+=a,this.curNumberHasExpDigits=this.curNumberHasExp}return i},t.prototype.transform=function(e){return Object.create(this,{parse:{value:function(i,r){r===void 0&&(r=[]);for(var o=0,s=Object.getPrototypeOf(this).parse.call(this,i);o<s.length;o++){var a=s[o],l=e(a);Array.isArray(l)?r.push.apply(r,l):r.push(l)}return r}}})},t}(Ys),b=function(n){function t(e){var i=n.call(this)||this;return i.commands=typeof e=="string"?t.parse(e):e,i}return Hs(t,n),t.prototype.encode=function(){return t.encode(this.commands)},t.prototype.getBounds=function(){var e=$.CALCULATE_BOUNDS();return this.transform(e),e},t.prototype.transform=function(e){for(var i=[],r=0,o=this.commands;r<o.length;r++){var s=e(o[r]);Array.isArray(s)?i.push.apply(i,s):i.push(s)}return this.commands=i,this},t.encode=function(e){return fh(e)},t.parse=function(e){var i=new yh,r=[];return i.parse(e,r),i.finish(r),r},t.CLOSE_PATH=1,t.MOVE_TO=2,t.HORIZ_LINE_TO=4,t.VERT_LINE_TO=8,t.LINE_TO=16,t.CURVE_TO=32,t.SMOOTH_CURVE_TO=64,t.QUAD_TO=128,t.SMOOTH_QUAD_TO=256,t.ARC=512,t.LINE_COMMANDS=t.LINE_TO|t.HORIZ_LINE_TO|t.VERT_LINE_TO,t.DRAWING_COMMANDS=t.HORIZ_LINE_TO|t.VERT_LINE_TO|t.LINE_TO|t.CURVE_TO|t.SMOOTH_CURVE_TO|t.QUAD_TO|t.SMOOTH_QUAD_TO|t.ARC,t}(Ys),gh=((Ne={})[b.MOVE_TO]=2,Ne[b.LINE_TO]=2,Ne[b.HORIZ_LINE_TO]=1,Ne[b.VERT_LINE_TO]=1,Ne[b.CLOSE_PATH]=0,Ne[b.QUAD_TO]=4,Ne[b.SMOOTH_QUAD_TO]=2,Ne[b.CURVE_TO]=6,Ne[b.SMOOTH_CURVE_TO]=4,Ne[b.ARC]=7,Ne);function vn(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vn=function(t){return typeof t}:vn=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vn(n)}function bh(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var vh=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Ch=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function Th(n,t,e,i,r){if(typeof n=="string"&&(n=document.getElementById(n)),!n||vn(n)!=="object"||!("getContext"in n))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var o=n.getContext("2d");try{return o.getImageData(t,e,i,r)}catch(s){throw new Error("unable to access image data: "+s)}}function Gs(n,t,e,i,r,o){if(!(isNaN(o)||o<1)){o|=0;var s=Th(n,t,e,i,r);s=xh(s,t,e,i,r,o),n.getContext("2d").putImageData(s,t,e)}}function xh(n,t,e,i,r,o){for(var s=n.data,a=2*o+1,l=i-1,h=r-1,u=o+1,c=u*(u+1)/2,p=new qs,d=p,f,m=1;m<a;m++)d=d.next=new qs,m===u&&(f=d);d.next=p;for(var g=null,y=null,C=0,T=0,S=vh[o],N=Ch[o],L=0;L<r;L++){d=p;for(var R=s[T],V=s[T+1],q=s[T+2],re=s[T+3],oe=0;oe<u;oe++)d.r=R,d.g=V,d.b=q,d.a=re,d=d.next;for(var ie=0,ue=0,Z=0,G=0,ce=u*R,se=u*V,xe=u*q,F=u*re,U=c*R,ye=c*V,Le=c*q,Ue=c*re,rt=1;rt<u;rt++){var Rt=T+((l<rt?l:rt)<<2),en=s[Rt],wo=s[Rt+1],Eo=s[Rt+2],Ao=s[Rt+3],tn=u-rt;U+=(d.r=en)*tn,ye+=(d.g=wo)*tn,Le+=(d.b=Eo)*tn,Ue+=(d.a=Ao)*tn,ie+=en,ue+=wo,Z+=Eo,G+=Ao,d=d.next}g=p,y=f;for(var Zn=0;Zn<i;Zn++){var Jn=Ue*S>>>N;if(s[T+3]=Jn,Jn!==0){var er=255/Jn;s[T]=(U*S>>>N)*er,s[T+1]=(ye*S>>>N)*er,s[T+2]=(Le*S>>>N)*er}else s[T]=s[T+1]=s[T+2]=0;U-=ce,ye-=se,Le-=xe,Ue-=F,ce-=g.r,se-=g.g,xe-=g.b,F-=g.a;var dt=Zn+o+1;dt=C+(dt<l?dt:l)<<2,ie+=g.r=s[dt],ue+=g.g=s[dt+1],Z+=g.b=s[dt+2],G+=g.a=s[dt+3],U+=ie,ye+=ue,Le+=Z,Ue+=G,g=g.next;var nn=y,Mo=nn.r,Ro=nn.g,Io=nn.b,Po=nn.a;ce+=Mo,se+=Ro,xe+=Io,F+=Po,ie-=Mo,ue-=Ro,Z-=Io,G-=Po,y=y.next,T+=4}C+=i}for(var It=0;It<i;It++){T=It<<2;var pt=s[T],ft=s[T+1],mt=s[T+2],be=s[T+3],tr=u*pt,ir=u*ft,nr=u*mt,rr=u*be,rn=c*pt,on=c*ft,sn=c*mt,an=c*be;d=p;for(var Oo=0;Oo<u;Oo++)d.r=pt,d.g=ft,d.b=mt,d.a=be,d=d.next;for(var Lo=i,or=0,sr=0,ar=0,lr=0,ln=1;ln<=o;ln++){T=Lo+It<<2;var hn=u-ln;rn+=(d.r=pt=s[T])*hn,on+=(d.g=ft=s[T+1])*hn,sn+=(d.b=mt=s[T+2])*hn,an+=(d.a=be=s[T+3])*hn,lr+=pt,or+=ft,sr+=mt,ar+=be,d=d.next,ln<h&&(Lo+=i)}T=It,g=p,y=f;for(var hr=0;hr<r;hr++){var ve=T<<2;s[ve+3]=be=an*S>>>N,be>0?(be=255/be,s[ve]=(rn*S>>>N)*be,s[ve+1]=(on*S>>>N)*be,s[ve+2]=(sn*S>>>N)*be):s[ve]=s[ve+1]=s[ve+2]=0,rn-=tr,on-=ir,sn-=nr,an-=rr,tr-=g.r,ir-=g.g,nr-=g.b,rr-=g.a,ve=It+((ve=hr+u)<h?ve:h)*i<<2,rn+=lr+=g.r=s[ve],on+=or+=g.g=s[ve+1],sn+=sr+=g.b=s[ve+2],an+=ar+=g.a=s[ve+3],g=g.next,tr+=pt=y.r,ir+=ft=y.g,nr+=mt=y.b,rr+=be=y.a,lr-=pt,or-=ft,sr-=mt,ar-=be,y=y.next,T+=i}}return n}var qs=function n(){bh(this,n),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function Sh(){let{DOMParser:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:n,createCanvas(e,i){return new OffscreenCanvas(e,i)},async createImage(e){let r=await(await fetch(e)).blob();return await createImageBitmap(r)}};return(typeof globalThis.DOMParser<"u"||typeof n>"u")&&Reflect.deleteProperty(t,"DOMParser"),t}function wh(n){let{DOMParser:t,canvas:e,fetch:i}=n;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:t,fetch:i,createCanvas:e.createCanvas,createImage:e.loadImage}}var Bn=Object.freeze({__proto__:null,offscreen:Sh,node:wh});function Ft(n){return n.replace(/(?!\u3000)\s+/gm," ")}function Eh(n){return n.replace(/^[\n \t]+/,"")}function Ah(n){return n.replace(/[\n \t]+$/,"")}function Ae(n){let t=n.match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm);return t?t.map(parseFloat):[]}function Mh(n){let t=Ae(n);return[t[0]||0,t[1]||0,t[2]||0,t[3]||0,t[4]||0,t[5]||0]}var Rh=/^[A-Z-]+$/;function Ih(n){return Rh.test(n)?n.toLowerCase():n}function ra(n){let t=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(n);return t&&(t[2]||t[3]||t[4])||""}function Ph(n){if(!n.startsWith("rgb"))return n;let t=3;return n.replace(/\d+(\.\d+)?/g,(i,r)=>t--&&r?String(Math.round(parseFloat(i))):i)}var Oh=/(\[[^\]]+\])/g,Lh=/(#[^\s+>~.[:]+)/g,kh=/(\.[^\s+>~.[:]+)/g,Dh=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,Nh=/(:[\w-]+\([^)]*\))/gi,Bh=/(:[^\s+>~.[:]+)/g,_h=/([^\s+>~.[:]+)/g;function Ct(n,t){let e=t.exec(n);return e?[n.replace(t," "),e.length]:[n,0]}function Vh(n){let t=[0,0,0],e=n.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),i=0;return[e,i]=Ct(e,Oh),t[1]+=i,[e,i]=Ct(e,Lh),t[0]+=i,[e,i]=Ct(e,kh),t[1]+=i,[e,i]=Ct(e,Dh),t[2]+=i,[e,i]=Ct(e,Nh),t[1]+=i,[e,i]=Ct(e,Bh),t[1]+=i,e=e.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[e,i]=Ct(e,_h),t[2]+=i,t.join("")}var Vt=1e-8;function Xs(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))}function Or(n,t){return(n[0]*t[0]+n[1]*t[1])/(Xs(n)*Xs(t))}function Ks(n,t){return(n[0]*t[1]<n[1]*t[0]?-1:1)*Math.acos(Or(n,t))}function js(n){return n*n*n}function $s(n){return 3*n*n*(1-n)}function Qs(n){return 3*n*(1-n)*(1-n)}function Zs(n){return(1-n)*(1-n)*(1-n)}function Js(n){return n*n}function ea(n){return 2*n*(1-n)}function ta(n){return(1-n)*(1-n)}var M=class n{static empty(t){return new n(t,"EMPTY","")}split(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:e,name:i}=this;return Ft(this.getString()).trim().split(t).map(r=>new n(e,i,r))}hasValue(t){let e=this.value;return e!==null&&e!==""&&(t||e!==0)&&typeof e<"u"}isString(t){let{value:e}=this,i=typeof e=="string";return!i||!t?i:t.test(e)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;let t=this.getString();switch(!0){case t.endsWith("px"):case/^[0-9]+$/.test(t):return!0;default:return!1}}setValue(t){return this.value=t,this}getValue(t){return typeof t>"u"||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return typeof t>"u"?0:parseFloat(t);let{value:e}=this,i=parseFloat(e);return this.isString(/%$/)&&(i/=100),i}getString(t){return typeof t>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(t)}getColor(t){let e=this.getString(t);return this.isNormalizedColor||(this.isNormalizedColor=!0,e=Ph(e),this.value=e),e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;let[i,r]=typeof t=="boolean"?[void 0,t]:[t],{viewPort:o}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(o.computeSize("x"),o.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(o.computeSize("x"),o.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*o.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*o.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&r):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*o.computeSize(i);default:{let s=this.getNumber();return e&&s<1?s*o.computeSize(i):s}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){let t=this.getString(),e=/#([^)'"]+)/.exec(t),i=e?.[1]||t;return this.document.definitions.get(i)}getFillStyleDefinition(t,e){let i=this.getDefinition();if(!i)return null;if(typeof i.createGradient=="function"&&"getBoundingBox"in t)return i.createGradient(this.document.ctx,t,e);if(typeof i.createPattern=="function"){if(i.getHrefAttribute().hasValue()){let r=i.getAttribute("patternTransform");i=i.getHrefAttribute().getDefinition(),i&&r.hasValue()&&i.getAttribute("patternTransform",!0).setValue(r.value)}if(i)return i.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){if(!this.hasValue())return null;let t=this.getString();return n.textBaselineMapping[t]||null}addOpacity(t){let e=this.getColor(),i=e.length,r=0;for(let o=0;o<i&&(e[o]===","&&r++,r!==3);o++);if(t.hasValue()&&this.isString()&&r!==3){let o=new Sn.default(e);o.ok&&(o.alpha=t.getNumber(),e=o.toRGBA())}return new n(this.document,this.name,e)}constructor(t,e,i){this.document=t,this.name=e,this.value=i,this.isNormalizedColor=!1}};M.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};var Tt=class{clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getRoot(){let[t]=this.viewPorts;return t||ia()}getCurrent(){let{viewPorts:t}=this,e=t[t.length-1];return e||ia()}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return typeof t=="number"?t:t==="x"?this.width:t==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}constructor(){this.viewPorts=[]}};Tt.DEFAULT_VIEWPORT_WIDTH=800;Tt.DEFAULT_VIEWPORT_HEIGHT=600;function ia(){return{width:Tt.DEFAULT_VIEWPORT_WIDTH,height:Tt.DEFAULT_VIEWPORT_HEIGHT}}var H=class n{static parse(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[i=e,r=e]=Ae(t);return new n(i,r)}static parseScale(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[i=e,r=i]=Ae(t);return new n(i,r)}static parsePath(t){let e=Ae(t),i=e.length,r=[];for(let o=0;o<i;o+=2)r.push(new n(e[o],e[o+1]));return r}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){let{x:e,y:i}=this,r=e*t[0]+i*t[2]+t[4],o=e*t[1]+i*t[3]+t[5];this.x=r,this.y=o}constructor(t,e){this.x=t,this.y=e}},Lr=class{isWorking(){return this.working}start(){if(this.working)return;let{screen:t,onClick:e,onMouseMove:i}=this,r=t.ctx.canvas;r.onclick=e,r.onmousemove=i,this.working=!0}stop(){if(!this.working)return;let t=this.screen.ctx.canvas;this.working=!1,t.onclick=null,t.onmousemove=null}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(!this.working)return;let{screen:t,events:e,eventElements:i}=this,{style:r}=t.ctx.canvas,o;r&&(r.cursor=""),e.forEach((s,a)=>{let{run:l}=s;for(o=i[a];o;)l(o),o=o.parent}),this.events=[],this.eventElements=[]}checkPath(t,e){if(!this.working||!e)return;let{events:i,eventElements:r}=this;i.forEach((o,s)=>{let{x:a,y:l}=o;!r[s]&&e.isPointInPath&&e.isPointInPath(a,l)&&(r[s]=t)})}checkBoundingBox(t,e){if(!this.working||!e)return;let{events:i,eventElements:r}=this;i.forEach((o,s)=>{let{x:a,y:l}=o;!r[s]&&e.isPointInBox(a,l)&&(r[s]=t)})}mapXY(t,e){let{window:i,ctx:r}=this.screen,o=new H(t,e),s=r.canvas;for(;s;)o.x-=s.offsetLeft,o.y-=s.offsetTop,s=s.offsetParent;return i?.scrollX&&(o.x+=i.scrollX),i?.scrollY&&(o.y+=i.scrollY),o}onClick(t){let{x:e,y:i}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:i,run(r){r.onClick&&r.onClick()}})}onMouseMove(t){let{x:e,y:i}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:i,run(r){r.onMouseMove&&r.onMouseMove()}})}constructor(t){this.screen=t,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}},oa=typeof window<"u"?window:null,sa=typeof fetch<"u"?fetch.bind(void 0):void 0,tt=class n{wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;let t=this.waits.every(e=>e());return t&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=t,t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4}setViewBox(t){let{document:e,ctx:i,aspectRatio:r,width:o,desiredWidth:s,height:a,desiredHeight:l,minX:h=0,minY:u=0,refX:c,refY:p,clip:d=!1,clipX:f=0,clipY:m=0}=t,g=Ft(r).replace(/^defer\s/,""),[y,C]=g.split(" "),T=y||"xMidYMid",S=C||"meet",N=o/s,L=a/l,R=Math.min(N,L),V=Math.max(N,L),q=s,re=l;S==="meet"&&(q*=R,re*=R),S==="slice"&&(q*=V,re*=V);let oe=new M(e,"refX",c),ie=new M(e,"refY",p),ue=oe.hasValue()&&ie.hasValue();if(ue&&i.translate(-R*oe.getPixels("x"),-R*ie.getPixels("y")),d){let Z=R*f,G=R*m;i.beginPath(),i.moveTo(Z,G),i.lineTo(o,G),i.lineTo(o,a),i.lineTo(Z,a),i.closePath(),i.clip()}if(!ue){let Z=S==="meet"&&R===L,G=S==="slice"&&V===L,ce=S==="meet"&&R===N,se=S==="slice"&&V===N;T.startsWith("xMid")&&(Z||G)&&i.translate(o/2-q/2,0),T.endsWith("YMid")&&(ce||se)&&i.translate(0,a/2-re/2),T.startsWith("xMax")&&(Z||G)&&i.translate(o-q,0),T.endsWith("YMax")&&(ce||se)&&i.translate(0,a-re)}switch(!0){case T==="none":i.scale(N,L);break;case S==="meet":i.scale(R,R);break;case S==="slice":i.scale(V,V);break}i.translate(-h,-u)}start(t){let{enableRedraw:e=!1,ignoreMouse:i=!1,ignoreAnimation:r=!1,ignoreDimensions:o=!1,ignoreClear:s=!1,forceRedraw:a,scaleWidth:l,scaleHeight:h,offsetX:u,offsetY:c}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{mouse:p}=this,d=1e3/n.FRAMERATE;if(this.isReadyLock=!1,this.frameDuration=d,this.readyPromise=new Promise(C=>{this.resolveReady=C}),this.isReady()&&this.render(t,o,s,l,h,u,c),!e)return;let f=Date.now(),m=f,g=0,y=()=>{f=Date.now(),g=f-m,g>=d&&(m=f-g%d,this.shouldUpdate(r,a)&&(this.render(t,o,s,l,h,u,c),p.runEvents())),this.intervalId=(0,xn.default)(y)};i||p.start(),this.intervalId=(0,xn.default)(y)}stop(){this.intervalId&&(xn.default.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(t,e){if(!t){let{frameDuration:i}=this;if(this.animations.reduce((o,s)=>s.update(i)||o,!1))return!0}return!!(typeof e=="function"&&e()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(t,e,i,r,o,s,a){let{viewPort:l,ctx:h,isFirstRender:u}=this,c=h.canvas;l.clear(),c.width&&c.height&&l.setCurrent(c.width,c.height);let p=t.getStyle("width"),d=t.getStyle("height");!e&&(u||typeof r!="number"&&typeof o!="number")&&(p.hasValue()&&(c.width=p.getPixels("x"),c.style&&(c.style.width="".concat(c.width,"px"))),d.hasValue()&&(c.height=d.getPixels("y"),c.style&&(c.style.height="".concat(c.height,"px"))));let f=c.clientWidth||c.width,m=c.clientHeight||c.height;if(e&&p.hasValue()&&d.hasValue()&&(f=p.getPixels("x"),m=d.getPixels("y")),l.setCurrent(f,m),typeof s=="number"&&t.getAttribute("x",!0).setValue(s),typeof a=="number"&&t.getAttribute("y",!0).setValue(a),typeof r=="number"||typeof o=="number"){let g=Ae(t.getAttribute("viewBox").getString()),y=0,C=0;if(typeof r=="number"){let S=t.getStyle("width");S.hasValue()?y=S.getPixels("x")/r:g[2]&&!isNaN(g[2])&&(y=g[2]/r)}if(typeof o=="number"){let S=t.getStyle("height");S.hasValue()?C=S.getPixels("y")/o:g[3]&&!isNaN(g[3])&&(C=g[3]/o)}y||(y=C),C||(C=y),t.getAttribute("width",!0).setValue(r),t.getAttribute("height",!0).setValue(o);let T=t.getStyle("transform",!0,!0);T.setValue("".concat(T.getString()," scale(").concat(1/y,", ").concat(1/C,")"))}i||h.clearRect(0,0,f,m),t.render(h),u&&(this.isFirstRender=!1)}constructor(t,{fetch:e=sa,window:i=oa}={}){if(this.ctx=t,this.viewPort=new Tt,this.mouse=new Lr(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=i,!e)throw new Error("Can't find 'fetch' in 'globalThis', please provide it via options");this.fetch=e}};tt.defaultWindow=oa;tt.defaultFetch=sa;tt.FRAMERATE=30;tt.MAX_VIRTUAL_PIXELS=3e4;var{defaultFetch:Uh}=tt,zh=typeof DOMParser<"u"?DOMParser:void 0,Mi=class{async parse(t){return t.startsWith("<")?this.parseFromString(t):this.load(t)}parseFromString(t){let e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch{return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){let e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent||"Unknown parse error");return t}async load(t){let i=await(await this.fetch(t)).text();return this.parseFromString(i)}constructor({fetch:t=Uh,DOMParser:e=zh}={}){if(!t)throw new Error("Can't find 'fetch' in 'globalThis', please provide it via options");if(!e)throw new Error("Can't find 'DOMParser' in 'globalThis', please provide it via options");this.fetch=t,this.DOMParser=e}},kr=class{apply(t){let{x:e,y:i}=this.point;t.translate(e||0,i||0)}unapply(t){let{x:e,y:i}=this.point;t.translate(-1*e||0,-1*i||0)}applyToPoint(t){let{x:e,y:i}=this.point;t.applyTransform([1,0,0,1,e||0,i||0])}constructor(t,e){this.type="translate",this.point=H.parse(e)}},Dr=class{apply(t){let{cx:e,cy:i,originX:r,originY:o,angle:s}=this,a=e+r.getPixels("x"),l=i+o.getPixels("y");t.translate(a,l),t.rotate(s.getRadians()),t.translate(-a,-l)}unapply(t){let{cx:e,cy:i,originX:r,originY:o,angle:s}=this,a=e+r.getPixels("x"),l=i+o.getPixels("y");t.translate(a,l),t.rotate(-1*s.getRadians()),t.translate(-a,-l)}applyToPoint(t){let{cx:e,cy:i,angle:r}=this,o=r.getRadians();t.applyTransform([1,0,0,1,e||0,i||0]),t.applyTransform([Math.cos(o),Math.sin(o),-Math.sin(o),Math.cos(o),0,0]),t.applyTransform([1,0,0,1,-e||0,-i||0])}constructor(t,e,i){this.type="rotate";let r=Ae(e);this.angle=new M(t,"angle",r[0]),this.originX=i[0],this.originY=i[1],this.cx=r[1]||0,this.cy=r[2]||0}},Nr=class{apply(t){let{scale:{x:e,y:i},originX:r,originY:o}=this,s=r.getPixels("x"),a=o.getPixels("y");t.translate(s,a),t.scale(e,i||e),t.translate(-s,-a)}unapply(t){let{scale:{x:e,y:i},originX:r,originY:o}=this,s=r.getPixels("x"),a=o.getPixels("y");t.translate(s,a),t.scale(1/e,1/i||e),t.translate(-s,-a)}applyToPoint(t){let{x:e,y:i}=this.scale;t.applyTransform([e||0,0,0,i||0,0,0])}constructor(t,e,i){this.type="scale";let r=H.parseScale(e);(r.x===0||r.y===0)&&(r.x=Vt,r.y=Vt),this.scale=r,this.originX=i[0],this.originY=i[1]}},wn=class{apply(t){let{originX:e,originY:i,matrix:r}=this,o=e.getPixels("x"),s=i.getPixels("y");t.translate(o,s),t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),t.translate(-o,-s)}unapply(t){let{originX:e,originY:i,matrix:r}=this,o=r[0],s=r[2],a=r[4],l=r[1],h=r[3],u=r[5],c=0,p=0,d=1,f=1/(o*(h*d-u*p)-s*(l*d-u*c)+a*(l*p-h*c)),m=e.getPixels("x"),g=i.getPixels("y");t.translate(m,g),t.transform(f*(h*d-u*p),f*(u*c-l*d),f*(a*p-s*d),f*(o*d-a*c),f*(s*u-a*h),f*(a*l-o*u)),t.translate(-m,-g)}applyToPoint(t){t.applyTransform(this.matrix)}constructor(t,e,i){this.type="matrix",this.matrix=Mh(e),this.originX=i[0],this.originY=i[1]}},En=class extends wn{constructor(t,e,i){super(t,e,i),this.type="skew",this.angle=new M(t,"angle",e)}},Br=class extends En{constructor(t,e,i){super(t,e,i),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}},_r=class extends En{constructor(t,e,i){super(t,e,i),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}};function Wh(n){return Ft(n).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function Fh(n){let[t="",e=""]=n.split("(");return[t.trim(),e.trim().replace(")","")]}var Ut=class n{static fromElement(t,e){let i=e.getStyle("transform",!1,!0);if(i.hasValue()){let[r,o=r]=e.getStyle("transform-origin",!1,!0).split();if(r&&o){let s=[r,o];return new n(t,i.getString(),s)}}return null}apply(t){this.transforms.forEach(e=>e.apply(t))}unapply(t){this.transforms.forEach(e=>e.unapply(t))}applyToPoint(t){this.transforms.forEach(e=>e.applyToPoint(t))}constructor(t,e,i){this.document=t,this.transforms=[],Wh(e).forEach(o=>{if(o==="none")return;let[s,a]=Fh(o),l=n.transformTypes[s];l&&this.transforms.push(new l(this.document,a,i))})}};Ut.transformTypes={translate:kr,rotate:Dr,scale:Nr,matrix:wn,skewX:Br,skewY:_r};var z=class n{getAttribute(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=this.attributes.get(t);if(!i&&e){let r=new M(this.document,t,"");return this.attributes.set(t,r),r}return i||M.empty(this.document)}getHrefAttribute(){let t;for(let[e,i]of this.attributes)if(e==="href"||e.endsWith(":href")){t=i;break}return t||M.empty(this.document)}getStyle(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=this.styles.get(t);if(r)return r;let o=this.getAttribute(t);if(o.hasValue())return this.styles.set(t,o),o;if(!i){let{parent:s}=this;if(s){let a=s.getStyle(t);if(a.hasValue())return a}}if(e){let s=new M(this.document,t,"");return this.styles.set(t,s),s}return M.empty(this.document)}render(t){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(t.save(),this.getStyle("mask").hasValue()){let e=this.getStyle("mask").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else if(this.getStyle("filter").getValue("none")!=="none"){let e=this.getStyle("filter").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}}setContext(t){}applyEffects(t){let e=Ut.fromElement(this.document,this);e&&e.apply(t);let i=this.getStyle("clip-path",!1,!0);if(i.hasValue()){let r=i.getDefinition();r&&r.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach(e=>{e.render(t)})}addChild(t){let e=t instanceof n?t:this.document.createElement(t);e.parent=this,n.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e;let{node:i}=this;if(typeof i.matches=="function")return i.matches(t);let r=(e=i.getAttribute)===null||e===void 0?void 0:e.call(i,"class");return!r||r===""?!1:r.split(" ").some(o=>".".concat(o)===t)}addStylesFromStyleDefinition(){let{styles:t,stylesSpecificity:e}=this.document;for(let[i,r]of t)if(!i.startsWith("@")&&this.matchesSelector(i)){let o=e.get(i);if(r)for(let[s,a]of r){let l=this.stylesSpecificity.get(s);typeof l>"u"&&(l="000"),o&&o>=l&&(a&&this.styles.set(s,a),this.stylesSpecificity.set(s,o))}}}removeStyles(t,e){return e.reduce((r,o)=>{let s=t.getStyle(o);if(!s.hasValue())return r;let a=s.getString();return s.setValue(""),[...r,[o,a]]},[])}restoreStyles(t,e){e.forEach(i=>{let[r,o]=i;t.getStyle(r,!0).setValue(o)})}isFirstChild(){var t;return((t=this.parent)===null||t===void 0?void 0:t.children.indexOf(this))===0}constructor(t,e,i=!1){if(this.document=t,this.node=e,this.captureTextNodes=i,this.type="",this.attributes=new Map,this.styles=new Map,this.stylesSpecificity=new Map,this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!e||e.nodeType!==1)return;Array.from(e.attributes).forEach(s=>{let a=Ih(s.nodeName);this.attributes.set(a,new M(t,a,s.value))}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()&&this.getAttribute("style").getString().split(";").map(a=>a.trim()).forEach(a=>{if(!a)return;let[l,h]=a.split(":").map(u=>u.trim());l&&this.styles.set(l,new M(t,l,h))});let{definitions:r}=t,o=this.getAttribute("id");o.hasValue()&&(r.has(o.getString())||r.set(o.getString(),this)),Array.from(e.childNodes).forEach(s=>{if(s.nodeType===1)this.addChild(s);else if(i&&(s.nodeType===3||s.nodeType===4)){let a=t.createTextNode(s);a.getText().length>0&&this.addChild(a)}})}};z.ignoreChildTypes=["title"];var Vr=class extends z{constructor(t,e,i){super(t,e,i)}};function Hh(n){let t=n.trim();return/^('|")/.test(t)?t:'"'.concat(t,'"')}function Yh(n){return typeof process>"u"?n:n.trim().split(",").map(Hh).join(",")}function qh(n){if(!n)return"";let t=n.trim().toLowerCase();switch(t){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return t;default:return/^oblique\s+(-|)\d+deg$/.test(t)?t:""}}function Gh(n){if(!n)return"";let t=n.trim().toLowerCase();switch(t){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return t;default:return/^[\d.]+$/.test(t)?t:""}}var _e=class n{static parse(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,i="",r="",o="",s="",a="",l=Ft(t).trim().split(" "),h={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return l.forEach(u=>{switch(!0){case(!h.fontStyle&&n.styles.includes(u)):u!=="inherit"&&(i=u),h.fontStyle=!0;break;case(!h.fontVariant&&n.variants.includes(u)):u!=="inherit"&&(r=u),h.fontStyle=!0,h.fontVariant=!0;break;case(!h.fontWeight&&n.weights.includes(u)):u!=="inherit"&&(o=u),h.fontStyle=!0,h.fontVariant=!0,h.fontWeight=!0;break;case!h.fontSize:u!=="inherit"&&(s=u.split("/")[0]||""),h.fontStyle=!0,h.fontVariant=!0,h.fontWeight=!0,h.fontSize=!0;break;default:u!=="inherit"&&(a+=u)}}),new n(i,r,o,s,a,e)}toString(){return[qh(this.fontStyle),this.fontVariant,Gh(this.fontWeight),this.fontSize,Yh(this.fontFamily)].join(" ").trim()}constructor(t,e,i,r,o,s){let a=s?typeof s=="string"?n.parse(s):s:{};this.fontFamily=o||a.fontFamily,this.fontSize=r||a.fontSize,this.fontStyle=t||a.fontStyle,this.fontWeight=i||a.fontWeight,this.fontVariant=e||a.fontVariant}};_e.styles="normal|italic|oblique|inherit";_e.variants="normal|small-caps|inherit";_e.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";var Me=class{get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){typeof t<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))}addX(t){this.addPoint(t,0)}addY(t){this.addPoint(0,t)}addBoundingBox(t){if(!t)return;let{x1:e,y1:i,x2:r,y2:o}=t;this.addPoint(e,i),this.addPoint(r,o)}sumCubic(t,e,i,r,o){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*i+3*(1-t)*Math.pow(t,2)*r+Math.pow(t,3)*o}bezierCurveAdd(t,e,i,r,o){let s=6*e-12*i+6*r,a=-3*e+9*i-9*r+3*o,l=3*i-3*e;if(a===0){if(s===0)return;let p=-l/s;0<p&&p<1&&(t?this.addX(this.sumCubic(p,e,i,r,o)):this.addY(this.sumCubic(p,e,i,r,o)));return}let h=Math.pow(s,2)-4*l*a;if(h<0)return;let u=(-s+Math.sqrt(h))/(2*a);0<u&&u<1&&(t?this.addX(this.sumCubic(u,e,i,r,o)):this.addY(this.sumCubic(u,e,i,r,o)));let c=(-s-Math.sqrt(h))/(2*a);0<c&&c<1&&(t?this.addX(this.sumCubic(c,e,i,r,o)):this.addY(this.sumCubic(c,e,i,r,o)))}addBezierCurve(t,e,i,r,o,s,a,l){this.addPoint(t,e),this.addPoint(a,l),this.bezierCurveAdd(!0,t,i,o,a),this.bezierCurveAdd(!1,e,r,s,l)}addQuadraticCurve(t,e,i,r,o,s){let a=t+.6666666666666666*(i-t),l=e+2/3*(r-e),h=a+1/3*(o-t),u=l+1/3*(s-e);this.addBezierCurve(t,e,a,h,l,u,o,s)}isPointInBox(t,e){let{x1:i,y1:r,x2:o,y2:s}=this;return i<=t&&t<=o&&r<=e&&e<=s}constructor(t=Number.NaN,e=Number.NaN,i=Number.NaN,r=Number.NaN){this.x1=t,this.y1=e,this.x2=i,this.y2=r,this.addPoint(t,e),this.addPoint(i,r)}},it=class extends z{calculateOpacity(){let t=1,e=this;for(;e;){let i=e.getStyle("opacity",!1,!0);i.hasValue(!0)&&(t*=i.getNumber()),e=e.parent}return t}setContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e){let i=this.getStyle("fill"),r=this.getStyle("fill-opacity"),o=this.getStyle("stroke"),s=this.getStyle("stroke-opacity");if(i.isUrlDefinition()){let d=i.getFillStyleDefinition(this,r);d&&(t.fillStyle=d)}else if(i.hasValue()){i.getString()==="currentColor"&&i.setValue(this.getStyle("color").getColor());let d=i.getColor();d!=="inherit"&&(t.fillStyle=d==="none"?"rgba(0,0,0,0)":d)}if(r.hasValue()){let d=new M(this.document,"fill",t.fillStyle).addOpacity(r).getColor();t.fillStyle=d}if(o.isUrlDefinition()){let d=o.getFillStyleDefinition(this,s);d&&(t.strokeStyle=d)}else if(o.hasValue()){o.getString()==="currentColor"&&o.setValue(this.getStyle("color").getColor());let d=o.getString();d!=="inherit"&&(t.strokeStyle=d==="none"?"rgba(0,0,0,0)":d)}if(s.hasValue()){let d=new M(this.document,"stroke",t.strokeStyle).addOpacity(s).getString();t.strokeStyle=d}let a=this.getStyle("stroke-width");if(a.hasValue()){let d=a.getPixels();t.lineWidth=d||Vt}let l=this.getStyle("stroke-linecap"),h=this.getStyle("stroke-linejoin"),u=this.getStyle("stroke-miterlimit"),c=this.getStyle("stroke-dasharray"),p=this.getStyle("stroke-dashoffset");if(l.hasValue()&&(t.lineCap=l.getString()),h.hasValue()&&(t.lineJoin=h.getString()),u.hasValue()&&(t.miterLimit=u.getNumber()),c.hasValue()&&c.getString()!=="none"){let d=Ae(c.getString());typeof t.setLineDash<"u"?t.setLineDash(d):typeof t.webkitLineDash<"u"?t.webkitLineDash=d:typeof t.mozDash<"u"&&!(d.length===1&&d[0]===0)&&(t.mozDash=d);let f=p.getPixels();typeof t.lineDashOffset<"u"?t.lineDashOffset=f:typeof t.webkitLineDashOffset<"u"?t.webkitLineDashOffset=f:typeof t.mozDashOffset<"u"&&(t.mozDashOffset=f)}}if(this.modifiedEmSizeStack=!1,typeof t.font<"u"){let i=this.getStyle("font"),r=this.getStyle("font-style"),o=this.getStyle("font-variant"),s=this.getStyle("font-weight"),a=this.getStyle("font-size"),l=this.getStyle("font-family"),h=new _e(r.getString(),o.getString(),s.getString(),a.hasValue()?"".concat(a.getPixels(!0),"px"):"",l.getString(),_e.parse(i.getString(),t.font));r.setValue(h.fontStyle),o.setValue(h.fontVariant),s.setValue(h.fontWeight),a.setValue(h.fontSize),l.setValue(h.fontFamily),t.font=h.toString(),a.isPixels()&&(this.document.emSize=a.getPixels(),this.modifiedEmSizeStack=!0)}e||(this.applyEffects(t),t.globalAlpha=this.calculateOpacity())}clearContext(t){super.clearContext(t),this.modifiedEmSizeStack&&this.document.popEmSize()}constructor(...t){super(...t),this.modifiedEmSizeStack=!1}},xt=class n extends it{setContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(t,e);let i=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();i&&(t.textBaseline=i)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if(this.type!=="text")return this.getTElementBoundingBox(t);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t);let e=null;return this.children.forEach((i,r)=>{let o=this.getChildBoundingBox(t,this,this,r);e?e.addBoundingBox(o):e=o}),e}getFontSize(){let{document:t,parent:e}=this,i=_e.parse(t.ctx.font).fontSize;return e.getStyle("font-size").getNumber(i)}getTElementBoundingBox(t){let e=this.getFontSize();return new Me(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,i){let r=e[i],o;if(t.isArabic){var s;let a=e.length,l=e[i-1],h=e[i+1],u="isolated";(i===0||l===" ")&&i<a-1&&h!==" "&&(u="terminal"),i>0&&l!==" "&&i<a-1&&h!==" "&&(u="medial"),i>0&&l!==" "&&(i===a-1||h===" ")&&(u="initial"),o=((s=t.arabicGlyphs.get(r))===null||s===void 0?void 0:s.get(u))||t.glyphs.get(r)}else o=t.glyphs.get(r);return o||(o=t.missingGlyph),o}getText(){return""}getTextFromNode(t){let e=t||this.node,i=Array.from(e.parentNode.childNodes),r=i.indexOf(e),o=i.length-1,s=Ft(e.textContent||"");return r===0&&(s=Eh(s)),r===o&&(s=Ah(s)),s}renderChildren(t){if(this.type!=="text"){this.renderTElementChildren(t);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t),this.children.forEach((i,r)=>{this.renderChild(t,this,this,r)});let{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}renderTElementChildren(t){let{document:e,parent:i}=this,r=this.getText(),o=i.getStyle("font-family").getDefinition();if(o){let{unitsPerEm:l}=o.fontFace,h=_e.parse(e.ctx.font),u=i.getStyle("font-size").getNumber(h.fontSize),c=i.getStyle("font-style").getString(h.fontStyle),p=u/l,d=o.isRTL?r.split("").reverse().join(""):r,f=Ae(i.getAttribute("dx").getString()),m=d.length;for(let g=0;g<m;g++){let y=this.getGlyph(o,d,g);t.translate(this.x,this.y),t.scale(p,-p);let C=t.lineWidth;t.lineWidth=t.lineWidth*l/u,c==="italic"&&t.transform(1,0,.4,1,0,0),y.render(t),c==="italic"&&t.transform(1,0,-.4,1,0,0),t.lineWidth=C,t.scale(1/p,-1/p),t.translate(-this.x,-this.y),this.x+=u*(y.horizAdvX||o.horizAdvX)/l,typeof f[g]<"u"&&!isNaN(f[g])&&(this.x+=f[g])}return}let{x:s,y:a}=this;t.fillStyle&&t.fillText(r,s,a),t.strokeStyle&&t.strokeText(r,s,a)}applyAnchoring(){if(this.textChunkStart>=this.leafTexts.length)return;let t=this.leafTexts[this.textChunkStart],e=t.getStyle("text-anchor").getString("start"),i=!1,r=0;e==="start"&&!i||e==="end"&&i?r=t.x-this.minX:e==="end"&&!i||e==="start"&&i?r=t.x-this.maxX:r=t.x-(this.minX+this.maxX)/2;for(let o=this.textChunkStart;o<this.leafTexts.length;o++)this.leafTexts[o].x+=r;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}adjustChildCoordinatesRecursive(t){this.children.forEach((e,i)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,i)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,i,r){let o=i.children[r];o.children.length>0?o.children.forEach((s,a)=>{e.adjustChildCoordinatesRecursiveCore(t,e,o,a)}):this.adjustChildCoordinates(t,e,i,r)}adjustChildCoordinates(t,e,i,r){let o=i.children[r];if(typeof o.measureText!="function")return o;t.save(),o.setContext(t,!0);let s=o.getAttribute("x"),a=o.getAttribute("y"),l=o.getAttribute("dx"),h=o.getAttribute("dy"),u=o.getStyle("font-family").getDefinition(),c=!!u?.isRTL;r===0&&(s.hasValue()||s.setValue(o.getInheritedAttribute("x")),a.hasValue()||a.setValue(o.getInheritedAttribute("y")),l.hasValue()||l.setValue(o.getInheritedAttribute("dx")),h.hasValue()||h.setValue(o.getInheritedAttribute("dy")));let p=o.measureText(t);return c&&(e.x-=p),s.hasValue()?(e.applyAnchoring(),o.x=s.getPixels("x"),l.hasValue()&&(o.x+=l.getPixels("x"))):(l.hasValue()&&(e.x+=l.getPixels("x")),o.x=e.x),e.x=o.x,c||(e.x+=p),a.hasValue()?(o.y=a.getPixels("y"),h.hasValue()&&(o.y+=h.getPixels("y"))):(h.hasValue()&&(e.y+=h.getPixels("y")),o.y=e.y),e.y=o.y,e.leafTexts.push(o),e.minX=Math.min(e.minX,o.x,o.x+p),e.maxX=Math.max(e.maxX,o.x,o.x+p),o.clearContext(t),t.restore(),o}getChildBoundingBox(t,e,i,r){let o=i.children[r];if(typeof o.getBoundingBox!="function")return null;let s=o.getBoundingBox(t);return s&&o.children.forEach((a,l)=>{let h=e.getChildBoundingBox(t,e,o,l);s.addBoundingBox(h)}),s}renderChild(t,e,i,r){let o=i.children[r];o.render(t),o.children.forEach((s,a)=>{e.renderChild(t,e,o,a)})}measureText(t){let{measureCache:e}=this;if(~e)return e;let i=this.getText(),r=this.measureTargetText(t,i);return this.measureCache=r,r}measureTargetText(t,e){if(!e.length)return 0;let{parent:i}=this,r=i.getStyle("font-family").getDefinition();if(r){let s=this.getFontSize(),a=r.isRTL?e.split("").reverse().join(""):e,l=Ae(i.getAttribute("dx").getString()),h=a.length,u=0;for(let c=0;c<h;c++){let p=this.getGlyph(r,a,c);u+=(p.horizAdvX||r.horizAdvX)*s/r.fontFace.unitsPerEm,typeof l[c]<"u"&&!isNaN(l[c])&&(u+=l[c])}return u}if(!t.measureText)return e.length*10;t.save(),this.setContext(t,!0);let{width:o}=t.measureText(e);return this.clearContext(t),t.restore(),o}getInheritedAttribute(t){let e=this;for(;e instanceof n&&e.isFirstChild()&&e.parent;){let i=e.parent.getAttribute(t);if(i.hasValue(!0))return i.getString("0");e=e.parent}return null}constructor(t,e,i){super(t,e,new.target===n?!0:i),this.type="text",this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.measureCache=-1}},An=class n extends xt{getText(){return this.text}constructor(t,e,i){super(t,e,new.target===n?!0:i),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}},Ur=class extends An{constructor(...t){super(...t),this.type="textNode"}},I=class extends b{reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new H(0,0),this.control=new H(0,0),this.current=new H(0,0),this.points=[],this.angles=[]}isEnd(){let{i:t,commands:e}=this;return t>=e.length-1}next(){let t=this.commands[++this.i];return this.previousCommand=this.command,this.command=t,t}getPoint(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",i=new H(this.command[t],this.command[e]);return this.makeAbsolute(i)}getAsControlPoint(t,e){let i=this.getPoint(t,e);return this.control=i,i}getAsCurrentPoint(t,e){let i=this.getPoint(t,e);return this.current=i,i}getReflectedControlPoint(){let t=this.previousCommand.type;if(t!==b.CURVE_TO&&t!==b.SMOOTH_CURVE_TO&&t!==b.QUAD_TO&&t!==b.SMOOTH_QUAD_TO)return this.current;let{current:{x:e,y:i},control:{x:r,y:o}}=this;return new H(2*e-r,2*i-o)}makeAbsolute(t){if(this.command.relative){let{x:e,y:i}=this.current;t.x+=e,t.y+=i}return t}addMarker(t,e,i){let{points:r,angles:o}=this;i&&o.length>0&&!o[o.length-1]&&(o[o.length-1]=r[r.length-1].angleTo(i)),this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t),this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){let{angles:t}=this,e=t.length;for(let i=0;i<e;i++)if(!t[i]){for(let r=i+1;r<e;r++)if(t[r]){t[i]=t[r];break}}return t}constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=new H(0,0),this.start=new H(0,0),this.current=new H(0,0),this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}},ee=class n extends it{path(t){let{pathParser:e}=this,i=new Me;for(e.reset(),t&&t.beginPath();!e.isEnd();)switch(e.next().type){case I.MOVE_TO:this.pathM(t,i);break;case I.LINE_TO:this.pathL(t,i);break;case I.HORIZ_LINE_TO:this.pathH(t,i);break;case I.VERT_LINE_TO:this.pathV(t,i);break;case I.CURVE_TO:this.pathC(t,i);break;case I.SMOOTH_CURVE_TO:this.pathS(t,i);break;case I.QUAD_TO:this.pathQ(t,i);break;case I.SMOOTH_QUAD_TO:this.pathT(t,i);break;case I.ARC:this.pathA(t,i);break;case I.CLOSE_PATH:this.pathZ(t,i);break}return i}getBoundingBox(t){return this.path()}getMarkers(){let{pathParser:t}=this,e=t.getMarkerPoints(),i=t.getMarkerAngles();return e.map((o,s)=>[o,i[s]])}renderChildren(t){this.path(t),this.document.screen.mouse.checkPath(this,t);let e=this.getStyle("fill-rule");t.fillStyle!==""&&(e.getString("inherit")!=="inherit"?t.fill(e.getString()):t.fill()),t.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(t.save(),t.setTransform(1,0,0,1,0,0),t.stroke(),t.restore()):t.stroke());let i=this.getMarkers();if(i){let r=i.length-1,o=this.getStyle("marker-start"),s=this.getStyle("marker-mid"),a=this.getStyle("marker-end");if(o.isUrlDefinition()){let l=o.getDefinition(),[h,u]=i[0];l.render(t,h,u)}if(s.isUrlDefinition()){let l=s.getDefinition();for(let h=1;h<r;h++){let[u,c]=i[h];l.render(t,u,c)}}if(a.isUrlDefinition()){let l=a.getDefinition(),[h,u]=i[r];l.render(t,h,u)}}}static pathM(t){let e=t.getAsCurrentPoint();return t.start=t.current,{point:e}}pathM(t,e){let{pathParser:i}=this,{point:r}=n.pathM(i),{x:o,y:s}=r;i.addMarker(r),e.addPoint(o,s),t&&t.moveTo(o,s)}static pathL(t){let{current:e}=t,i=t.getAsCurrentPoint();return{current:e,point:i}}pathL(t,e){let{pathParser:i}=this,{current:r,point:o}=n.pathL(i),{x:s,y:a}=o;i.addMarker(o,r),e.addPoint(s,a),t&&t.lineTo(s,a)}static pathH(t){let{current:e,command:i}=t,r=new H((i.relative?e.x:0)+i.x,e.y);return t.current=r,{current:e,point:r}}pathH(t,e){let{pathParser:i}=this,{current:r,point:o}=n.pathH(i),{x:s,y:a}=o;i.addMarker(o,r),e.addPoint(s,a),t&&t.lineTo(s,a)}static pathV(t){let{current:e,command:i}=t,r=new H(e.x,(i.relative?e.y:0)+i.y);return t.current=r,{current:e,point:r}}pathV(t,e){let{pathParser:i}=this,{current:r,point:o}=n.pathV(i),{x:s,y:a}=o;i.addMarker(o,r),e.addPoint(s,a),t&&t.lineTo(s,a)}static pathC(t){let{current:e}=t,i=t.getPoint("x1","y1"),r=t.getAsControlPoint("x2","y2"),o=t.getAsCurrentPoint();return{current:e,point:i,controlPoint:r,currentPoint:o}}pathC(t,e){let{pathParser:i}=this,{current:r,point:o,controlPoint:s,currentPoint:a}=n.pathC(i);i.addMarker(a,s,o),e.addBezierCurve(r.x,r.y,o.x,o.y,s.x,s.y,a.x,a.y),t&&t.bezierCurveTo(o.x,o.y,s.x,s.y,a.x,a.y)}static pathS(t){let{current:e}=t,i=t.getReflectedControlPoint(),r=t.getAsControlPoint("x2","y2"),o=t.getAsCurrentPoint();return{current:e,point:i,controlPoint:r,currentPoint:o}}pathS(t,e){let{pathParser:i}=this,{current:r,point:o,controlPoint:s,currentPoint:a}=n.pathS(i);i.addMarker(a,s,o),e.addBezierCurve(r.x,r.y,o.x,o.y,s.x,s.y,a.x,a.y),t&&t.bezierCurveTo(o.x,o.y,s.x,s.y,a.x,a.y)}static pathQ(t){let{current:e}=t,i=t.getAsControlPoint("x1","y1"),r=t.getAsCurrentPoint();return{current:e,controlPoint:i,currentPoint:r}}pathQ(t,e){let{pathParser:i}=this,{current:r,controlPoint:o,currentPoint:s}=n.pathQ(i);i.addMarker(s,o,o),e.addQuadraticCurve(r.x,r.y,o.x,o.y,s.x,s.y),t&&t.quadraticCurveTo(o.x,o.y,s.x,s.y)}static pathT(t){let{current:e}=t,i=t.getReflectedControlPoint();t.control=i;let r=t.getAsCurrentPoint();return{current:e,controlPoint:i,currentPoint:r}}pathT(t,e){let{pathParser:i}=this,{current:r,controlPoint:o,currentPoint:s}=n.pathT(i);i.addMarker(s,o,o),e.addQuadraticCurve(r.x,r.y,o.x,o.y,s.x,s.y),t&&t.quadraticCurveTo(o.x,o.y,s.x,s.y)}static pathA(t){let{current:e,command:i}=t,{rX:r,rY:o,xRot:s,lArcFlag:a,sweepFlag:l}=i,h=s*(Math.PI/180),u=t.getAsCurrentPoint(),c=new H(Math.cos(h)*(e.x-u.x)/2+Math.sin(h)*(e.y-u.y)/2,-Math.sin(h)*(e.x-u.x)/2+Math.cos(h)*(e.y-u.y)/2),p=Math.pow(c.x,2)/Math.pow(r,2)+Math.pow(c.y,2)/Math.pow(o,2);p>1&&(r*=Math.sqrt(p),o*=Math.sqrt(p));let d=(a===l?-1:1)*Math.sqrt((Math.pow(r,2)*Math.pow(o,2)-Math.pow(r,2)*Math.pow(c.y,2)-Math.pow(o,2)*Math.pow(c.x,2))/(Math.pow(r,2)*Math.pow(c.y,2)+Math.pow(o,2)*Math.pow(c.x,2)));isNaN(d)&&(d=0);let f=new H(d*r*c.y/o,d*-o*c.x/r),m=new H((e.x+u.x)/2+Math.cos(h)*f.x-Math.sin(h)*f.y,(e.y+u.y)/2+Math.sin(h)*f.x+Math.cos(h)*f.y),g=Ks([1,0],[(c.x-f.x)/r,(c.y-f.y)/o]),y=[(c.x-f.x)/r,(c.y-f.y)/o],C=[(-c.x-f.x)/r,(-c.y-f.y)/o],T=Ks(y,C);return Or(y,C)<=-1&&(T=Math.PI),Or(y,C)>=1&&(T=0),{currentPoint:u,rX:r,rY:o,sweepFlag:l,xAxisRotation:h,centp:m,a1:g,ad:T}}pathA(t,e){let{pathParser:i}=this,{currentPoint:r,rX:o,rY:s,sweepFlag:a,xAxisRotation:l,centp:h,a1:u,ad:c}=n.pathA(i),p=1-a?1:-1,d=u+p*(c/2),f=new H(h.x+o*Math.cos(d),h.y+s*Math.sin(d));if(i.addMarkerAngle(f,d-p*Math.PI/2),i.addMarkerAngle(r,d-p*Math.PI),e.addPoint(r.x,r.y),t&&!isNaN(u)&&!isNaN(c)){let m=o>s?o:s,g=o>s?1:o/s,y=o>s?s/o:1;t.translate(h.x,h.y),t.rotate(l),t.scale(g,y),t.arc(0,0,m,u,u+c,!!(1-a)),t.scale(1/g,1/y),t.rotate(-l),t.translate(-h.x,-h.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){n.pathZ(this.pathParser),t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}constructor(t,e,i){super(t,e,i),this.type="path",this.pathParser=new I(this.getAttribute("d").getString())}},St=class extends it{setContext(t){var e;let{document:i}=this,{screen:r,window:o}=i,s=t.canvas;if(r.setDefaults(t),"style"in s&&typeof t.font<"u"&&o&&typeof o.getComputedStyle<"u"){t.font=o.getComputedStyle(s).getPropertyValue("font");let C=new M(i,"fontSize",_e.parse(t.font).fontSize);C.hasValue()&&(i.rootEmSize=C.getPixels("y"),i.emSize=i.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);let{width:a,height:l}=r.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");let h=this.getAttribute("refX"),u=this.getAttribute("refY"),c=this.getAttribute("viewBox"),p=c.hasValue()?Ae(c.getString()):null,d=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",f=0,m=0,g=0,y=0;p&&(f=p[0],m=p[1]),this.root||(a=this.getStyle("width").getPixels("x"),l=this.getStyle("height").getPixels("y"),this.type==="marker"&&(g=f,y=m,f=0,m=0)),r.viewPort.setCurrent(a,l),this.node&&(!this.parent||((e=this.node.parentNode)===null||e===void 0?void 0:e.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(t),t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),p&&(a=p[2],l=p[3]),i.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:r.viewPort.width,desiredWidth:a,height:r.viewPort.height,desiredHeight:l,minX:f,minY:m,refX:h.getValue(),refY:u.getValue(),clip:d,clipX:g,clipY:y}),p&&(r.viewPort.removeCurrent(),r.viewPort.setCurrent(a,l))}clearContext(t){super.clearContext(t),this.document.screen.viewPort.removeCurrent()}resize(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=this.getAttribute("width",!0),o=this.getAttribute("height",!0),s=this.getAttribute("viewBox"),a=this.getAttribute("style"),l=r.getNumber(0),h=o.getNumber(0);if(i)if(typeof i=="string")this.getAttribute("preserveAspectRatio",!0).setValue(i);else{let u=this.getAttribute("preserveAspectRatio");u.hasValue()&&u.setValue(u.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(r.setValue(t),o.setValue(e),s.hasValue()||s.setValue("0 0 ".concat(l||t," ").concat(h||e)),a.hasValue()){let u=this.getStyle("width"),c=this.getStyle("height");u.hasValue()&&u.setValue("".concat(t,"px")),c.hasValue()&&c.setValue("".concat(e,"px"))}}constructor(...t){super(...t),this.type="svg",this.root=!1}},Mn=class extends ee{path(t){let e=this.getAttribute("x").getPixels("x"),i=this.getAttribute("y").getPixels("y"),r=this.getStyle("width",!1,!0).getPixels("x"),o=this.getStyle("height",!1,!0).getPixels("y"),s=this.getAttribute("rx"),a=this.getAttribute("ry"),l=s.getPixels("x"),h=a.getPixels("y");if(s.hasValue()&&!a.hasValue()&&(h=l),a.hasValue()&&!s.hasValue()&&(l=h),l=Math.min(l,r/2),h=Math.min(h,o/2),t){let u=4*((Math.sqrt(2)-1)/3);t.beginPath(),o>0&&r>0&&(t.moveTo(e+l,i),t.lineTo(e+r-l,i),t.bezierCurveTo(e+r-l+u*l,i,e+r,i+h-u*h,e+r,i+h),t.lineTo(e+r,i+o-h),t.bezierCurveTo(e+r,i+o-h+u*h,e+r-l+u*l,i+o,e+r-l,i+o),t.lineTo(e+l,i+o),t.bezierCurveTo(e+l-u*l,i+o,e,i+o-h+u*h,e,i+o-h),t.lineTo(e,i+h),t.bezierCurveTo(e,i+h-u*h,e+l-u*l,i,e+l,i),t.closePath())}return new Me(e,i,e+r,i+o)}getMarkers(){return null}constructor(...t){super(...t),this.type="rect"}},zr=class extends ee{path(t){let e=this.getAttribute("cx").getPixels("x"),i=this.getAttribute("cy").getPixels("y"),r=this.getAttribute("r").getPixels();return t&&r>0&&(t.beginPath(),t.arc(e,i,r,0,Math.PI*2,!1),t.closePath()),new Me(e-r,i-r,e+r,i+r)}getMarkers(){return null}constructor(...t){super(...t),this.type="circle"}},Wr=class extends ee{path(t){let e=4*((Math.sqrt(2)-1)/3),i=this.getAttribute("rx").getPixels("x"),r=this.getAttribute("ry").getPixels("y"),o=this.getAttribute("cx").getPixels("x"),s=this.getAttribute("cy").getPixels("y");return t&&i>0&&r>0&&(t.beginPath(),t.moveTo(o+i,s),t.bezierCurveTo(o+i,s+e*r,o+e*i,s+r,o,s+r),t.bezierCurveTo(o-e*i,s+r,o-i,s+e*r,o-i,s),t.bezierCurveTo(o-i,s-e*r,o-e*i,s-r,o,s-r),t.bezierCurveTo(o+e*i,s-r,o+i,s-e*r,o+i,s),t.closePath()),new Me(o-i,s-r,o+i,s+r)}getMarkers(){return null}constructor(...t){super(...t),this.type="ellipse"}},Fr=class extends ee{getPoints(){return[new H(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new H(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){let[{x:e,y:i},{x:r,y:o}]=this.getPoints();return t&&(t.beginPath(),t.moveTo(e,i),t.lineTo(r,o)),new Me(e,i,r,o)}getMarkers(){let[t,e]=this.getPoints(),i=t.angleTo(e);return[[t,i],[e,i]]}constructor(...t){super(...t),this.type="line"}},Rn=class extends ee{path(t){let{points:e}=this,[{x:i,y:r}]=e,o=new Me(i,r);return t&&(t.beginPath(),t.moveTo(i,r)),e.forEach(s=>{let{x:a,y:l}=s;o.addPoint(a,l),t&&t.lineTo(a,l)}),o}getMarkers(){let{points:t}=this,e=t.length-1,i=[];return t.forEach((r,o)=>{o!==e&&i.push([r,r.angleTo(t[o+1])])}),i.length>0&&i.push([t[t.length-1],i[i.length-1][1]]),i}constructor(t,e,i){super(t,e,i),this.type="polyline",this.points=[],this.points=H.parsePath(this.getAttribute("points").getString())}},Hr=class extends Rn{path(t){let e=super.path(t),[{x:i,y:r}]=this.points;return t&&(t.lineTo(i,r),t.closePath()),e}constructor(...t){super(...t),this.type="polygon"}},Yr=class extends z{createPattern(t,e,i){let r=this.getStyle("width").getPixels("x",!0),o=this.getStyle("height").getPixels("y",!0),s=new St(this.document,null);s.attributes.set("viewBox",new M(this.document,"viewBox",this.getAttribute("viewBox").getValue())),s.attributes.set("width",new M(this.document,"width","".concat(r,"px"))),s.attributes.set("height",new M(this.document,"height","".concat(o,"px"))),s.attributes.set("transform",new M(this.document,"transform",this.getAttribute("patternTransform").getValue())),s.children=this.children;let a=this.document.createCanvas(r,o),l=a.getContext("2d"),h=this.getAttribute("x"),u=this.getAttribute("y");h.hasValue()&&u.hasValue()&&l.translate(h.getPixels("x",!0),u.getPixels("y",!0)),i.hasValue()?this.styles.set("fill-opacity",i):this.styles.delete("fill-opacity");for(let p=-1;p<=1;p++)for(let d=-1;d<=1;d++)l.save(),s.attributes.set("x",new M(this.document,"x",p*a.width)),s.attributes.set("y",new M(this.document,"y",d*a.height)),s.render(l),l.restore();return t.createPattern(a,"repeat")}constructor(...t){super(...t),this.type="pattern"}},qr=class extends z{render(t,e,i){if(!e)return;let{x:r,y:o}=e,s=this.getAttribute("orient").getString("auto"),a=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(r,o),s==="auto"&&t.rotate(i),a==="strokeWidth"&&t.scale(t.lineWidth,t.lineWidth),t.save();let l=new St(this.document);l.type=this.type,l.attributes.set("viewBox",new M(this.document,"viewBox",this.getAttribute("viewBox").getValue())),l.attributes.set("refX",new M(this.document,"refX",this.getAttribute("refX").getValue())),l.attributes.set("refY",new M(this.document,"refY",this.getAttribute("refY").getValue())),l.attributes.set("width",new M(this.document,"width",this.getAttribute("markerWidth").getValue())),l.attributes.set("height",new M(this.document,"height",this.getAttribute("markerHeight").getValue())),l.attributes.set("overflow",new M(this.document,"overflow",this.getAttribute("overflow").getValue())),l.attributes.set("fill",new M(this.document,"fill",this.getAttribute("fill").getColor("black"))),l.attributes.set("stroke",new M(this.document,"stroke",this.getAttribute("stroke").getValue("none"))),l.children=this.children,l.render(t),t.restore(),a==="strokeWidth"&&t.scale(1/t.lineWidth,1/t.lineWidth),s==="auto"&&t.rotate(-i),t.translate(-r,-o)}constructor(...t){super(...t),this.type="marker"}},Gr=class extends z{render(){}constructor(...t){super(...t),this.type="defs"}},Ri=class extends it{getBoundingBox(t){let e=new Me;return this.children.forEach(i=>{e.addBoundingBox(i.getBoundingBox(t))}),e}constructor(...t){super(...t),this.type="g"}},In=class extends z{getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,i){let r=this;this.getHrefAttribute().hasValue()&&(r=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(r));let{stops:o}=r,s=this.getGradient(t,e);if(!s)return this.addParentOpacity(i,o[o.length-1].color);if(o.forEach(a=>{s.addColorStop(a.offset,this.addParentOpacity(i,a.color))}),this.getAttribute("gradientTransform").hasValue()){let{document:a}=this,{MAX_VIRTUAL_PIXELS:l}=tt,{viewPort:h}=a.screen,u=h.getRoot(),c=new Mn(a);c.attributes.set("x",new M(a,"x",-l/3)),c.attributes.set("y",new M(a,"y",-l/3)),c.attributes.set("width",new M(a,"width",l)),c.attributes.set("height",new M(a,"height",l));let p=new Ri(a);p.attributes.set("transform",new M(a,"transform",this.getAttribute("gradientTransform").getValue())),p.children=[c];let d=new St(a);d.attributes.set("x",new M(a,"x",0)),d.attributes.set("y",new M(a,"y",0)),d.attributes.set("width",new M(a,"width",u.width)),d.attributes.set("height",new M(a,"height",u.height)),d.children=[p];let f=a.createCanvas(u.width,u.height),m=f.getContext("2d");return m.fillStyle=s,d.render(m),m.createPattern(f,"no-repeat")}return s}inheritStopContainer(t){this.attributesToInherit.forEach(e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,!0).setValue(t.getAttribute(e).getValue())})}addParentOpacity(t,e){return t.hasValue()?new M(this.document,"color",e).addOpacity(t).getColor():e}constructor(t,e,i){super(t,e,i),this.attributesToInherit=["gradientUnits"],this.stops=[];let{stops:r,children:o}=this;o.forEach(s=>{s.type==="stop"&&r.push(s)})}},Xr=class extends In{getGradient(t,e){let i=this.getGradientUnits()==="objectBoundingBox",r=i?e.getBoundingBox(t):null;if(i&&!r)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));let o=i?r.x+r.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),s=i?r.y+r.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),a=i?r.x+r.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),l=i?r.y+r.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return o===a&&s===l?null:t.createLinearGradient(o,s,a,l)}constructor(t,e,i){super(t,e,i),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}},Kr=class extends In{getGradient(t,e){let i=this.getGradientUnits()==="objectBoundingBox",r=e.getBoundingBox(t);if(i&&!r)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");let o=i?r.x+r.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),s=i?r.y+r.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),a=o,l=s;this.getAttribute("fx").hasValue()&&(a=i?r.x+r.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(l=i?r.y+r.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));let h=i?(r.width+r.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),u=this.getAttribute("fr").getPixels();return t.createRadialGradient(a,l,u,o,s,h)}constructor(t,e,i){super(t,e,i),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}},jr=class extends z{constructor(t,e,i){super(t,e,i),this.type="stop";let r=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),o=this.getStyle("stop-opacity"),s=this.getStyle("stop-color",!0);s.getString()===""&&s.setValue("#000"),o.hasValue()&&(s=s.addOpacity(o)),this.offset=r,this.color=s.getColor()}},Ii=class extends z{getProperty(){let t=this.getAttribute("attributeType").getString(),e=this.getAttribute("attributeName").getString();return t==="CSS"?this.parent.getStyle(e,!0):this.parent.getAttribute(e,!0)}calcValue(){let{initialUnits:t}=this,{progress:e,from:i,to:r}=this.getProgress(),o=i.getNumber()+(r.getNumber()-i.getNumber())*e;return t==="%"&&(o*=100),"".concat(o).concat(t)}update(t){let{parent:e}=this,i=this.getProperty();if(this.initialValue||(this.initialValue=i.getString(),this.initialUnits=i.getUnits()),this.duration>this.maxDuration){let o=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(o==="freeze"&&!this.frozen)this.frozen=!0,e&&i&&(e.animationFrozen=!0,e.animationFrozenValue=i.getString());else if(o==="remove"&&!this.removed)return this.removed=!0,e&&i&&i.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=t;let r=!1;if(this.begin<this.duration){let o=this.calcValue(),s=this.getAttribute("type");if(s.hasValue()){let a=s.getString();o="".concat(a,"(").concat(o,")")}i.setValue(o),r=!0}return r}getProgress(){let{document:t,values:e}=this,i=(this.duration-this.begin)/(this.maxDuration-this.begin),r,o;if(e.hasValue()){let s=i*(e.getValue().length-1),a=Math.floor(s),l=Math.ceil(s),h;h=e.getValue()[a],r=new M(t,"from",h?parseFloat(h):0),h=e.getValue()[l],o=new M(t,"to",h?parseFloat(h):0),i=(s-a)/(l-a)}else r=this.from,o=this.to;return{progress:i,from:r,to:o}}constructor(t,e,i){super(t,e,i),this.type="animate",this.duration=0,this.initialUnits="",this.removed=!1,this.frozen=!1,t.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new M(t,"values",null);let r=this.getAttribute("values");r.hasValue()&&this.values.setValue(r.getString().split(";"))}},$r=class extends Ii{calcValue(){let{progress:t,from:e,to:i}=this.getProgress(),r=new Sn.default(e.getColor()),o=new Sn.default(i.getColor());if(r.ok&&o.ok){let s=r.r+(o.r-r.r)*t,a=r.g+(o.g-r.g)*t,l=r.b+(o.b-r.b)*t;return"rgb(".concat(Math.floor(s),", ").concat(Math.floor(a),", ").concat(Math.floor(l),")")}return this.getAttribute("from").getColor()}constructor(...t){super(...t),this.type="animateColor"}},Qr=class extends Ii{calcValue(){let{progress:t,from:e,to:i}=this.getProgress(),r=Ae(e.getString()),o=Ae(i.getString());return r.map((a,l)=>{let h=o[l];return a+(h-a)*t}).join(" ")}constructor(...t){super(...t),this.type="animateTransform"}},Pn=class extends z{constructor(t,e,i){super(t,e,i),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}},Pi=class extends ee{constructor(t,e,i){super(t,e,i),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}},On=class extends Pi{constructor(...t){super(...t),this.type="missing-glyph",this.horizAdvX=0}},Zr=class extends z{render(){}constructor(t,e,i){super(t,e,i),this.type="font",this.isArabic=!1,this.glyphs=new Map,this.arabicGlyphs=new Map,this.isRTL=!1,this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();let{definitions:r}=t,{children:o}=this;for(let s of o)if(s instanceof Pn){this.fontFace=s;let a=s.getStyle("font-family");a.hasValue()&&r.set(a.getString(),this)}else if(s instanceof On)this.missingGlyph=s;else if(s instanceof Pi)if(s.arabicForm){this.isRTL=!0,this.isArabic=!0;let a=this.arabicGlyphs.get(s.unicode);typeof a>"u"&&(a=new Map,this.arabicGlyphs.set(s.unicode,a)),a.set(s.arabicForm,s)}else this.glyphs.set(s.unicode,s)}},Jr=class extends xt{getText(){let t=this.getHrefAttribute().getDefinition();if(t){let e=t.children[0];if(e)return e.getText()}return""}constructor(...t){super(...t),this.type="tref"}},eo=class extends xt{getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);let{document:e,x:i,y:r}=this,{mouse:o}=e.screen,s=new M(e,"fontSize",_e.parse(e.ctx.font).fontSize);o.isWorking()&&o.checkBoundingBox(this,new Me(i,r-s.getPixels("y"),i+this.measureText(t),r))}else if(this.children.length>0){let e=new Ri(this.document);e.children=this.children,e.parent=this,e.render(t)}}onClick(){let{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){let t=this.document.ctx;t.canvas.style.cursor="pointer"}constructor(t,e,i){super(t,e,i),this.type="a";let{childNodes:r}=e,o=r[0],s=r.length>0&&Array.from(r).every(a=>a.nodeType===3);this.hasText=s,this.text=s?this.getTextFromNode(o):""}},to=class extends xt{getText(){return this.text}path(t){let{dataArray:e}=this;t&&t.beginPath(),e.forEach(i=>{let{type:r,points:o}=i;switch(r){case I.LINE_TO:t&&t.lineTo(o[0],o[1]);break;case I.MOVE_TO:t&&t.moveTo(o[0],o[1]);break;case I.CURVE_TO:t&&t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case I.QUAD_TO:t&&t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case I.ARC:{let[s,a,l,h,u,c,p,d]=o,f=l>h?l:h,m=l>h?1:l/h,g=l>h?h/l:1;t&&(t.translate(s,a),t.rotate(p),t.scale(m,g),t.arc(0,0,f,u,u+c,!!(1-d)),t.scale(1/m,1/g),t.rotate(-p),t.translate(-s,-a));break}case I.CLOSE_PATH:t&&t.closePath();break}})}renderChildren(t){this.setTextData(t),t.save();let e=this.parent.getStyle("text-decoration").getString(),i=this.getFontSize(),{glyphInfo:r}=this,o=t.fillStyle;e==="underline"&&t.beginPath(),r.forEach((s,a)=>{let{p0:l,p1:h,rotation:u,text:c}=s;t.save(),t.translate(l.x,l.y),t.rotate(u),t.fillStyle&&t.fillText(c,0,0),t.strokeStyle&&t.strokeText(c,0,0),t.restore(),e==="underline"&&(a===0&&t.moveTo(l.x,l.y+i/8),t.lineTo(h.x,h.y+i/5))}),e==="underline"&&(t.lineWidth=i/20,t.strokeStyle=o,t.stroke(),t.closePath()),t.restore()}getLetterSpacingAt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,i,r,o,s,a,l,h){let u=s,c=this.measureText(t,l);l===" "&&e==="justify"&&i<r&&(c+=(r-i)/o),h>-1&&(u+=this.getLetterSpacingAt(h));let p=this.textHeight/20,d=this.getEquidistantPointOnPath(u,p,0),f=this.getEquidistantPointOnPath(u+c,p,0),m={p0:d,p1:f},g=d&&f?Math.atan2(f.y-d.y,f.x-d.x):0;if(a){let y=Math.cos(Math.PI/2+g)*a,C=Math.cos(-g)*a;m.p0={...d,x:d.x+y,y:d.y+C},m.p1={...f,x:f.x+y,y:f.y+C}}return u+=c,{offset:u,segment:m,rotation:g}}measureText(t,e){let{measuresCache:i}=this,r=e||this.getText();if(i.has(r))return i.get(r);let o=this.measureTargetText(t,r);return i.set(r,o),o}setTextData(t){if(this.glyphInfo)return;let e=this.getText(),i=e.split(""),r=e.split(" ").length-1,o=this.parent.getAttribute("dx").split().map(T=>T.getPixels("x")),s=this.parent.getAttribute("dy").getPixels("y"),a=this.parent.getStyle("text-anchor").getString("start"),l=this.getStyle("letter-spacing"),h=this.parent.getStyle("letter-spacing"),u=0;!l.hasValue()||l.getValue()==="inherit"?u=h.getPixels():l.hasValue()&&l.getValue()!=="initial"&&l.getValue()!=="unset"&&(u=l.getPixels());let c=[],p=e.length;this.letterSpacingCache=c;for(let T=0;T<p;T++)c.push(typeof o[T]<"u"?o[T]:u);let d=c.reduce((T,S,N)=>N===0?0:T+S||0,0),f=this.measureText(t),m=Math.max(f+d,0);this.textWidth=f,this.textHeight=this.getFontSize(),this.glyphInfo=[];let g=this.getPathLength(),y=this.getStyle("startOffset").getNumber(0)*g,C=0;(a==="middle"||a==="center")&&(C=-m/2),(a==="end"||a==="right")&&(C=-m),C+=y,i.forEach((T,S)=>{let{offset:N,segment:L,rotation:R}=this.findSegmentToFitChar(t,a,m,g,r,C,s,T,S);C=N,!(!L.p0||!L.p1)&&this.glyphInfo.push({text:i[S],p0:L.p0,p1:L.p1,rotation:R})})}parsePathData(t){if(this.pathLength=-1,!t)return[];let e=[],{pathParser:i}=t;for(i.reset();!i.isEnd();){let{current:r}=i,o=r?r.x:0,s=r?r.y:0,a=i.next(),l=a.type,h=[];switch(a.type){case I.MOVE_TO:this.pathM(i,h);break;case I.LINE_TO:l=this.pathL(i,h);break;case I.HORIZ_LINE_TO:l=this.pathH(i,h);break;case I.VERT_LINE_TO:l=this.pathV(i,h);break;case I.CURVE_TO:this.pathC(i,h);break;case I.SMOOTH_CURVE_TO:l=this.pathS(i,h);break;case I.QUAD_TO:this.pathQ(i,h);break;case I.SMOOTH_QUAD_TO:l=this.pathT(i,h);break;case I.ARC:h=this.pathA(i);break;case I.CLOSE_PATH:ee.pathZ(i);break}a.type!==I.CLOSE_PATH?e.push({type:l,points:h,start:{x:o,y:s},pathLength:this.calcLength(o,s,l,h)}):e.push({type:I.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){let{x:i,y:r}=ee.pathM(t).point;e.push(i,r)}pathL(t,e){let{x:i,y:r}=ee.pathL(t).point;return e.push(i,r),I.LINE_TO}pathH(t,e){let{x:i,y:r}=ee.pathH(t).point;return e.push(i,r),I.LINE_TO}pathV(t,e){let{x:i,y:r}=ee.pathV(t).point;return e.push(i,r),I.LINE_TO}pathC(t,e){let{point:i,controlPoint:r,currentPoint:o}=ee.pathC(t);e.push(i.x,i.y,r.x,r.y,o.x,o.y)}pathS(t,e){let{point:i,controlPoint:r,currentPoint:o}=ee.pathS(t);return e.push(i.x,i.y,r.x,r.y,o.x,o.y),I.CURVE_TO}pathQ(t,e){let{controlPoint:i,currentPoint:r}=ee.pathQ(t);e.push(i.x,i.y,r.x,r.y)}pathT(t,e){let{controlPoint:i,currentPoint:r}=ee.pathT(t);return e.push(i.x,i.y,r.x,r.y),I.QUAD_TO}pathA(t){let{rX:e,rY:i,sweepFlag:r,xAxisRotation:o,centp:s,a1:a,ad:l}=ee.pathA(t);return r===0&&l>0&&(l-=2*Math.PI),r===1&&l<0&&(l+=2*Math.PI),[s.x,s.y,e,i,a,l,o,r]}calcLength(t,e,i,r){let o=0,s=null,a=null,l=0;switch(i){case I.LINE_TO:return this.getLineLength(t,e,r[0],r[1]);case I.CURVE_TO:for(o=0,s=this.getPointOnCubicBezier(0,t,e,r[0],r[1],r[2],r[3],r[4],r[5]),l=.01;l<=1;l+=.01)a=this.getPointOnCubicBezier(l,t,e,r[0],r[1],r[2],r[3],r[4],r[5]),o+=this.getLineLength(s.x,s.y,a.x,a.y),s=a;return o;case I.QUAD_TO:for(o=0,s=this.getPointOnQuadraticBezier(0,t,e,r[0],r[1],r[2],r[3]),l=.01;l<=1;l+=.01)a=this.getPointOnQuadraticBezier(l,t,e,r[0],r[1],r[2],r[3]),o+=this.getLineLength(s.x,s.y,a.x,a.y),s=a;return o;case I.ARC:{o=0;let h=r[4],u=r[5],c=r[4]+u,p=Math.PI/180;if(Math.abs(h-c)<p&&(p=Math.abs(h-c)),s=this.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],h,0),u<0)for(l=h-p;l>c;l-=p)a=this.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],l,0),o+=this.getLineLength(s.x,s.y,a.x,a.y),s=a;else for(l=h+p;l<c;l+=p)a=this.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],l,0),o+=this.getLineLength(s.x,s.y,a.x,a.y),s=a;return a=this.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],c,0),o+=this.getLineLength(s.x,s.y,a.x,a.y),o}}return 0}getPointOnLine(t,e,i,r,o){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:e,a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:i,l=(o-i)/(r-e+Vt),h=Math.sqrt(t*t/(1+l*l));r<e&&(h*=-1);let u=l*h,c=null;if(r===e)c={x:s,y:a+u};else if((a-i)/(s-e+Vt)===l)c={x:s+h,y:a+u};else{let p=0,d=0,f=this.getLineLength(e,i,r,o);if(f<Vt)return null;let m=(s-e)*(r-e)+(a-i)*(o-i);m/=f*f,p=e+m*(r-e),d=i+m*(o-i);let g=this.getLineLength(s,a,p,d),y=Math.sqrt(t*t-g*g);h=Math.sqrt(y*y/(1+l*l)),r<e&&(h*=-1),u=l*h,c={x:p+h,y:d+u}}return c}getPointOnPath(t){let e=this.getPathLength(),i=0,r=null;if(t<-5e-5||t-5e-5>e)return null;let{dataArray:o}=this;for(let s of o){if(s&&(s.pathLength<5e-5||i+s.pathLength+5e-5<t)){i+=s.pathLength;continue}let a=t-i,l=0;switch(s.type){case I.LINE_TO:r=this.getPointOnLine(a,s.start.x,s.start.y,s.points[0],s.points[1],s.start.x,s.start.y);break;case I.ARC:{let h=s.points[4],u=s.points[5],c=s.points[4]+u;if(l=h+a/s.pathLength*u,u<0&&l<c||u>=0&&l>c)break;r=this.getPointOnEllipticalArc(s.points[0],s.points[1],s.points[2],s.points[3],l,s.points[6]);break}case I.CURVE_TO:l=a/s.pathLength,l>1&&(l=1),r=this.getPointOnCubicBezier(l,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3],s.points[4],s.points[5]);break;case I.QUAD_TO:l=a/s.pathLength,l>1&&(l=1),r=this.getPointOnQuadraticBezier(l,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3]);break}if(r)return r;break}return null}getLineLength(t,e,i,r){return Math.sqrt((i-t)*(i-t)+(r-e)*(r-e))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((t,e)=>e.pathLength>0?t+e.pathLength:t,0)),this.pathLength}getPointOnCubicBezier(t,e,i,r,o,s,a,l,h){let u=l*js(t)+s*$s(t)+r*Qs(t)+e*Zs(t),c=h*js(t)+a*$s(t)+o*Qs(t)+i*Zs(t);return{x:u,y:c}}getPointOnQuadraticBezier(t,e,i,r,o,s,a){let l=s*Js(t)+r*ea(t)+e*ta(t),h=a*Js(t)+o*ea(t)+i*ta(t);return{x:l,y:h}}getPointOnEllipticalArc(t,e,i,r,o,s){let a=Math.cos(s),l=Math.sin(s),h={x:i*Math.cos(o),y:r*Math.sin(o)};return{x:t+(h.x*a-h.y*l),y:e+(h.x*l+h.y*a)}}buildEquidistantCache(t,e){let i=this.getPathLength(),r=e||.25,o=t||i/100;if(!this.equidistantCache||this.equidistantCache.step!==o||this.equidistantCache.precision!==r){this.equidistantCache={step:o,precision:r,points:[]};let s=0;for(let a=0;a<=i;a+=r){let l=this.getPointOnPath(a),h=this.getPointOnPath(a+r);!l||!h||(s+=this.getLineLength(l.x,l.y,h.x,h.y),s>=o&&(this.equidistantCache.points.push({x:l.x,y:l.y,distance:a}),s-=o))}}}getEquidistantPointOnPath(t,e,i){if(this.buildEquidistantCache(e,i),t<0||t-this.getPathLength()>5e-5)return null;let r=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[r]||null}constructor(t,e,i){super(t,e,i),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);let r=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(r)}},Xh=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i,io=class extends it{async loadImage(t){try{let e=await this.document.createImage(t);this.image=e}catch(e){console.error('Error while loading image "'.concat(t,'":'),e)}this.loaded=!0}async loadSvg(t){let e=Xh.exec(t);if(e){let i=e[5];i&&(e[4]==="base64"?this.image=atob(i):this.image=decodeURIComponent(i))}else try{let r=await(await this.document.fetch(t)).text();this.image=r}catch(i){console.error('Error while loading image "'.concat(t,'":'),i)}this.loaded=!0}renderChildren(t){let{document:e,image:i,loaded:r}=this,o=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),l=this.getStyle("height").getPixels("y");if(!(!r||!i||!a||!l)){if(t.save(),t.translate(o,s),typeof i=="string"){let h=e.canvg.forkString(t,i,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:a,scaleHeight:l}),{documentElement:u}=h.document;u&&(u.parent=this),h.render()}else e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:a,desiredWidth:i.width,height:l,desiredHeight:i.height}),this.loaded&&(!("complete"in i)||i.complete)&&t.drawImage(i,0,0);t.restore()}}getBoundingBox(){let t=this.getAttribute("x").getPixels("x"),e=this.getAttribute("y").getPixels("y"),i=this.getStyle("width").getPixels("x"),r=this.getStyle("height").getPixels("y");return new Me(t,e,t+i,e+r)}constructor(t,e,i){super(t,e,i),this.type="image",this.loaded=!1;let r=this.getHrefAttribute().getString();if(!r)return;let o=r.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(r);t.images.push(this),o?this.loadSvg(r):this.loadImage(r)}},no=class extends it{render(t){}constructor(...t){super(...t),this.type="symbol"}},ro=class{async load(t,e){try{let{document:i}=this,o=(await i.canvg.parser.load(e)).getElementsByTagName("font");Array.from(o).forEach(s=>{let a=i.createElement(s);i.definitions.set(t,a)})}catch(i){console.error('Error while loading font "'.concat(e,'":'),i)}this.loaded=!0}constructor(t){this.document=t,this.loaded=!1,t.fonts.push(this)}},Ln=class extends z{constructor(t,e,i){super(t,e,i),this.type="style",Ft(Array.from(e.childNodes).map(s=>s.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")).split("}").forEach(s=>{let a=s.trim();if(!a)return;let l=a.split("{"),h=l[0].split(","),u=l[1].split(";");h.forEach(c=>{let p=c.trim();if(!p)return;let d=t.styles.get(p)||new Map;if(u.forEach(f=>{let m=f.indexOf(":"),g=f.substr(0,m).trim(),y=f.substr(m+1,f.length-m).trim();g&&y&&d.set(g,new M(t,g,y))}),t.styles.set(p,d),t.stylesSpecificity.set(p,Vh(p)),p==="@font-face"){let f=d.get("font-family").getString().replace(/"|'/g,"");d.get("src").getString().split(",").forEach(g=>{if(g.indexOf('format("svg")')>0){let y=ra(g);y&&new ro(t).load(f,y)}})}})})}};Ln.parseExternalUrl=ra;var oo=class extends it{setContext(t){super.setContext(t);let e=this.getAttribute("x"),i=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0),i.hasValue()&&t.translate(0,i.getPixels("y"))}path(t){let{element:e}=this;e&&e.path(t)}renderChildren(t){let{document:e,element:i}=this;if(i){let r=i;if(i.type==="symbol"&&(r=new St(e),r.attributes.set("viewBox",new M(e,"viewBox",i.getAttribute("viewBox").getString())),r.attributes.set("preserveAspectRatio",new M(e,"preserveAspectRatio",i.getAttribute("preserveAspectRatio").getString())),r.attributes.set("overflow",new M(e,"overflow",i.getAttribute("overflow").getString())),r.children=i.children,i.styles.set("opacity",new M(e,"opacity",this.calculateOpacity()))),r.type==="svg"){let s=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);s.hasValue()&&r.attributes.set("width",new M(e,"width",s.getString())),a.hasValue()&&r.attributes.set("height",new M(e,"height",a.getString()))}let o=r.parent;r.parent=this,r.render(t),r.parent=o}}getBoundingBox(t){let{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){let{document:t,element:e}=this;return e?Ut.fromElement(t,e):null}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}constructor(...t){super(...t),this.type="use"}};function Cn(n,t,e,i,r,o){return n[e*i*4+t*4+o]}function Tn(n,t,e,i,r,o,s){n[e*i*4+t*4+o]=s}function Q(n,t,e){return n[t]*e}function et(n,t,e,i){return t+Math.cos(n)*e+Math.sin(n)*i}var kn=class extends z{apply(t,e,i,r,o){let{includeOpacity:s,matrix:a}=this,l=t.getImageData(0,0,r,o);for(let h=0;h<o;h++)for(let u=0;u<r;u++){let c=Cn(l.data,u,h,r,o,0),p=Cn(l.data,u,h,r,o,1),d=Cn(l.data,u,h,r,o,2),f=Cn(l.data,u,h,r,o,3),m=Q(a,0,c)+Q(a,1,p)+Q(a,2,d)+Q(a,3,f)+Q(a,4,1),g=Q(a,5,c)+Q(a,6,p)+Q(a,7,d)+Q(a,8,f)+Q(a,9,1),y=Q(a,10,c)+Q(a,11,p)+Q(a,12,d)+Q(a,13,f)+Q(a,14,1),C=Q(a,15,c)+Q(a,16,p)+Q(a,17,d)+Q(a,18,f)+Q(a,19,1);s&&(m=0,g=0,y=0,C*=f/255),Tn(l.data,u,h,r,o,0,m),Tn(l.data,u,h,r,o,1,g),Tn(l.data,u,h,r,o,2,y),Tn(l.data,u,h,r,o,3,C)}t.clearRect(0,0,r,o),t.putImageData(l,0,0)}constructor(t,e,i){super(t,e,i),this.type="feColorMatrix";let r=Ae(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{let o=r[0];r=[.213+.787*o,.715-.715*o,.072-.072*o,0,0,.213-.213*o,.715+.285*o,.072-.072*o,0,0,.213-.213*o,.715-.715*o,.072+.928*o,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{let o=r[0]*Math.PI/180;r=[et(o,.213,.787,-.213),et(o,.715,-.715,-.715),et(o,.072,-.072,.928),0,0,et(o,.213,-.213,.143),et(o,.715,.285,.14),et(o,.072,-.072,-.283),0,0,et(o,.213,-.213,-.787),et(o,.715,-.715,.715),et(o,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=r,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}},Dn=class n extends z{apply(t,e){let{document:i}=this,r=this.getAttribute("x").getPixels("x"),o=this.getAttribute("y").getPixels("y"),s=this.getStyle("width").getPixels("x"),a=this.getStyle("height").getPixels("y");if(!s&&!a){let d=new Me;this.children.forEach(f=>{d.addBoundingBox(f.getBoundingBox(t))}),r=Math.floor(d.x1),o=Math.floor(d.y1),s=Math.floor(d.width),a=Math.floor(d.height)}let l=this.removeStyles(e,n.ignoreStyles),h=i.createCanvas(r+s,o+a),u=h.getContext("2d");i.screen.setDefaults(u),this.renderChildren(u),new kn(i,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(u,0,0,r+s,o+a);let c=i.createCanvas(r+s,o+a),p=c.getContext("2d");i.screen.setDefaults(p),e.render(p),p.globalCompositeOperation="destination-in",p.fillStyle=u.createPattern(h,"no-repeat"),p.fillRect(0,0,r+s,o+a),t.fillStyle=p.createPattern(c,"no-repeat"),t.fillRect(0,0,r+s,o+a),this.restoreStyles(e,l)}render(t){}constructor(...t){super(...t),this.type="mask"}};Dn.ignoreStyles=["mask","transform","clip-path"];var na=()=>{},so=class extends z{apply(t){let{document:e}=this,i=Reflect.getPrototypeOf(t),{beginPath:r,closePath:o}=t;i&&(i.beginPath=na,i.closePath=na),Reflect.apply(r,t,[]),this.children.forEach(s=>{if(!("path"in s))return;let a="elementTransform"in s?s.elementTransform():null;a||(a=Ut.fromElement(e,s)),a&&a.apply(t),s.path(t),i&&(i.closePath=o),a&&a.unapply(t)}),Reflect.apply(o,t,[]),t.clip(),i&&(i.beginPath=r,i.closePath=o)}render(t){}constructor(...t){super(...t),this.type="clipPath"}},Nn=class n extends z{apply(t,e){let{document:i,children:r}=this,o="getBoundingBox"in e?e.getBoundingBox(t):null;if(!o)return;let s=0,a=0;r.forEach(y=>{let C=y.extraFilterDistance||0;s=Math.max(s,C),a=Math.max(a,C)});let l=Math.floor(o.width),h=Math.floor(o.height),u=l+2*s,c=h+2*a;if(u<1||c<1)return;let p=Math.floor(o.x),d=Math.floor(o.y),f=this.removeStyles(e,n.ignoreStyles),m=i.createCanvas(u,c),g=m.getContext("2d");i.screen.setDefaults(g),g.translate(-p+s,-d+a),e.render(g),r.forEach(y=>{typeof y.apply=="function"&&y.apply(g,0,0,u,c)}),t.drawImage(m,0,0,u,c,p-s,d-a,u,c),this.restoreStyles(e,f)}render(t){}constructor(...t){super(...t),this.type="filter"}};Nn.ignoreStyles=["filter","transform","clip-path"];var ao=class extends z{apply(t,e,i,r,o){}constructor(t,e,i){super(t,e,i),this.type="feDropShadow",this.addStylesFromStyleDefinition()}},lo=class extends z{apply(t,e,i,r,o){}constructor(...t){super(...t),this.type="feMorphology"}},ho=class extends z{apply(t,e,i,r,o){}constructor(...t){super(...t),this.type="feComposite"}},uo=class extends z{apply(t,e,i,r,o){let{document:s,blurRadius:a}=this,l=s.window?s.window.document.body:null,h=t.canvas;h.id=s.getUniqueId(),l&&(h.style.display="none",l.appendChild(h)),Gs(h,e,i,r,o,a),l&&l.removeChild(h)}constructor(t,e,i){super(t,e,i),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}},co=class extends z{constructor(...t){super(...t),this.type="title"}},po=class extends z{constructor(...t){super(...t),this.type="desc"}},Kh={svg:St,rect:Mn,circle:zr,ellipse:Wr,line:Fr,polyline:Rn,polygon:Hr,path:ee,pattern:Yr,marker:qr,defs:Gr,linearGradient:Xr,radialGradient:Kr,stop:jr,animate:Ii,animateColor:$r,animateTransform:Qr,font:Zr,"font-face":Pn,"missing-glyph":On,glyph:Pi,text:xt,tspan:An,tref:Jr,a:eo,textPath:to,image:io,g:Ri,symbol:no,style:Ln,use:oo,mask:Dn,clipPath:so,filter:Nn,feDropShadow:ao,feMorphology:lo,feComposite:ho,feColorMatrix:kn,feGaussianBlur:uo,title:co,desc:po};function jh(n,t){let e=document.createElement("canvas");return e.width=n,e.height=t,e}async function $h(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=document.createElement("img");return t&&(e.crossOrigin="Anonymous"),new Promise((i,r)=>{e.onload=()=>{i(e)},e.onerror=(o,s,a,l,h)=>{r(h)},e.src=n})}var Pr=12,zt=class n{bindCreateImage(t,e){return typeof e=="boolean"?(i,r)=>t(i,typeof r=="boolean"?r:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){let{emSizeStack:t}=this;return t[t.length-1]||Pr}set emSize(t){let{emSizeStack:e}=this;e.push(t)}popEmSize(){let{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(t=>t.loaded)}isFontsLoaded(){return this.fonts.every(t=>t.loaded)}createDocumentElement(t){let e=this.createElement(t.documentElement);return e.root=!0,e.addStylesFromStyleDefinition(),this.documentElement=e,e}createElement(t){let e=t.nodeName.replace(/^[^:]+:/,""),i=n.elementTypes[e];return i?new i(this,t):new Vr(this,t)}createTextNode(t){return new Ur(this,t)}setViewBox(t){this.screen.setViewBox({document:this,...t})}constructor(t,{rootEmSize:e=Pr,emSize:i=Pr,createCanvas:r=n.createCanvas,createImage:o=n.createImage,anonymousCrossOrigin:s}={}){this.canvg=t,this.definitions=new Map,this.styles=new Map,this.stylesSpecificity=new Map,this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=t.screen,this.rootEmSize=e,this.emSize=i,this.createCanvas=r,this.createImage=this.bindCreateImage(o,s),this.screen.wait(()=>this.isImagesLoaded()),this.screen.wait(()=>this.isFontsLoaded())}};zt.createCanvas=jh;zt.createImage=$h;zt.elementTypes=Kh;var Wt=class n{static async from(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=await new Mi(i).parse(e);return new n(t,o,i)}static fromString(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=new Mi(i).parseFromString(e);return new n(t,o,i)}fork(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n.from(t,e,{...this.options,...i})}forkString(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n.fromString(t,e,{...this.options,...i})}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}async render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.start({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0,...t}),await this.ready(),this.stop()}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:e,screen:i,options:r}=this;i.start(e,{enableRedraw:!0,...r,...t})}stop(){this.screen.stop()}resize(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(t,e,i)}constructor(t,e,i={}){this.parser=new Mi(i),this.screen=new tt(t,i),this.options=i;let r=new zt(this,i),o=r.createDocumentElement(e);this.document=r,this.documentElement=o}};var aa,la,_n=class extends(la=v,aa=ne,la){constructor(e){super();this.layoutOptions=e;this[aa]=!1}layout(e){return X.layout(v.computePointerLike(this.layoutOptions),e)}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v;return super.getCacheKey(e)+i+Object.values(v.computePointerLike(this.layoutOptions)).join(i)}invalidateLayoutCache(){this.layoutCache.invalidate()}},wt=class extends _n{constructor(e,i){super(e);this.drawer=i}render(e){super.render(e),e.save(),e.translate(this.x,this.y),this.drawer(e),e.restore()}},pe=class extends _n{constructor(e,i,r=.8,o=0){super(e);this.svg=i;this.sizeCoef=r;this.rotation=o;this.svgCanvas=null;(async()=>{this.svgCanvas=new OffscreenCanvas(512,512);let s=this.svgCanvas.getContext("2d",{antialias:!0,alpha:!0});await Wt.fromString(s,this.svg,Bn.offscreen()).render()})()}render(e){if(super.render(e),e.save(),this.svgCanvas){let i=v.computePointerLike(this.sizeCoef),r=v.computePointerLike(this.rotation),o=this.w*i,s=this.h*i,a=this.x+this.w/2,l=this.y+this.h/2;e.translate(a,l),e.rotate(r),e.translate(-a,-l),e.drawImage(this.svgCanvas,this.x+(this.w-o)/2,this.y+(this.h-s)/2,o,s)}e.restore()}};var ha='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="800" height="800" fill="#ccc" viewBox="0 0 41.756 41.756"><path d="M27.948 20.878 40.291 8.536a5 5 0 1 0-7.07-7.071L20.878 13.809 8.535 1.465a5 5 0 0 0-7.07 7.071l12.342 12.342L1.465 33.22a5 5 0 1 0 7.07 7.071l12.343-12.342 12.343 12.343c.976.977 2.256 1.464 3.535 1.464s2.56-.487 3.535-1.464a5 5 0 0 0 0-7.071z"/></svg>';var Te=class extends _{constructor(t,e,i){super({...t,w:e,h:e},2,2.5,1,[new pe({w:e,h:e},ha,.95)],i,"#bb5555",!0)}};var ut=class n extends le{constructor(e,i,r=1){super(e,!1,()=>Es[i.rarity],2,2.5,1);this.mobInstance=i;this.amountAccumulator=r;i=new Proxy(i,n.ICON_MOB_INSTANCE_PROXY_HANDLER);let{ICON_SIZE:o}=n;this.addChildren(new j(o,o,0,0),new wt({w:0,h:0},s=>{s.translate(o/2,o/2),s.translate(-i.x,-i.y),qe({ctx:s,entity:i,isSpecimen:!0})}))}static{this.ICON_SIZE=30}static{this.ICON_MOB_ANGLE=-3*Math.PI/4}static{this.ICON_MOB_SIZE=9}static{this.ICON_MOB_LEG_DISTANCE=Array(J.STARFISH_LEG_AMOUNT).fill(150)}static{this.ICON_MOB_INSTANCE_PROXY_HANDLER={get(e,i,r){return i==="size"?n.ICON_MOB_SIZE:i==="angle"?n.ICON_MOB_ANGLE:i==="hurtT"||i==="moveCounter"||i==="sandstormAngle"?0:i==="legD"?n.ICON_MOB_LEG_DISTANCE:Reflect.get(e,i,r)},set:function(){return!1}}}render(e){super.render(e);let i=this.amountAccumulator;i!==1&&(e.translate(this.x+this.w-7,this.y+8),e.rotate(30*Math.PI/180),e.lineJoin="round",e.lineCap="round",e.textBaseline="middle",e.textAlign="center",e.strokeStyle="#000000",e.fillStyle="white",e.font="7px Ubuntu",e.strokeText("x"+i,0,0),e.fillText("x"+i,0,0))}destroy(){super.destroy(),this.mobInstance=null}};var Oi=class n extends Ee{static{this.SPACING=10}static{this.BORDER_PADDING=1}static{this.VERTICAL_GAP=6}constructor(t){super(t,!0,ut.ICON_SIZE+n.SPACING+n.BORDER_PADDING)}findVContainer(t,e={type:!0,rarity:!1}){return this.getChildren().find(i=>i.getChildren().some(({mobInstance:r})=>this.isMobMatch(r,t,e)))}isMobMatch(t,e,{type:i,rarity:r}){return(!i||t.type===e.type)&&(!r||t.rarity===e.rarity)}createMobIcon(t){let e=new ut({},t);return e.setVisible(!1,null,!1),e.setVisible(!0,null,!0,3),e}createVContainer(){return new he({},!0,n.VERTICAL_GAP,!0)}sortVContainerByRarity(t){t.sortChildren((e,i)=>e.mobInstance.rarity-i.mobInstance.rarity)}addMobIcon(t){let e=this.findVContainer(t)||this.createAndAddNewVContainer(),i=this.findExistingIcon(e,t);i?i.amountAccumulator++:e.addChild(this.createMobIcon(t)),this.sortVContainerByRarity(e)}createAndAddNewVContainer(){let t=this.createVContainer();return this.addChild(t),t}findExistingIcon(t,e){return t.getChildren().find(i=>this.isMobMatch(i.mobInstance,e,{type:!0,rarity:!0}))}removeMobIcon(t){let e=this.findVContainer(t,{type:!0,rarity:!0});if(!e)return;let i=this.findExistingIcon(e,t);if(i){if(i.amountAccumulator>1){i.amountAccumulator--;return}this.animateAndRemoveMobIcon(i,e)}}animateAndRemoveMobIcon(t,e){t.once("onOutAnimationEnd",()=>{e.removeChild(t),this.removeEmptyContainer(e)}),t.setVisible(!1,null,!0,3),this.removeEmptyContainer(e)}removeEmptyContainer(t){t.getChildren().length===0&&this.removeChild(t)}isIconableMobInstance({type:t,isPet:e}){return!(Qe(t)||e)}};var Yt=class extends le{constructor(t,e){super({...t,w:e,h:e},!1,"#ddf2e7",.25,4,.085)}render(t){super.render(t),this.embeddedPetal}};function te(n){var e,i;class t extends(i=n,e=ke,i){static{this[e]=ke}constructor(...o){super(...o),this[ke]=!0}}return t}var Li=class extends he{constructor(t){super(t,!1);let e=(o,s,a,l)=>{let h=new(te(Ee))({});for(let u=0;u<a;u++)h.addChild(l?new he({},!1).addChildren(new(te(Yt))({},o),new k(0,5),new(te(A))({},`[${(u+1)%10}]`,8)):new Yt({},o)),u<a-1&&h.addChild(new k(s,0));return h},i=e(30,12,10,!1),r=e(22,8,10,!0);this.addChildren(i,new k(0,12),r)}};var ua,ca,Et=class n extends(ca=v,ua=ne,ca){constructor(e,i,r=0,o=null){super();this.layoutOptions=e;this.gaugeSources=i;this.gaugeWidthPadding=r;this.gaugeText=o;this[ua]=!1;let s=v.computePointerLike(this.gaugeSources);this.currentValues=new Array(s.length).fill(0)}static{this.ANIMATION_SPEED=.1}layout(e){return X.layout(v.computePointerLike(this.layoutOptions),e)}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v;return super.getCacheKey(e)+i+Object.values(v.computePointerLike(this.layoutOptions)).join(i)}invalidateLayoutCache(){this.layoutCache.invalidate()}calculateOpacity(e,i=.05){return e<=i?e/i:1}render(e){super.render(e);let i=v.computePointerLike(this.gaugeSources),r=v.computePointerLike(this.gaugeWidthPadding),o=v.computePointerLike(this.gaugeText),s=this.h;e.translate(this.x,this.y),e.lineCap="round",e.globalAlpha=.9;let a=this.h-s/2;if(e.save(),e.lineWidth=s,e.strokeStyle="black",e.beginPath(),e.lineTo(0,a),e.lineTo(this.w,a),e.stroke(),e.restore(),e.save(),i.forEach(({maxValue:l,thickness:h,color:u,lowBehavior:c},p)=>{let d=this.currentValues[p];if(d>0){let f=d/l;e.lineWidth=s*h,c&&(c==="fade"?e.globalAlpha=this.calculateOpacity(f):e.lineWidth=Math.min(e.lineWidth,f*(s*50))),e.strokeStyle=u,e.beginPath(),e.lineTo(r,a),e.lineTo(r+(this.w-r)*f,a),e.stroke()}}),e.restore(),o){e.save();let l=this.h*.65;e.lineJoin="round",e.lineCap="round",e.textBaseline="middle",e.textAlign="center",e.fillStyle="white",e.strokeStyle="#000000",e.font=`${l}px Ubuntu`,e.lineWidth=Pe(l);let h=(this.w+r)/2,u=this.h/2;e.strokeText(o,h,u),e.fillText(o,h,u),e.restore()}this.currentValues=this.currentValues.map((l,h)=>{let{value:u}=i[h];return l!==u?l+(u-l)*n.ANIMATION_SPEED:l})}};var ki=class n extends Et{constructor(e,i){super({...e,w:135,h:22},()=>[{value:i.redHealth,maxValue:1,thickness:.65,color:"#f22",lowBehavior:"fade"},{value:i.health,maxValue:1,thickness:.75,color:"#6dd24a",lowBehavior:"fade"}],20,()=>i.name);this.player=i;this.player=new Proxy(this.player,n.PLAYER_PROXY_HANDLER)}static{this.PLAYER_PROXY_HANDLER={get(e,i,r){return i==="size"?20:Reflect.get(e,i,r)},set:function(){return!1}}}render(e){super.render(e);let{player:i}=this;e.translate(-i.x,-i.y),e.translate(-16,this.h/2),qe({ctx:e,entity:i,isSpecimen:!0})}destroy(){super.destroy(),this.player=null}};var Ta=Pt(pa()),w=Pt(yo()),bo=Pt(Ca());function Pu(n,t,e){return n.x>=t.x&&n.y>=t.y&&n.x<e.x&&n.y<e.y}var zn=class n{static{this.DEFAULT_OPTIONS={clampPositionToBounds:!1,tileSize:16,layers:[],chunkSize:8,chunkBorder:1,chunkBufferMaxSize:64}}static{this.DEBUG_ORIGIN_COLOUR="cyan"}static{this.DEBUG_ORIGIN_LINE_WIDTH=2}static{this.DEBUG_ORIGIN_SIZE=10}static{this.DEBUG_CHUNK_BORDER_COLOUR="yellow"}static{this.DEBUG_CHUNK_BORDER_LINE_WIDTH=2}static{this.DEBUG_CHUNK_LABEL_COLOUR="white"}static{this.DEBUG_CHUNK_LABEL_FONT="12px monospace"}static{this.DEBUG_TILE_BORDER_COLOUR="orange"}static{this.DEBUG_TILE_BORDER_LINE_WIDTH=1}constructor(t){let e=Object.assign({},n.DEFAULT_OPTIONS,t??{});(!e.debug||e.debug===!0)&&(e.debug={showOrigin:!!e.debug,showChunkBorders:!!e.debug,showChunkLabels:!!e.debug,showTileBorders:!!e.debug}),this.options=e,this.chunkBuffer=new Ta.LRUMap(this.options.chunkBufferMaxSize)}hashvector(t){return w.vec2.str(t)}draw(t,e,i,r){let o=this.options.tileSize*this.options.chunkSize,s=(0,w.vec2)(this.options.chunkBorder),a=r;this.options.minScale&&a<this.options.minScale&&(a=this.options.minScale),this.options.maxScale&&a>this.options.maxScale&&(a=this.options.maxScale);let l=(0,w.vec2)(i);if(this.options.clampPositionToBounds&&this.options.bounds){let f=this.options.tileSize/a,m=w.vec2.map(w.vec2.mul(e,1/(a*2)),Math.ceil),g=(0,w.vec2)(this.options.bounds.topLeft.x*f+m.x,this.options.bounds.topLeft.y*f+m.y),y=(0,w.vec2)(this.options.bounds.bottomRight.x*f-m.x,this.options.bounds.bottomRight.y*f-m.y);l=(0,w.vec2)((0,bo.clamp)(l.x,g.x,y.x),(0,bo.clamp)(l.y,g.y,y.y))}let h=w.vec2.map(w.vec2.mul(e,1/(o*a)),Math.ceil),u=w.vec2.map(w.vec2.mul(l,1/o),Math.floor),c=w.vec2.sub(w.vec2.sub(u,w.vec2.map(w.vec2.mul(h,.5),Math.ceil)),s),p=w.vec2.add(w.vec2.add(u,w.vec2.map(w.vec2.mul(h,.5),Math.ceil)),s);t.save(),t.scale(a,a),t.translate(-l.x+e.x/(a*2),-l.y+e.y/(a*2));let d=o+1/3;for(let f=c.y;f<p.y;f++)for(let m=c.x;m<p.x;m++){let g=(0,w.vec2)(m,f),y=w.vec2.mul(g,o),C=this.hashvector(g);this.chunkBuffer.has(C)||this.chunkBuffer.set(C,this.generateChunk(g,o));let T=this.chunkBuffer.get(C);T&&t.drawImage(T.image,y.x,y.y,d,d)}if(this.options.debug.showTileBorders){let f=w.vec2.mul(w.vec2.sub(u,w.vec2.add(w.vec2.map(w.vec2.mul(h,.5),Math.ceil),(0,w.vec2)(1))),this.options.chunkSize),m=w.vec2.mul(w.vec2.add(u,w.vec2.add(w.vec2.map(w.vec2.mul(h,.5),Math.ceil),(0,w.vec2)(1))),this.options.chunkSize);for(let g=f.y;g<m.y;g++)this.drawLine(t,(0,w.vec2)(l.x-e.x/(a*2),g*this.options.tileSize),(0,w.vec2)(l.x+e.x/(a*2),g*this.options.tileSize),n.DEBUG_TILE_BORDER_COLOUR,n.DEBUG_TILE_BORDER_LINE_WIDTH);for(let g=f.x;g<m.x;g++)this.drawLine(t,(0,w.vec2)(g*this.options.tileSize,l.y-e.y/(a*2)),(0,w.vec2)(g*this.options.tileSize,l.y+e.y/(a*2)),n.DEBUG_TILE_BORDER_COLOUR,n.DEBUG_TILE_BORDER_LINE_WIDTH)}if(this.options.debug.showChunkBorders){for(let f=c.y;f<p.y;f++)this.drawLine(t,(0,w.vec2)(l.x-e.x/(a*2),f*o),(0,w.vec2)(l.x+e.x/(a*2),f*o),n.DEBUG_CHUNK_BORDER_COLOUR,n.DEBUG_CHUNK_BORDER_LINE_WIDTH);for(let f=c.x;f<p.x;f++)this.drawLine(t,(0,w.vec2)(f*o,l.y-e.y/(a*2)),(0,w.vec2)(f*o,l.y+e.y/(a*2)),n.DEBUG_CHUNK_BORDER_COLOUR,n.DEBUG_CHUNK_BORDER_LINE_WIDTH)}if(this.options.debug.showChunkLabels){t.save(),t.fillStyle=n.DEBUG_CHUNK_LABEL_COLOUR,t.font=n.DEBUG_CHUNK_LABEL_FONT,t.textBaseline="middle",t.textAlign="center";for(let f=c.y;f<p.y;f++)for(let m=c.x;m<p.x;m++)t.fillText(`${m}, ${f}`,m*o+o/2,f*o+o/2);t.restore()}this.options.debug.showOrigin&&Pu((0,w.vec2)(0,0),c,p)&&this.drawCross(t,(0,w.vec2)(0,0),n.DEBUG_ORIGIN_COLOUR,n.DEBUG_ORIGIN_LINE_WIDTH,n.DEBUG_ORIGIN_SIZE),t.restore()}generateChunk(t,e){let i=document.createElement("canvas"),r=i.getContext("2d");i.width=e,i.height=e;let o={chunkPosition:t,image:i},s=w.vec2.mul(t,this.options.chunkSize),a=w.vec2.add(s,(0,w.vec2)(this.options.chunkSize-1)),l=this.options.bounds?.topLeft??(0,w.vec2)(0);for(let h of this.options.layers){r.save(),r.globalAlpha=h.opacity??1;for(let u=s.y;u<=a.y;u++)for(let c=s.x;c<=a.x;c++){let p=(0,w.vec2)(c,u),d=w.vec2.sub(p,l);if(d.x<0||d.y<0)continue;let f=h.data?.[d.y]?.[d.x];if(f===void 0||f===-1)continue;let m=h.tiles?.[f]?.image;if(!m)continue;let g=w.vec2.sub(w.vec2.mul(p,this.options.tileSize),w.vec2.mul(t,e)),y=(0,w.vec2)(g.x+this.options.tileSize/2-m.width/2,g.y+this.options.tileSize/2-m.height/2);r.drawImage(m,y.x,y.y)}r.restore()}return o}drawLine(t,e,i,r,o){t.save(),t.lineWidth=o,t.strokeStyle=r,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.stroke(),t.restore()}drawCross(t,e,i,r,o){t.save(),t.lineWidth=r;let s=Math.ceil(o/2);t.strokeStyle=i,t.beginPath(),t.moveTo(e.x-s,e.y-s),t.lineTo(e.x+s,e.y+s),t.moveTo(e.x-s,e.y+s),t.lineTo(e.x+s,e.y-s),t.stroke(),t.restore()}};var xa='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#1EA761" d="M0 0h256v256H0z"/><path fill="#1C9E5B" d="M231.8 122.8c.6 5-2.7 7.6-7.4 5.6s-5.2-6.1-1.2-9.2c4.1-3 8-1.4 8.6 3.6M171 104.9c-1.6 5.3-6 6.3-9.7 2.3L148.8 94c-3.8-4-2.5-8.3 2.9-9.6l17.7-4.2c5.4-1.3 8.4 2 6.9 7.3zM53.7 52.9c2 5.1-.8 8.6-6.2 7.8L22.6 57c-5.4-.8-7.1-5-3.6-9.3l15.7-19.6c3.4-4.3 7.9-3.6 9.9 1.5zM219.1 34.7c-2.1 4.4-6 4.8-8.8.8s-1.1-7.6 3.7-8c4.9-.5 7.2 2.7 5.1 7.2M187.1 195.2c-3 4.6-7.5 4.3-10-.6l-3.5-7c-2.5-4.9 0-8.7 5.5-8.3l7.8.5c5.5.3 7.5 4.3 4.5 8.9zM52.2 238.2c-1.6 5.3-6 6.3-9.7 2.3l-11-11.6c-3.8-4-2.5-8.3 2.9-9.6l15.6-3.7c5.4-1.3 8.4 2 6.9 7.3zM65.3 167c2.9 4.1 1.1 7.8-3.8 8.3s-7.4-2.9-5.2-7.5c2-4.6 6.1-4.9 9-.8M123.5 144c0 5.5-3.9 7.8-8.7 5l-5.1-3c-4.8-2.8-4.8-7.2 0-10l5.1-3c4.8-2.8 8.7-.5 8.7 5z"/><path fill="#1FAD64" d="M110.5 189.9c-.8 5.4-5 7.1-9.3 3.6l-3-2.4c-4.3-3.4-3.6-7.9 1.5-9.9l3.5-1.4c5.1-2 8.6.8 7.8 6.3zM34.5 194.8c-2.2 3.8-5.8 3.8-8 0s-.4-6.9 4-6.9 6.2 3.1 4 6.9M37.7 112.7c2.2 4.4 0 7.8-5 7.5s-6.8-3.9-4-8.1c2.7-4.1 6.7-3.9 9 .6M96.2 102.6c-5.3-1.3-6.6-5.6-2.8-9.6l4.3-4.5c3.8-4 8.2-2.9 9.7 2.4l1.7 6c1.5 5.3-1.6 8.5-6.9 7.2zM230 79.7c-.3 5.5-4.3 7.5-8.9 4.6l-.7-.5c-4.6-3-4.4-7.5.5-10l.8-.4c4.9-2.5 8.7-.1 8.4 5.4zM120.9 49.2c-5.3 1.4-8.5-1.8-7.1-7.1l2.3-8.5c1.4-5.3 5.8-6.5 9.7-2.6l6.2 6.2c3.9 3.9 2.7 8.2-2.6 9.7zM222.4 217.5c.7 5.5-2.9 8.2-8 6l-4.5-1.9c-5.1-2.1-5.6-6.6-1.3-9.9l3.9-3c4.4-3.3 8.5-1.6 9.2 3.9zM179.4 154.2c-5-.5-6.7-4.3-3.7-8.3s7-3.6 9.1 1-.4 7.9-5.4 7.3"/><path fill="#1C9E5B" d="M134.4 225.6c.3 5.2-3.2 7.5-7.8 5.2s-4.9-6.5-.6-9.4c4.3-2.8 8.1-.9 8.4 4.2"/></svg>';var Sa='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#1EA761" d="M0 0h256v256H0z"/><path fill="#1C9E5B" d="M18.2 117c-3.2 4-7.3 3.3-9.1-1.4s.8-8 5.8-7.2 6.5 4.7 3.3 8.6M216.5 219.8c.7 5.5-2.9 8.2-8 6l-16.7-7c-5.1-2.1-5.6-6.6-1.3-9.9l14.5-11c4.4-3.3 8.5-1.6 9.2 3.9zM232.2 31.4c5 2.3 5.5 6.7 1 10L212.8 56c-4.5 3.2-8.6 1.4-9.1-4.1l-2.5-25c-.5-5.5 3.1-8.1 8.1-5.8zM181.6 133.5c-4.8 1-7.4-1.9-5.9-6.6 1.5-4.6 5.4-5.5 8.7-1.8 3.2 3.6 1.9 7.4-2.8 8.4M40.2 28.8c-1.1 5.4-5.3 6.9-9.5 3.2l-5.9-5.1c-4.1-3.6-3.3-8 1.9-9.8l7.4-2.5c5.2-1.8 8.6 1.2 7.5 6.6zM108 134c-3.5 4.3-7.9 3.6-9.9-1.6l-5.8-14.9c-2-5.1.8-8.6 6.3-7.8l15.8 2.5c5.4.9 7.1 5.1 3.6 9.3zM122.2 68.5c.5 5-2.8 7.4-7.4 5.3s-5-6.2-.9-9.1 7.8-1.2 8.3 3.8M47.4 192c-2.5 4.9-7 5.2-10 .6l-3.3-5c-3-4.6-1-8.6 4.5-8.9l5.9-.3c5.5-.3 8 3.4 5.5 8.4z"/><path fill="#1FAD64" d="M235.5 179.2c-3.2 4.4-7.7 4-9.9-1.1l-1.5-3.5c-2.2-5 .4-8.7 5.9-8.1l3.8.4c5.5.6 7.3 4.7 4.1 9.1zM51.5 150c-4.3.9-6.7-1.8-5.4-5.9 1.4-4.2 4.9-4.9 7.8-1.7s1.9 6.7-2.4 7.6M45.3 73.9c-2.7 4.1-6.8 3.9-9-.5s0-7.8 5-7.5 6.8 3.8 4 8M118.7 184.7c-4.1-3.6-3.3-8 1.9-9.8l5.9-2c5.2-1.8 8.6 1.2 7.5 6.6l-1.2 6.1c-1.1 5.4-5.3 6.9-9.5 3.2zM99.6 37.9c-3.2 4.4-7.7 4-9.9-1.1l-.4-.8c-2.2-5 .4-8.7 5.9-8.1l.9.1c5.5.6 7.3 4.7 4.1 9.1zM149.1 45c-4.8-2.8-4.8-7.3 0-10l7.6-4.4c4.8-2.8 8.7-.5 8.7 5v8.8c0 5.5-3.9 7.8-8.7 5zM158.6 236.1c-2.2 5.1-6.6 5.6-9.9 1.2l-2.9-3.9c-3.3-4.4-1.5-8.5 3.9-9.2l4.9-.6c5.5-.7 8.2 2.9 6 8zM214.3 102.5c-2.4-4.4-.2-7.9 4.8-7.8s7 3.8 4.3 8.1c-2.6 4.3-6.7 4.1-9.1-.3"/><path fill="#1C9E5B" d="M81.6 243.2c-3.2 4-7.4 3.4-9.3-1.5s.8-8.1 5.9-7.3 6.6 4.8 3.4 8.8"/></svg>';var wa='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#1EA761" d="M0 0h256v256H0z"/><path fill="#1C9E5B" d="M194 139.2c-4.5-2.4-4.7-6.5-.4-9.2s8-.8 8.2 4.3-3.3 7.3-7.8 4.9M67.8 236.1c-2.5 4.9-7 5.2-10 .6l-10-15.2c-3-4.6-1-8.6 4.5-8.9l18.1-1.1c5.5-.3 8 3.4 5.5 8.4zM132.3 117.7c5.5.3 7.5 4.3 4.5 8.9l-13.8 21c-3 4.6-7.5 4.3-10-.6l-11.2-22.4c-2.5-4.9 0-8.7 5.5-8.3zM111.4 63.7c-.2-4.9 3.2-7 7.5-4.7s4.5 6.2.3 8.8c-4.1 2.6-7.6.8-7.8-4.1M57.5 49.4c-4.7 2.9-8.6.8-8.8-4.7l-.3-7.8c-.2-5.5 3.6-7.9 8.5-5.3l6.9 3.7c4.9 2.6 5 7.1.4 10zM201.3 74.4c-4.9 2.6-8.7.2-8.5-5.3l.6-16c.2-5.5 4.2-7.6 8.9-4.7l13.5 8.5c4.7 2.9 4.5 7.4-.4 10zM33.7 135.8c-3.6 3.5-7.6 2.3-8.8-2.5-1.2-4.9 1.7-7.7 6.6-6.3 4.8 1.3 5.8 5.3 2.2 8.8M219.2 218c-4.8 2.8-8.7.5-8.7-5v-6c0-5.5 3.9-7.8 8.7-5l5.1 3c4.8 2.8 4.8 7.2 0 10z"/><path fill="#1FAD64" d="M67.9 89.4c-5.4-1-6.9-5.2-3.4-9.4l2.4-2.9c3.6-4.2 8-3.4 9.8 1.8l1.3 3.6c1.9 5.2-1.1 8.6-6.5 7.6zM12.9 233c-.5-4.4 2.4-6.5 6.4-4.8s4.4 5.3.9 7.9-6.8 1.3-7.3-3.1M235.5 26.2c-4.9-.5-6.6-4.2-3.7-8.2s6.9-3.6 9 .9-.4 7.8-5.3 7.3M156.2 159.7c3.6-4.2 8-3.4 9.8 1.8l2.1 5.9c1.9 5.2-1.1 8.6-6.5 7.6l-6.1-1.1c-5.4-1-6.9-5.2-3.4-9.4zM231.3 101.8c-5.4-1.2-6.7-5.5-3-9.5l.6-.6c3.7-4.1 8.1-3.1 9.8 2.2l.3.8c1.6 5.2-1.4 8.6-6.8 7.4zM148.2 27.8c.6-5.5 4.7-7.3 9.1-4.1l7.1 5.2c4.4 3.2 4 7.7-1.1 9.9l-8 3.6c-5 2.2-8.7-.4-8.1-5.9zM160.9 236.6c-5.2 1.7-8.6-1.3-7.4-6.7l1-4.8c1.2-5.4 5.4-6.8 9.5-3.1l3.6 3.3c4.1 3.7 3.1 8.1-2.1 9.8zM74 173.7c5 0 7.1 3.6 4.6 7.9-2.5 4.4-6.6 4.4-9.1 0-2.6-4.3-.5-7.9 4.5-7.9"/><path fill="#1C9E5B" d="M129.8 207.3c-5-1.1-6.3-5.2-2.8-9s7.6-2.9 9.2 2c1.5 5-1.3 8.1-6.4 7"/></svg>';var Ea='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#1EA761" d="M0 0h256v256H0z"/><path fill="#1C9E5B" d="M209.5 26.7c1.7 4.8-.9 8-5.9 7.1s-6.4-4.8-3.2-8.7 7.4-3.2 9.1 1.6M62.1 56c-1 5.4-5.3 6.9-9.5 3.3L38.9 47.4c-4.2-3.6-3.3-8 1.9-9.8l17.2-6c5.2-1.8 8.6 1.2 7.6 6.6zM159.6 95.1c1.3 5.3-1.9 8.5-7.2 6.9l-24.1-7c-5.3-1.5-6.4-5.9-2.4-9.7L144 67.9c4-3.8 8.3-2.5 9.6 2.8zM227.5 153.6c-1 4.8-4.8 6-8.4 2.7s-2.8-7.2 1.9-8.6c4.6-1.5 7.5 1.1 6.5 5.9M29.5 125.1c-2 5.1-6.5 5.8-9.9 1.5l-4.9-6.1c-3.4-4.3-1.8-8.5 3.7-9.3l7.8-1.1c5.4-.8 8.2 2.7 6.2 7.8zM109.4 162.8c.3 5.5-3.4 8-8.3 5.5l-14.3-7.1c-4.9-2.4-5.2-6.9-.6-10l13.3-8.9c4.6-3 8.6-1 9 4.5zM197.1 207.7c1.2 4.9-1.7 7.7-6.5 6.3s-5.8-5.4-2.2-8.8c3.5-3.5 7.5-2.3 8.7 2.5M35.7 207.5c.4 5.5-3.4 8-8.3 5.6l-5.3-2.6c-4.9-2.4-5.2-6.9-.7-10l4.9-3.3c4.6-3.1 8.6-1.1 9 4.4z"/><path fill="#1FAD64" d="M222.1 71.7c1 5.4-2.5 8.3-7.6 6.4l-3.6-1.3c-5.2-1.9-6-6.3-1.8-9.8l2.9-2.4c4.2-3.5 8.4-2 9.4 3.4zM115.7 43.4c-1.9 4-5.4 4.3-8 .7s-1-6.9 3.4-7.2 6.4 2.6 4.6 6.5M74.3 98.9c3.9 3.1 3.2 7.1-1.4 8.9s-7.8-.7-7-5.6c.7-4.9 4.5-6.4 8.4-3.3M165.3 164.7c-5.5.3-7.9-3.5-5.4-8.4l2.8-5.5c2.5-4.9 7-5.1 10-.5l3.4 5.2c3 4.6.9 8.6-4.6 8.9zM82.8 194.5c1.8 5.2-1.2 8.6-6.6 7.5l-.8-.2c-5.4-1.1-6.8-5.4-3.2-9.5l.6-.6c3.6-4.1 8-3.2 9.8 2zM235.8 201.4c-4.9 2.5-8.7 0-8.3-5.5l.5-8.8c.3-5.5 4.4-7.5 9-4.5l7.3 4.8c4.6 3 4.3 7.5-.6 10zM139.4 206.5c.7 5.5-2.9 8.2-8 6l-4.5-1.9c-5.1-2.1-5.6-6.6-1.3-9.9l3.9-3c4.4-3.3 8.5-1.6 9.2 3.9zM205.7 244.3c-5-.3-6.9-4-4.1-8.2s6.9-4 9.1.5 0 8-5 7.7"/><path fill="#1C9E5B" d="M86 232.9c2 4.8-.5 8.1-5.6 7.5s-6.8-4.5-3.7-8.6 7.3-3.7 9.3 1.1"/></svg>';var Aa='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#E0D1AF" d="M0 0h256v256H0z"/><path fill="#D7C9A8" d="m127.4 217.2-19.6 9 8.8 19.8 19.8-8.8zM215.8 222l2.4-21.8-21.8-2.2-2.2 21.8zM61.2 51.4 59 73l21.6 2.2 2.2-21.6zM118.4 34.8 115 13.4l-21.4 3.4L97 38.2zM184.6 26.2 167 13.4l-12.8 17.8L172 43.8z"/><path fill="#ECDCB8" d="M256 256v-91c-18.7 24.2-27.9 61.2-39.2 91zM29.8 29.2C33 18.9 36.7 9.2 41 0H0v92.6c14.3-19.1 23.5-39.3 29.8-63.4M216.8 0c-21.7 48.5-71.6 86.2-118.3 98.3S23.7 131 0 165v91h41c23.9-52.5 68.7-90 117.3-99.1s75.4-34.8 97.7-64.3V0z"/><path fill="#F3E2BE" d="m53.6 153.4-17.4-12.6-12.8 17.4L41 171zM52.8 181.4l-18.4 6.4 6.2 18.4L59 200zM220.8 83.8l15-15.8L220 53l-15 15.8zM188.8 99.2l-7.8 20.4 20.6 8 7.6-20.6zM140.2 120.8l13.8 16.8 17-13.8-14-16.8z"/></svg>';var Ma='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#E0D1AF" d="M0 0h256v256H0z"/><path fill="#D7C9A8" d="m163.2 201.9-14.6 15.9 15.8 14.8 14.8-15.8zM225.2 156.4l-4.8-21.4-21.3 5 5 21.3zM33.4 86.1l7.5 20.4 20.4-7.4-7.5-20.4zM87.8 27.1l-21.6 2.4L68.6 51l21.5-2.4zM146.3 23.4l-20.7-6.6-6.6 21 20.9 6.3z"/><path fill="#ECDCB8" d="M256 256v-91c-18.7 24.2-27.9 61.2-39.2 91zM29.8 29.2C33 18.9 36.7 9.2 41 0H0v92.6c14.3-19.1 23.5-39.3 29.8-63.4M216.8 0C195.1 48.5 155 48.5 98.5 98.3S23.7 131 0 165v91h41c23.9-52.5 91.6-30 117.3-99.1s75.4-34.8 97.7-64.3V0z"/><path fill="#F3E2BE" d="M88.4 152.7 69 143.5l-9.5 19.4 19.6 9.4zM29.3 189l-17.6 8.4 8.2 17.6 17.6-8.2zM239 61.5l-7.4-20.4-20.5 7.4 7.4 20.5zM142 84.5l-5.8 21 21.2 6 5.6-21.2zM108.7 160.7l18.4 11.6 11.8-18.4-18.6-11.6z"/></svg>';var Ra='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#E0D1AF" d="M0 0h256v256H0z"/><path fill="#D7C9A8" d="m84.2 214.9-7.8 20.2 20.1 8 8.1-20.1zM226.2 171.7l-10.8-19.1-19 11 10.9 19zM19.8 81.8 36.3 96l14.1-16.4L34 65.4zM111.4 55 93.6 67.4 106 85.2l17.8-12.4zM104.6 14.9l-21.8-.2-.1 21.9 21.8-.1z"/><path fill="#ECDCB8" d="M256 256v-91c-18.7 24.2-27.9 61.2-39.2 91zM29.8 29.2C33 18.9 36.7 9.2 41 0H0v92.6c14.3-19.1 23.5-39.3 29.8-63.4M216.8 0C195.1 48.5 158 105.2 98.5 98.3S23.7 131 0 165v91h41c23.9-52.5 51.4-81 117.3-99.1s75.4-34.8 97.7-64.3V0z"/><path fill="#F3E2BE" d="m74.7 150-20.9-4.7-4.9 21.1 21.3 4.7zM27.4 213.1l-14.5 13 12.8 14.6 14.6-12.8zM245.9 75.8 233.4 58l-17.8 12.4 12.5 17.9zM175.1 107.1l9.2 19.8 20.1-9.3-9.6-19.8zM117.1 133.1l21.4 3.9 4-21.5-21.5-3.8z"/><path fill="#D7C9A8" d="m177.6 25.3-15.9-15.2-15 16 15.9 15zM159.6 204.5l-10.8 18.7 18.6 11.1 11.1-18.6z"/></svg>';var Ia='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#E0D1AF" d="M0 0h256v256H0z"/><path fill="#D7C9A8" d="m91.1 224.6 9.3 19.5L120 235l-9-19.7zM230.8 170.5l-17.9-12.7-12.5 18 18 12.5zM55.5 77.9l18-12.2-12.2-17.9-18 12.1zM53.4 110.8 41 128.6 58.8 141l12.4-17.8zM129.8 3.7 108.7 9l5.4 21.2 21.1-5.5z"/><path fill="#ECDCB8" d="M256 256v-91c-18.7 24.2-27.9 61.2-39.2 91zM29.8 29.2C33 18.9 36.7 9.2 41 0H0v92.6c14.3-19.1 23.5-39.3 29.8-63.4M216.8 0C195.1 48.5 104.7.2 98.5 98.3S23.7 131 0 165v91h41c23.9-52.5 53.1-95.5 117.3-99.1s75.4-34.8 97.7-64.3V0z"/><path fill="#F3E2BE" d="m42.7 194.7-21.4 1.6 1.4 21.5 21.7-1.5zM220.6 98.1l-16.5-14.2-14.2 16.5 16.5 14.2zM122 129.6l14.9 15.9 16.2-15.1-15.2-15.8zM135.1 95.1l21.5-3.2-3.2-21.7-21.6 3.4z"/><path fill="#D7C9A8" d="m143.9 185.6 12.3 17.7 17.9-12.2-12.2-17.9z"/><path fill="#F3E2BE" d="M233.8 25.7H212l.1 21.8 21.8-.1z"/><path fill="#D7C9A8" d="m165.5 242.9 21.3 3.2 3.5-21.4-21.4-3.5z"/></svg>';var Pa='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#E0D1AF" d="M0 0h256v256H0z"/><path fill="#D7C9A8" d="m142 240.2 15.7-14.7-14.6-16-16 14.6zM213.7 129.7l-8.5 20.2 20.2 8.3 8.3-20.3zM80.5 47.5l1.6-21.6-21.6-1.7-1.7 21.7zM19.7 89.4l4.8 21.2 21.1-4.9-4.8-21.1zM121.9 27l-9.3 19.7 19.8 9.3 9.1-19.9z"/><path fill="#ECDCB8" d="M256 256v-91c-18.7 24.2-27.9 61.2-39.2 91zM29.8 29.2C33 18.9 36.7 9.2 41 0H0v92.6c14.3-19.1 23.5-39.3 29.8-63.4M216.8 0c-21.7 48.5-81.6 94.9-118.3 98.3S23.7 131 0 165v91h41c23.9-52.5 90.1-54.2 117.3-99.1s75.4-34.8 97.7-64.3V0z"/><path fill="#F3E2BE" d="m43.3 186.5-19.4 9.2 9 19.6 19.7-9.2zM183.1 98.3l-21-5.7-5.7 21 21.1 5.7zM51.4 156.6l20.2 8.1 8.3-20.5-20.4-7.9zM121.3 158.3l20.1-8.4-8.4-20.3-20.1 8.6z"/><path fill="#D7C9A8" d="m192.2 206.1 21.6-.3-.1-21.6h-21.6z"/><path fill="#F3E2BE" d="M229.9 53.7 210 62.6l9 19.9 19.8-9z"/></svg>';var Oa='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#66869E" d="M0 0h256v256H0z"/><path fill="#88B0C9" d="M0 183.33c19.56-11.67 47.47-28.05 58.98-53.97s37.57-54.12 69.66-66.38S194.3 26.67 207.63 0H75.71C49.95 17.38 18.43 15.92 0 42.96zM207.63 256c13.33-26.67 10.42-31.54 16.66-41.97 6.24-10.44 12.15-19.03 31.71-30.7V42.96c-18.43 27.04-19.98 49.47-53.22 69.89s-61.96 40.82-77.15 71.97-24.17 53.8-49.92 71.18"/><path fill="#98C8E3" d="M86.05 151.39c-1.27-.95-3.44-14.15-2.81-15.53.64-1.38 2.21-13.11 3.4-13.94s19.71.22 21.07 1.02 5.7 10.13 6.15 11.6 1.27 11.15.63 12.58-15.47 7.56-16.88 7.3c-1.41-.27-10.29-2.08-11.56-3.03"/><path fill="#779CB0" d="M20.23 131.8c-1.02-.8-4.58-9.06-4.38-10.31.19-1.25 5.41-7.33 6.12-8.27.72-.94 12.49-7.48 13.65-6.81 1.16.66 5.8 9.35 6.02 10.48.21 1.13.26 13.29-.35 14.35s-9.9 2.78-11.05 3.38c-1.14.59-8.99-2.03-10.01-2.82"/><path fill="#5A758C" d="M246.23 133.82c.77 1.26-1.48 13.62-2.02 14.9s-5.08 12.47-6.37 13.44-16.3-4.39-17.84-4.76-8.06-7.97-7.94-9.64 2.55-17.34 3.45-18.55 11.78-3.75 13.31-3.33 16.64 6.68 17.41 7.94M43.81 209.99c1.15-.8 10.85-1.88 12.09-1.28s5.89 7.93 6.64 8.97S66.34 233 65.28 234c-1.06.99-11.53 3.06-12.77 2.92s-13.87-3.94-14.78-4.9c-.91-.97.26-11.15-.01-12.53-.26-1.38 4.94-8.69 6.09-9.5M198.33 61.46c1.84-.13 15.64 9.3 16.34 10.75.69 1.45-10.53 11.81-12.21 12.16s-15.27-4.91-15.35-6.73c-.07-1.83 9.38-16.05 11.22-16.18m-130.13.59c-3.62.35-30.17-20.59-30.36-25.02-.2-4.42 31.89-16.78 34.19-13.41 2.29 3.39-.21 38.08-3.83 38.43"/></svg>';var La='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#66869E" d="M0 0h256v256H0z"/><path fill="#88B0C9" d="M0 183.33c19.56-11.67 27.84-43.41 57.19-65.15 27.73-20.55 57.54-36.37 84.03-48.11C171.73 56.56 194.3 26.67 207.63 0H75.71C49.95 17.38 18.43 15.92 0 42.96zM207.63 256c13.33-26.67 13.94-33.87 19.6-46.1s9.21-14.9 28.77-26.57V42.96c-18.43 27.04-23.58 56.7-50.89 78.44s-62.2 56.9-73.58 78.48c-14.78 28.02-30.06 38.74-55.82 56.12"/><path fill="#779CB0" d="M88.77 135.8c-2.11-2.05 11.28-28.4 14.23-29.51s20.77 20.09 20.14 23.2c-.64 3.12-32.25 8.36-34.37 6.31"/><path fill="#98C8E3" d="M148.4 36.67c-1.15-.83-8.46-11.74-8.24-13.23.23-1.49 9-11.06 10.3-11.85 1.3-.78 13.95-1.71 15.15-.86 1.19.85 5.43 11.55 5.26 12.97s-6.12 14.09-7.33 14.82c-1.21.74-13.99-1.02-15.14-1.85m34.27 199.83c-1.61-.09-11.84-9.77-12.17-11.2s-1.89-16.76-1.12-18.23 12.41-12.14 14.01-12.13 12.75 9.91 14.17 10.73c1.42.81 6.71 11.73 6.63 13.44-.07 1.71-2.82 12-3.87 13.28-1.03 1.27-16.04 4.2-17.65 4.11"/><path fill="#779CB0" d="M67.82 64.15c-2.19 2.4-30.21 2.05-32.71-.21-2.5-2.27-6.58-29.7-3.94-31.7s35.53-2.34 37.44.21 1.4 29.3-.79 31.7"/><path fill="#5A758C" d="M173.45 79c.68-1.08 6.57-9.4 7.67-9.78 1.09-.38 13.56-.26 14.61.51s3.08 10.06 3.39 11.24-.81 11.46-1.58 12.47-10.86 4.2-12.01 4.02-11.13-4.98-11.88-5.94-.88-11.45-.2-12.52M50.46 226.56c-1.22-1.6-8.04-17.35-7.64-19.32s14.31-15.03 16.18-15.8 16.99 4.62 18.51 5.92 4.95 19.66 4.48 21.52-10.35 11.44-12.22 11.84c-1.87.39-18.09-2.56-19.31-4.16"/></svg>';var ka='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#66869E" d="M0 0h256v256H0z"/><path fill="#88B0C9" d="M0 183.33c19.56-11.67 33.3-26.4 49.14-59.31C67.55 85.77 101.4 62.07 128.37 53c44.44-14.95 65.93-26.33 79.26-53H75.71C49.95 17.38 18.43 15.92 0 42.96zM207.63 256c13.33-26.67 8.59-29.22 14.82-43.39 6.24-14.17 13.98-17.61 33.54-29.28V42.96c-18.43 27.04-30.5 54.18-48.19 89.07-12.76 25.17-50.11 62.18-68.01 75.37-25.51 18.79-38.34 31.22-64.09 48.6"/><path fill="#98C8E3" d="M173.94 232.98c-.27-1.93 8.68-17.07 10.15-17.89 1.48-.83 13.13 10.23 13.61 11.97s-4.09 16.37-6 16.58c-1.91.19-17.49-8.74-17.76-10.66M52.16 59.56c.77 1.26-1.48 13.62-2.02 14.9s-5.08 12.47-6.37 13.44c-1.29.96-16.3-4.39-17.84-4.76s-8.06-7.97-7.94-9.64 2.55-17.34 3.45-18.55 11.78-3.75 13.31-3.33 16.64 6.68 17.41 7.94"/><path fill="#779CB0" d="M176.28 78.52c.75 1.51-2.77 15.88-3.9 16.92-1.14 1.04-14.31 10.42-16.05 10.49-1.74.06-17.53-5.02-18.35-6.49s2.43-16.78 2.43-18.5 7.22-12.21 8.82-13.03 12.42-3.65 14.12-3.36c1.71.28 12.18 12.46 12.93 13.97"/><path fill="#5A758C" d="M103.8 12.98c1.15-.8 10.85-1.88 12.09-1.28s5.89 7.93 6.64 8.97 3.8 15.32 2.74 16.32c-1.06.99-11.53 3.06-12.77 2.92s-13.87-3.94-14.78-4.9c-.91-.97.26-11.15-.01-12.53-.26-1.38 4.94-8.69 6.09-9.5M102.07 205c-1.81 3.13-30.96-7.16-32.48-10.2-1.52-3.03 19.07-25.78 22.63-24.57s11.66 31.64 9.85 34.77"/></svg>';var Da='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 256 256"><path fill="#66869E" d="M0 0h256v256H0z"/><path fill="#88B0C9" d="M0 183.33c19.56-11.67 50.73-31.1 69.03-62.71 18.41-31.8 66.32-59.25 89.3-68.49C183.79 41.89 194.3 26.67 207.63 0H75.71C49.95 17.38 18.43 15.92 0 42.96zM207.63 256c13.33-26.67 11.46-29.53 18.1-42.81 6.08-12.16 10.71-18.19 30.27-29.86V42.96c-18.43 27.04-15.19 41.35-25.17 72.95-13.9 43.99-53.71 59.36-75.07 70.8-27.93 14.96-54.29 51.91-80.05 69.29"/><path fill="#5A758C" d="M49.24 119.09c-2 2.43-21.49 3-23.75 1.05s-9.16-21.46-6.99-23.41 28.65-12.65 30.76-10.41c2.11 2.25 1.98 30.34-.02 32.77"/><path fill="#779CB0" d="M111.11 35.15c-.4-1.41-.57-13.64.04-15.18.6-1.55 10.65-13.12 12.3-12.83 1.66.29 10.85 7.52 11.75 8.66s11.81 12.54 11.47 14.1c-.34 1.55-11.53 13.93-12.95 14.46s-14.72-3.73-16.13-3.94c-1.4-.22-6.08-3.86-6.48-5.27"/><path fill="#98C8E3" d="M121.78 105.19c-.2-1.42 10.5-13.39 11.91-13.86s13.84-6.9 15.06-6.1 11.31 13.94 12.18 15.22-6.7 14.74-7.71 15.89-6.19 9.08-7.65 9.22-15.81-10.68-17.16-11.44c-1.34-.76-6.43-7.51-6.63-8.93"/><path fill="#779CB0" d="M81.88 208.86c.72 1.18-1.39 12.78-1.89 13.98s-4.76 11.7-5.98 12.61c-1.21.9-15.29-4.12-16.74-4.46s-7.56-7.48-7.45-9.04c.12-1.57 2.39-16.27 3.24-17.4.84-1.14 11.05-3.52 12.49-3.12 1.43.38 15.6 6.25 16.33 7.43"/></svg>';var vo=Pt(yo()),Yu=Math.PI*2,Co={0:[xa,Sa,wa,Ea],1:[Aa,Ma,Ra,Ia,Pa],2:[Oa,La,ka,Da]},nt=class{static async prepareTileset(t){return Promise.all(Co[t].map(e=>this.prepareTileFromSvg(e)))}static async prepareTileFromSvg(t){let i=new OffscreenCanvas(1024,1024),r=i.getContext("2d");return await Wt.fromString(r,t,Bn.offscreen()).render(),i}initializeMap(t,e){let i=t.length;this.tileMap=new zn({clampPositionToBounds:!1,tileSize:e,layers:[{name:"default",tiles:t.map((r,o)=>({name:`tile_${o}`,image:r})),data:Array.from({length:10},()=>Array.from({length:10},()=>Math.floor(Math.random()*i)))}],chunkSize:4,chunkBorder:1,chunkBufferMaxSize:64,debug:!1})}getScaledDimensions(t){return{width:t.width/P,height:t.height/P}}renderTile(t,e,i,r,o,s=1/3){t.drawImage(e,i,r,o+s,o+s)}renderBoundaryCircle(t,e,i,r,o,s){t.save(),t.lineWidth=(o+s)*5*fe,t.strokeStyle="black",t.globalAlpha=.14,t.beginPath(),t.arc(e,i,(r+.5)*fe+t.lineWidth/2,0,Yu),t.stroke(),t.closePath(),t.restore()}renderGameTileset({canvas:t,tileset:e,tileSize:i,radius:r,playerX:o,playerY:s}){this.tileMap||this.initializeMap(e,i);let a=t.getContext("2d"),{width:l,height:h}=this.getScaledDimensions(t);this.tileMap.draw(a,(0,vo.vec2)(l,h),(0,vo.vec2)(o,s),fe),this.renderBoundaryCircle(a,(r-o)*fe+l/2,(r-s)*fe+h/2,r,l,h)}renderTitleTileset({canvas:t,tileset:e,tileSize:i,translateX:r,translateY:o}){let s=t.getContext("2d"),{width:a,height:l}=this.getScaledDimensions(t),h=a/2,u=l/2,c=Math.ceil(t.width/800),p=Math.ceil(t.height/800);for(let d=-c;d<=c;d++)for(let f=-p;f<=p;f++){let m=h+d*i-r%i,g=u+f*i-o%i;this.renderTile(s,e[0],m,g,i)}}},Xt=new Map;var Wn=0,Fn=0,Hn=0,Yn=0,Gu=Math.PI*2;function To(n){return n/255*Gu}var bt=class n extends yt{constructor(e){super(e);this.DEAD_BACKGROUND_TARGET_OPACITY=.3;this.DEAD_BACKGROUND_FADE_DURATION=.3;this.tilesetRenderer=new nt;this.players=new Map;this.mobs=new Map;this.waveSelfId=-1;this.biome=0;this.CLIENTBOUND_HANDLERS={0:e=>{this.waveSelfId=e.readUInt32()},2:e=>{{let r=e.readUInt16(),o=e.readFloat64(),s=e.readFloat64(),a=e.readBoolean(),l=e.readUInt16();this.waveProgress=r,this.waveProgressTimer=o,this.waveProgressRedGageTimer=s,this.wasWaveEnded=a,this.nMapRadius=l,this.oMapRadius=this.mapRadius,this.updateT=0}{let r=e.readUInt16();for(let o=0;o<r;o++){let s=e.readUInt32(),a=e.readFloat64(),l=e.readFloat64(),h=To(e.readFloat64()),u=e.readFloat64(),c=e.readFloat64(),p=e.readUInt8(),d=e.readString(),f=e.readUInt8(),m=!!(f&1),g=!!(f&2),y=this.players.get(s);if(y)y.nx=a,y.ny=l,y.nAngle=h,y.nSize=c,y.mood=p,y.isDead=m,y.isDev=g,u<y.nHealth?y.redHealthTimer=1:u>y.nHealth&&(y.redHealthTimer=0),u<y.nHealth&&(y.hurtT=1),y.nHealth=u,y.ox=y.x,y.oy=y.y,y.oAngle=y.angle,y.oHealth=y.health,y.oSize=y.size,y.updateT=0;else{let C=new Ie(s,a,l,h,c,u,p,d);this.players.set(s,C),this.addComponent(new ki({x:55,y:60},C))}}}{let r=e.readUInt16();for(let o=0;o<r;o++){let s=e.readUInt32(),a=e.readFloat64(),l=e.readFloat64(),h=To(e.readFloat64()),u=e.readFloat64(),c=e.readFloat64(),p=e.readUInt8(),d=e.readUInt8(),f=e.readUInt8(),m=!!(f&1),g=!!(f&2),y=this.mobs.get(s);if(y)y.nx=a,y.ny=l,y.nAngle=h,y.nSize=c,y.health<y.nHealth?y.redHealthTimer=1:y.health>y.nHealth&&(y.redHealthTimer=0),u<y.nHealth&&(y.hurtT=1),y.nHealth=u,y.ox=y.x,y.oy=y.y,y.oAngle=y.angle,y.oHealth=y.health,y.oSize=y.size,y.updateT=0;else{let C=new J(s,a,l,h,c,u,p,d,m,g);this.waveMobIcons.isIconableMobInstance(C)&&this.waveMobIcons.addMobIcon(C),this.mobs.set(s,C)}}}{let r=e.readUInt16();for(let o=0;o<r;o++){let s=e.readUInt32(),a=e.readFloat64(),l=e.readFloat64(),h=To(e.readFloat64()),u=e.readFloat64(),c=e.readFloat64(),p=e.readUInt8(),d=e.readUInt8(),f=this.mobs.get(s);f?(f.nx=a,f.ny=l,f.nAngle=h,f.nSize=c,f.health<f.nHealth?f.redHealthTimer=1:f.health>f.nHealth&&(f.redHealthTimer=0),u<f.nHealth&&(f.hurtT=1),f.nHealth=u,f.ox=f.x,f.oy=f.y,f.oAngle=f.angle,f.oHealth=f.health,f.oSize=f.size,f.updateT=0):this.mobs.set(s,new J(s,a,l,h,c,u,p,d,!1,!1))}}let i=e.readUInt16();for(let r=0;r<i;r++){let o=e.readUInt32();if(this.mobs.has(o)){let s=this.mobs.get(o);s.isDead=!0;continue}if(this.players.has(o)){let s=this.players.get(o);s.isRemoved=!0,s.isDead=!0,s.deadT=0,s.health=0;continue}}},6:e=>{let i=e.readUInt32(),r=e.readString(),o=this.players.get(i);o&&this.chatContainer.addChildren(new A({y:2},`${o.name}: ${r}`,10),new k(0,3))}};this.waveProgress=0,this.updateT=0,this.waveProgressTimer=this.waveProgressRedGageTimer=this.mapRadius=0,this.oMapRadius=0,this.nMapRadius=0,this.wasDeadMenuContinued=!1,this.deadMenuBackgroundOpacity=0,this.wasWaveEnded=!1,this.currentMoodFlags=0,this.on("onKeyDown",i=>{if(this.isOperative)switch(i.key){case" ":{this.currentMoodFlags|=1,B.packetServerbound.sendWaveChangeMood(this.currentMoodFlags);break}case"Shift":{this.currentMoodFlags|=2,B.packetServerbound.sendWaveChangeMood(this.currentMoodFlags);break}case"Enter":{if(this.chatInput.hasFocus)this.chatInput.blur();else{let r=this.players.get(this.waveSelfId);if(!r)return;r.isDead&&(this.wasDeadMenuContinued&&this.leaveGame(),this.wasDeadMenuContinued||(this.wasDeadMenuContinued=!0)),this.chatInput&&this.chatInput.focus()}break}default:{if(!this.chatInput.hasFocus&&i.code.startsWith("Digit")){let r=parseInt(i.code.slice(5));r===0&&(r=10),r--,B.packetServerbound.sendWaveSwapPetal(r)}break}}}),this.on("onKeyUp",i=>{if(this.isOperative)switch(i.key){case" ":{this.currentMoodFlags&=-2,B.packetServerbound.sendWaveChangeMood(this.currentMoodFlags);break}case"Shift":{this.currentMoodFlags&=-3,B.packetServerbound.sendWaveChangeMood(this.currentMoodFlags);break}}}),this.on("onMouseDown",i=>{this.isOperative&&(i.button===0&&(this.currentMoodFlags|=1,B.packetServerbound.sendWaveChangeMood(this.currentMoodFlags)),i.button===2&&(this.currentMoodFlags|=2,B.packetServerbound.sendWaveChangeMood(this.currentMoodFlags)))}),this.on("onMouseUp",i=>{this.isOperative&&(i.button===0&&(this.currentMoodFlags&=-2,B.packetServerbound.sendWaveChangeMood(this.currentMoodFlags)),i.button===2&&(this.currentMoodFlags&=-3,B.packetServerbound.sendWaveChangeMood(this.currentMoodFlags)))}),this.on("onMouseMove",i=>{if(this.isOperative&&(Hn=i.clientX-document.documentElement.clientWidth/2,Yn=i.clientY-document.documentElement.clientHeight/2,!Ge.get("keyboard_control"))){let r=Math.atan2(Yn,Hn),o=Math.hypot(Hn,Yn)/P;B.packetServerbound.sendWaveChangeMove(r,o<100?o/100:1)}})}static{this.DEAD_MENU_CONTAINER_ANIMATION_CONFIG={defaultDurationOverride:2500,direction:"v",offset:300,offsetSign:1,fadeEffectEnabled:!1}}onInitialize(){this.addComponent(new Te({x:6,y:6},14,()=>this.leaveGame())),this.addComponent(this.waveInformationContainer=new(fr(he))(()=>({x:-(this.waveInformationContainer.w/2),y:30,alignFromCenterX:!0})).addChildren(new(te(A))({},()=>Ss[this.biome],16),new k(0,4),new(te(Et))({w:140,h:12},()=>{let e=Ms(this.waveProgress);return[{value:this.waveProgressTimer,maxValue:e,thickness:.75,color:ws[this.biome],lowBehavior:"lineWidth"},{value:this.waveProgressRedGageTimer,maxValue:e,thickness:.6,color:"#e32933",lowBehavior:"lineWidth"}]},0,()=>"Wave "+this.waveProgress),new k(0,8),this.waveMobIcons=new(te(Oi))({})));{let e;this.deadMenuContainer=new he(()=>({x:-(this.deadMenuContainer.w/2),y:-(this.deadMenuContainer.h/2),alignFromCenterX:!0,alignFromCenterY:!0}),!1).addChildren(new(te(A))({},"You were destroyed by:",12.2),new k(2,2),new(te(A))({},"Poison",16.1),new k(100,100),e=new(te(_))({w:88,h:24},3,3,1,[new A({x:3,y:2},"Continue",17)],()=>{this.wasDeadMenuContinued=!0,this.deadMenuContainer.setVisible(!1,e,!0,1,n.DEAD_MENU_CONTAINER_ANIMATION_CONFIG)},"#1dd129",!0),new k(0,4),new(te(A))({},"(or press enter)",12)),this.deadMenuContainer.setVisible(!1,null,!1),this.addComponent(this.deadMenuContainer)}this.gameOverMenuContainer=new he(()=>({x:-(this.gameOverMenuContainer.w/2),y:-(this.gameOverMenuContainer.h/2),alignFromCenterX:!0,alignFromCenterY:!0}),!1).addChildren(new(te(A))({},"GAME OVER",34,"#f0666b"),new k(20,20),new(te(_))({w:88,h:24},3,3,1,[new A({x:3,y:2},"Continue",17)],()=>this.leaveGame(),"#c62327",!0),new k(0,4),new(te(A))({},"(or press enter)",12)),this.gameOverMenuContainer.setVisible(!1,null,!1),this.addComponent(this.gameOverMenuContainer),this.youWillRespawnNextWaveContainer=new ot(()=>({x:-(this.youWillRespawnNextWaveContainer.w/2),y:-(this.youWillRespawnNextWaveContainer.h/2)+50,alignFromCenterX:!0,alignFromCenterY:!0}),2).addChildren(new A({y:3},"You will respawn next wave",10),new j(1,1,0,16)),this.youWillRespawnNextWaveContainer.setVisible(!1,null,!1),this.addComponent(this.youWillRespawnNextWaveContainer);{this.addComponent(this.chatInput=new at({x:13,y:34,w:192,h:8,invertYCoordinate:!0},{canvas:this.canvas,value:"",fontSize:11,fontFamily:"Ubuntu",fontColor:"#212121",fontWeight:"bold",placeHolder:"",placeHolderUnfocused:"Press [ENTER] or click here to chat",placeHolderDisplayUnfocusedState:!0,borderColor:"#000000",borderRadius:4,borderWidth:2.2,maxlength:80,onsubmit:(i,r)=>{B.packetServerbound.sendWaveChat(r.value),r.value=""},onkeydown:(i,r)=>{let o=r.value.startsWith("/");e.setVisible(!o,null,!1),this.commandsContainer.setVisible(o,null,!1)}}));let e;this.addComponent(e=new ot(()=>({x:11,y:37+e.h,invertYCoordinate:!0}),2,()=>this.chatInput.hasFocus?.5:0).addChild(this.chatContainer=new he({}))),this.addComponent(this.commandsContainer=new he(()=>({x:11,y:37+this.commandsContainer.h,invertYCoordinate:!0})).addChildren(new ot({},0,0).addChildren(new A({y:2},"/manko - kusai",10,"#d2eb34"),new j(0,0,0,14)))),this.commandsContainer.setVisible(!1,null,!1)}this.addComponent(this.inventory=new(fr(Li))(()=>({x:-(this.inventory.w/2),y:105,alignFromCenterX:!0,invertYCoordinate:!0})))}render(){this.updateT+=W/100,this.t=Math.min(1,this.updateT),this.mapRadius=this.oMapRadius+(this.nMapRadius-this.oMapRadius)*this.t,Wn=Er(Wn,Hn/fe,50),Fn=Er(Fn,Yn/fe,50);let e=this.canvas,i=e.getContext("2d");i.clearRect(0,0,e.width,e.height);let r=e.width/P,o=e.height/P,s=r/2,a=o/2,l=this.players.get(this.waveSelfId);if(l){this.tilesetRenderer.renderGameTileset({canvas:e,tileset:Xt.get(this.biome),tileSize:300,radius:this.mapRadius,playerX:l.x,playerY:l.y}),this.drawMutableFunctions(e),this.mobs.forEach((h,u)=>{h.update(),h.isDead&&h.deadT>1&&(this.waveMobIcons.isIconableMobInstance(h)&&this.waveMobIcons.removeMobIcon(h),this.mobs.delete(u))}),this.players.forEach((h,u)=>{h.update(),h.isDead&&h.deadT>1&&h.isRemoved&&this.players.delete(u)});{let h=e.width/P/fe+500,u=e.height/P/fe+500,c=h/2,p=u/2,d=l.x-c,f=l.x+c,m=l.y-p,g=l.y+p,y=[];for(let[,C]of this.mobs)Qe(C.type)||C.x>=d&&C.x<=f&&C.y>=m&&C.y<=g&&y.push(C);for(let[,C]of this.mobs)Qe(C.type)&&C.x>=d&&C.x<=f&&C.y>=m&&C.y<=g&&y.push(C);for(let[,C]of this.players)C.x>=d&&C.x<=f&&C.y>=m&&C.y<=g&&y.push(C);i.save(),i.translate(s,a),i.scale(fe,fe),i.translate(-l.x,-l.y);for(let C of y)qe({ctx:i,entity:C,isSpecimen:!1});i.restore()}kt(i,this.waveInformationContainer),kt(i,this.inventory),i.save(),i.globalAlpha=this.deadMenuBackgroundOpacity,i.fillStyle="black",i.fillRect(0,0,r,o),i.restore(),l.isDead?(this.deadMenuBackgroundOpacity<this.DEAD_BACKGROUND_TARGET_OPACITY&&!(this.wasDeadMenuContinued&&!this.wasWaveEnded)&&(this.deadMenuBackgroundOpacity=Math.min(this.deadMenuBackgroundOpacity+W/1e3/this.DEAD_BACKGROUND_FADE_DURATION*this.DEAD_BACKGROUND_TARGET_OPACITY,this.DEAD_BACKGROUND_TARGET_OPACITY)),this.wasDeadMenuContinued?this.wasWaveEnded?(this.gameOverMenuContainer.visible||this.gameOverMenuContainer.setVisible(!0,null,!0,2),this.youWillRespawnNextWaveContainer.isOutAnimatable&&this.youWillRespawnNextWaveContainer.setVisible(!1,null,!0,2,{defaultDurationOverride:500})):(this.deadMenuBackgroundOpacity=Math.max(this.deadMenuBackgroundOpacity-W/1e3/this.DEAD_BACKGROUND_FADE_DURATION*this.DEAD_BACKGROUND_TARGET_OPACITY,0),this.youWillRespawnNextWaveContainer.visible||this.youWillRespawnNextWaveContainer.setVisible(!0,null,!0,2,{defaultDurationOverride:500})):this.deadMenuContainer.visible||this.deadMenuContainer.setVisible(!0,null,!0,1,n.DEAD_MENU_CONTAINER_ANIMATION_CONFIG)):(this.deadMenuBackgroundOpacity=0,this.deadMenuContainer.isOutAnimatable&&this.deadMenuContainer.setVisible(!1,null,!0,1,n.DEAD_MENU_CONTAINER_ANIMATION_CONFIG),this.youWillRespawnNextWaveContainer.isOutAnimatable&&this.youWillRespawnNextWaveContainer.setVisible(!1,null,!0,2,{defaultDurationOverride:500})),this.renderComponents()}}destroy(){super.destroy(),this.tilesetRenderer=null,this.players.clear(),this.mobs.clear()}onContextChange(){let e=this.players.get(this.waveSelfId);e&&!e.isDead&&(e.isDead=!0,e.deadT=0)}drawMutableFunctions(e){let r=e.getContext("2d"),o=this.players.get(this.waveSelfId),s=e.width/P,a=e.height/P;if(!(Ge.get("keyboard_control")||!Ge.get("movement_helper"))&&o&&!o.isDead){r.save(),r.translate(s/2,a/2),r.rotate(Math.atan2(Fn,Wn)),r.scale(fe,fe);let l=Math.hypot(Wn,Fn)/P;r.beginPath(),r.moveTo(30,0),r.lineTo(l,0),r.lineTo(l-24,-18),r.moveTo(l,0),r.lineTo(l-24,18),r.lineWidth=12,r.lineCap="round",r.lineJoin="round",r.globalAlpha=l<100?Math.max(l-50,0)/50:1,r.strokeStyle="rgba(0,0,0,0.2)",r.stroke(),r.restore()}}leaveGame(){this.gameOverMenuContainer.setVisible(!1,null,!0,2,{defaultDurationOverride:1e3}),B.packetServerbound.sendWaveLeave(),Ce.switchUI("title")}get isOperative(){let e=this.players.get(this.waveSelfId);return!e||!B?!1:!e.isDead}};var xo=(e=>(e[e.PUBLIC=0]="PUBLIC",e[e.PRIVATE=1]="PRIVATE",e))(xo||{}),y2=Object.values(xo),qn=(e=>(e[e.PREPARING=0]="PREPARING",e[e.READY=1]="READY",e))(qn||{}),g2=Object.values(qn);function _a(n){if(n.length!==10||n[3]!=="-")return!1;let[t,e]=n.split("-");return!(t.length!==3||!/^[0-9a-f]{3}$/.test(t)||e.length!==6||!/^[a-z]{6}$/.test(e))}var At=class n extends v{constructor(e,i){super();this.layoutOptions=e;this.scalingProgress=0;this.scalingStartTime=null;this.toggle=!1;this.on("onFocus",()=>{this.context.canvas.style.cursor="pointer"}),this.on("onBlur",()=>{this.context.canvas.style.cursor="default"}),this.on("onClick",()=>i(!this.toggle))}static{this.SCALING_DURATION=50}layout(e){return X.layout(v.computePointerLike(this.layoutOptions),e)}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v;return super.getCacheKey(e)+i+Object.values(v.computePointerLike(this.layoutOptions)).join(i)}invalidateLayoutCache(){this.layoutCache.invalidate()}render(e){super.render(e),this.updateScale();let i=this.getStrokeWidth();e.save(),e.lineWidth=i,e.strokeStyle="#333333",e.fillStyle="#666666",e.beginPath(),e.roundRect(this.x,this.y,this.w,this.h,.05),e.fill(),e.stroke(),e.closePath(),e.restore(),e.save(),e.globalAlpha=this.scalingProgress;let r=this.w-i,o=this.h-i,s=this.x+(this.w-r)/2,a=this.y+(this.h-o)/2;e.fillStyle="#dddddd",e.beginPath(),e.rect(s,a,r,o),e.fill(),e.closePath(),e.restore()}getStrokeWidth(){return Math.max(2,Math.min(this.w,this.h)*.17)}setToggle(e){return this.toggle=e,this.scalingStartTime=performance.now(),this.scalingProgress=e?0:1,this}updateScale(){if(this.scalingStartTime===null)return;let i=performance.now()-this.scalingStartTime;this.toggle?this.scalingProgress=Math.min(i/n.SCALING_DURATION,1):this.scalingProgress=Math.max(1-i/n.SCALING_DURATION,0),(this.scalingProgress>=1||this.scalingProgress<=0)&&(this.scalingStartTime=null)}};function ct(n,t="up"){class e extends n{static{this.COLLISION_SPEED=.3}static{this.RETURN_SPEED=.2}static{this.GAP=4}static{this.DEAD_ZONE=5}constructor(...r){super(...r),this.collidableComponents=[],this.targetYPos=null,this.initialYPos=this.y,this.isReturning=!1}layout(r){let o=this.initialYPos-this.y,s=super.layout(r);return this.initialYPos=s.y,s.y-=o,s}resolveCollision(r){t==="up"?this.targetYPos=r.y-this.h-e.GAP:this.targetYPos=r.y+r.h+e.GAP,this.isReturning=!1}isColliding(r){let{GAP:o}=e;return!(this.x+this.w+o<r.x||this.x>r.x+r.w+o||this.y+this.h+o<r.y||this.y>r.y+r.h+o)}filterCollidable(r){return r.filter(o=>o.visible)}addCollidableComponents(...r){this.collidableComponents=this.collidableComponents.concat(r.filter(o=>!this.collidableComponents.includes(o)))}render(r){super.render(r);let o=!1;if(this.filterCollidable(this.collidableComponents).forEach(s=>{this.isColliding(s)&&(this.resolveCollision(s),o=!0)}),o||(this.targetYPos=this.initialYPos,this.isReturning=!0),this.targetYPos!==null){let s=this.isReturning?e.RETURN_SPEED:e.COLLISION_SPEED,a=this.targetYPos-this.y;this.y+=a*s,Math.abs(a)<e.DEAD_ZONE&&(this.setY(this.targetYPos),this.targetYPos=null)}}}return e}var Xu=Symbol("dynamicLayoutable"),Va,Ua,Gn=class extends(Ua=v,Va=Xu,Ua){constructor(){super(...arguments);this[Va]=!0}};var za,Wa,Di=class extends(Wa=Gn,za=ne,Wa){constructor(e,i,r,o,s){super();this.layoutOptions=e;this.id=i;this.name=r;this.readyState=o;this.isEmpty=s;this[za]=!1;this.dummyPlayer=new Ie(-1,0,-28,10,15,0,0,"")}layout(e){return X.layout(v.computePointerLike(this.layoutOptions),e)}getCacheKey(e){let{CACHE_KEY_DELIMITER:i}=v;return super.getCacheKey(e)+i+Object.values(v.computePointerLike(this.layoutOptions)).join(i)}invalidateLayoutCache(){this.layoutCache.invalidate()}render(e){if(super.render(e),e.save(),e.translate(this.x,this.y),e.save(),e.lineWidth=4,e.strokeStyle="black",e.globalAlpha=de,e.beginPath(),e.roundRect(0,0,this.w,this.h,.5),e.stroke(),e.closePath(),e.restore(),e.translate(this.w/2,this.h/2),v.computePointerLike(this.isEmpty))e.lineJoin="round",e.lineCap="round",e.textBaseline="middle",e.textAlign="center",e.fillStyle="white",e.strokeStyle="#000000",e.font="10px Ubuntu",e.lineWidth=Pe(10),e.strokeText("Empty",0,0),e.fillText("Empty",0,0);else{{let o=v.computePointerLike(this.name);e.save(),e.lineJoin="round",e.lineCap="round",e.textBaseline="middle",e.textAlign="center",e.fillStyle="white",e.strokeStyle="#000000",e.font="10px Ubuntu",e.lineWidth=Pe(10),this.drawScaledText(e,o,0,0,this.w*.9),e.restore()}let i=v.computePointerLike(this.id);this.context instanceof Ve&&i===this.context.waveRoomSelfId&&(e.save(),e.translate(0,12),e.lineJoin="round",e.lineCap="round",e.textBaseline="middle",e.textAlign="center",e.fillStyle="white",e.strokeStyle="#000000",e.font="8px Ubuntu",e.lineWidth=Pe(8),e.strokeText("(you)",0,0),e.fillText("(you)",0,0),e.restore()),v.computePointerLike(this.readyState)===1&&(e.save(),e.translate(0,32),e.lineJoin="round",e.lineCap="round",e.textBaseline="middle",e.textAlign="center",e.fillStyle="#70fc68",e.strokeStyle="#000000",e.font="11px Ubuntu",e.lineWidth=Pe(11),e.strokeText("Ready",0,0),e.fillText("Ready",0,0),e.restore()),qe({ctx:e,entity:this.dummyPlayer,isSpecimen:!0})}e.restore()}destroy(){super.destroy(),this.dummyPlayer=null}drawScaledText(e,i,r,o,s){let l=e.measureText(i).width;if(e.save(),l>s){let h=s/l;e.translate(r,o),e.scale(h,1),e.translate(-r,-o),e.strokeText(i,r,o),e.fillText(i,r,o)}else e.strokeText(i,r,o),e.fillText(i,r,o);e.restore()}};var Xn='<svg xmlns="http://www.w3.org/2000/svg" width="800" height="800" preserveAspectRatio="xMidYMid" viewBox="0 -28.5 256 256"><path fill="#fff" d="M216.856 16.597A208.5 208.5 0 0 0 164.042 0c-2.275 4.113-4.933 9.645-6.766 14.046q-29.538-4.442-58.533 0c-1.832-4.4-4.55-9.933-6.846-14.046a207.8 207.8 0 0 0-52.855 16.638C5.618 67.147-3.443 116.4 1.087 164.956c22.169 16.555 43.653 26.612 64.775 33.193A161 161 0 0 0 79.735 175.3a136.4 136.4 0 0 1-21.846-10.632 109 109 0 0 0 5.356-4.237c42.122 19.702 87.89 19.702 129.51 0a132 132 0 0 0 5.355 4.237 136 136 0 0 1-21.886 10.653c4.006 8.02 8.638 15.67 13.873 22.848 21.142-6.58 42.646-16.637 64.815-33.213 5.316-56.288-9.08-105.09-38.056-148.36M85.474 135.095c-12.645 0-23.015-11.805-23.015-26.18s10.149-26.2 23.015-26.2 23.236 11.804 23.015 26.2c.02 14.375-10.148 26.18-23.015 26.18m85.051 0c-12.645 0-23.014-11.805-23.014-26.18s10.148-26.2 23.014-26.2c12.867 0 23.236 11.804 23.015 26.2 0 14.375-10.148 26.18-23.015 26.18"/></svg>';function Ni(n,t,e,i,r=3,o=!0){class s extends n{constructor(...h){super(...h);this.tooltipIsHovered=!1;this.once("onInitialized",()=>{this.tooltipContainer=new ot(()=>this.calculateOptimalPosition(),r).addChildren(...t),this.tooltipContainer[ne]=!1,this.tooltipContainer.setVisible(!1,null,!1),this.context.addComponent(this.tooltipContainer)}),this.on("onFocus",()=>{let{shouldShowTooltip:u}=this;this.tooltipIsHovered=!0,u&&this.updateTooltipVisibility(!0)}),this.on("onBlur",()=>{let{shouldShowTooltip:u}=this;this.tooltipIsHovered=!1,u&&this.updateTooltipVisibility(!1)})}static{this.TOOLTIP_FADE_ANIMATION_CONFIG={defaultDurationOverride:100}}updateTooltipVisibility(h){this.tooltipContainer.setVisible(h,this,!0,2,s.TOOLTIP_FADE_ANIMATION_CONFIG)}calculateOptimalPosition(){let{x:h,y:u,w:c,h:p}=this,{w:d,h:f}=this.tooltipContainer,m=0,g=0;switch(i){case"top":m=h+c/2-d/2,g=u-f-e;break;case"bottom":m=h+c/2-d/2,g=u+p+e;break;case"left":m=h-d-e,g=u+p/2-f/2;break;case"right":m=h+c+e,g=u+p/2-f/2;break}return{x:m,y:g}}get shouldShowTooltip(){return!v.computePointerLike(o)||!this.context||!this.tooltipContainer?!0:this.context.isComponentNotOverlappingWithOtherComponents(this.tooltipContainer)}render(h){super.render(h);let{shouldShowTooltip:u}=this;u&&this.tooltipIsHovered&&!this.tooltipContainer.desiredVisible&&this.updateTooltipVisibility(!0),!u&&this.tooltipContainer.desiredVisible&&this.updateTooltipVisibility(!1)}destroy(){super.destroy()}}return s}var Y=35,Oe=(n,t,e,i)=>Ni(n,[new A({y:5},t,11),new j(1,1,0,22)],e,i);function Bi(n,t){return n.flatMap((e,i)=>i?[t(),e]:[e])}var _i=class extends Oe(_,"Join our Discord community!",6,"right"){constructor(t){super({...t,w:Y,h:Y},3,3,1,[new pe({w:Y,h:Y},Xn,.7)],()=>{window.open("unko").document.write("\u307E\u3060\u5B9F\u88C5\u3055\u308C\u3066\u306A\u3044\u308F\u30DC\u30B1\u30FC")},"#5865f2",!0)}};var Vi=class n extends ut{constructor(...e){super(...e);this.isDragging=!1;this.offsetX=0;this.offsetY=0;this.wobbleTime=0;this.currentScale=1;this.on("onDown",()=>{this.isLayoutable=!1,this.isDragging=!0,this.offsetX=this.context.mouseX-this.x,this.offsetY=this.context.mouseY-this.y,this[Lt]=!0}),this.on("onUp",()=>{this.isLayoutable=!0,this.isDragging=!1,this.wobbleTime=0,this[Lt]=!1}),this.on("onFocus",()=>{this.context.canvas.style.cursor="pointer"}),this.on("onBlur",()=>{this.context.canvas.style.cursor="default"}),this.on("onMouseMove",()=>{this.isDragging&&(this.setX(this.context.mouseX-this.offsetX),this.setY(this.context.mouseY-this.offsetY))})}static{this.DRAGGING_SCALE=1.6}static{this.SCALE_INTERPOLATION_SPEED=.1}static{this.WOBBLE_AMPLITUDE=.1}static{this.WOBBLE_SPEED=.01}render(e){let i=this.isDragging?n.DRAGGING_SCALE:1;if(this.currentScale+=(i-this.currentScale)*n.SCALE_INTERPOLATION_SPEED,this.isDragging){let r=this.x+this.w/2,o=this.y+this.h/2;e.translate(r,o),e.scale(this.currentScale,this.currentScale);let s=Math.sin(this.wobbleTime*n.WOBBLE_SPEED)*n.WOBBLE_AMPLITUDE;e.rotate(s),e.translate(-r,-o),this.wobbleTime+=W}super.render(e)}};var Fa='<svg xmlns="http://www.w3.org/2000/svg" style="height:512px;width:512px" viewBox="0 0 512 512"><path fill="none" d="M0 0h512v512H0z"/><g fill="#fff"><path d="M363.783 23.545c-9.782.057-16.583 3.047-20.744 10.22-17.51 30.18-38.432 61.645-48.552 97.245 2.836.83 5.635 1.787 8.373 2.853 7.353 2.863 14.38 6.482 20.542 10.858 27.534-25.542 58.165-45.21 87.45-65.462 11.356-7.854 12.273-13.584 10.183-20.83s-9.868-16.365-20.525-23.176c-10.658-6.81-23.87-11.33-34.73-11.68q-1.02-.032-1.997-.027ZM294.785 24.291c-10.02-.182-17.792 6.393-23.924 20.24-8.94 20.194-10.212 53.436-1.446 83.185.156-.008.31-.023.467-.03 1.99-.087 3.99-.072 6 .03 9.436-34.822 27.966-64.72 44.013-91.528-10.31-8.496-18.874-11.782-25.108-11.896ZM197.5 82.5 187 97.97c14.82 10.04 29.056 19.725 39.813 31.374 3.916 4.24 7.37 8.722 10.31 13.607a38.1 38.1 0 0 1 13.69-10.792c.407-.188.82-.355 1.228-.53-3.423-5.44-7.304-10.418-11.51-14.972C227.765 102.83 212.29 92.52 197.5 82.5"/><path d="M421.27 94.77c-29.255 20.228-58.575 39.152-84.348 62.78.438.576.848 1.168 1.258 1.76 20.68-6.75 49.486-15.333 73.916-19.41 11.484-1.916 15.66-6.552 17.574-13.228s.447-16.71-5.316-26.983a63 63 0 0 0-3.083-4.92Z" class="selected"/><path d="M197.332 142.64c-14.95.2-29.732 4.3-43.957 12.766l9.563 16.03c21.657-12.89 42.626-14.133 65.232-4.563q.782-8.387 3.728-15.21c.35-.806.73-1.586 1.123-2.354-11.87-4.52-23.83-6.827-35.688-6.67ZM273.132 146.574c-5.578-.083-10.597.742-14.427 2.526-4.377 2.038-7.466 4.914-9.648 9.97-.884 2.047-1.572 4.54-1.985 7.494.456-.007.91-.03 1.365-.033 16.053-.084 32.587 2.77 49.313 9.19 7.714 2.96 15.062 7.453 22.047 13.184 3.217-2.445 4.99-4.72 5.773-6.535 1.21-2.798 1.095-5.184-.634-8.82-3.46-7.275-15.207-16.955-28.856-22.27-6.824-2.658-13.98-4.224-20.523-4.614q-1.228-.075-2.424-.092ZM248.375 185.031c-22.982.075-44.722 7.386-65 19.782-32.445 19.835-60.565 53.124-80.344 90.032-19.777 36.908-31.133 77.41-31.186 110.53-.053 33.06 10.26 57.27 32.812 67.782.043.02.082.043.125.063h.032c24.872 11.51 65.616 19.337 108.407 20.092 42.79.756 87.79-5.457 121.874-20.187 21.96-9.49 34.545-28.452 40.5-54.156 5.954-25.705 4.518-57.657-2.375-89.314-6.894-31.657-19.2-63.06-34.095-87.875s-32.614-42.664-48.063-48.593c-14.664-5.627-28.898-8.2-42.687-8.156"/></g></svg>';var Ui=class extends Oe(_,"Inventory",6,"right"){constructor(t){super({...t,w:Y,h:Y},3,3,1,[new pe({w:Y,h:Y},Fa)],()=>{this.inventoryContainer.setVisible(!this.inventoryContainer.desiredVisible,this,!0,1,{direction:"v",offsetSign:-1})},"#599dd8",!0),this.once("onInitialized",()=>{this.inventoryContainer=this.createInventoryContainer(),this.inventoryContainer.setVisible(!1,null,!1),this.context.addComponent(this.inventoryContainer)})}createInventoryContainer(){let t,e=new le(()=>({x:72,y:15+e.h,invertYCoordinate:!0}),!0,"#5a9fdb",.1).addChildren(t=new Te({x:242,y:5},12,()=>{e.setVisible(!1,t,!0,1,{direction:"v",offsetSign:-1})}),new j(15,15,245.5,0),new A({x:88,y:4},"Inventory",16),new A({x:50,y:40},"Click on a petal to equip it",11),new he({x:5,y:60},!1).addChildren(...Bi(Array.from({length:2},()=>new(te(Ee))({}).addChildren(...Bi(Array.from({length:6},()=>new Vi({},new J(-1,0,0,0,0,0,15,0,!1,!1),1)),()=>new k(8,0)))),()=>new k(0,8)),new k(0,5)));return e}};var Ha='<svg xmlns="http://www.w3.org/2000/svg" style="height:512px;width:512px" viewBox="0 0 512 512"><path fill="none" d="M0 0h512v512H0z"/><path fill="#fff" d="M132.172 157.504a155 155 0 0 0-18.296 21.698 99.274 99.274 0 1 1 186.291-53.827 153.45 153.45 0 0 0-58.134-12.138h-1.982a152.77 152.77 0 0 0-107.879 44.267m105.97 263.021A153.88 153.88 0 0 1 93.014 311.583a99.286 99.286 0 1 0 162.84 108.154 156 156 0 0 1-15.719.8h-1.981zm125.101-231.262h-1.098a84.642 84.642 0 0 0-1.05 169.272h1.098a84.642 84.642 0 0 0 1.05-169.272m-104.8 83.317a103.834 103.834 0 0 1 78.317-99.286 134.14 134.14 0 0 0-94.942-40.96h-1.743a134.566 134.566 0 0 0-1.67 269.107h1.742a134 134 0 0 0 85.31-30.53 103.92 103.92 0 0 1-67.014-98.33z"/></svg>';var zi=class extends Oe(_,"Craft",6,"right"){constructor(t){super({...t,w:Y,h:Y},3,3,1,[new pe({w:Y,h:Y},Ha)],()=>{console.log("ho")},"#db9d5a",!0)}};var Ya='<svg xmlns="http://www.w3.org/2000/svg" style="height:512px;width:512px" viewBox="0 0 512 512"><path fill="none" d="M0 0h512v512H0z"/><path fill="#fff" d="M103.432 17.844a87 87 0 0 0-3.348.08q-3.822.163-7.604.678c-20.167 2.747-39.158 13.667-52.324 33.67-24.613 37.4 2.194 98.025 56.625 98.025.536 0 1.058-.012 1.583-.022v.704h60.565c-10.758 31.994-30.298 66.596-52.448 101.43a283 283 0 0 0-6.29 10.406l34.878 35.733-56.263 9.423c-32.728 85.966-27.42 182.074 48.277 182.074v-.002l9.31.066c23.83-.57 46.732-4.298 61.325-12.887 4.174-2.458 7.63-5.237 10.467-8.42h-32.446c-20.33 5.95-40.8-6.94-47.396-25.922-8.956-25.77 7.52-52.36 31.867-60.452a55.6 55.6 0 0 1 17.565-2.834v-.406h178.33c-.57-44.403 16.35-90.125 49.184-126 23.955-26.176 42.03-60.624 51.3-94.846l-41.225-24.932 38.272-6.906-43.37-25.807h-.005l.002-.002.002.002 52.127-8.85c-5.232-39.134-28.84-68.113-77.37-68.113C341.14 32.26 222.11 35.29 149.34 28.496c-14.888-6.763-30.547-10.723-45.908-10.652m.464 18.703c13.137.043 27.407 3.804 41.247 10.63l.033-.07c4.667 4.735 8.542 9.737 11.68 14.985H82.92l10.574 14.78c10.608 14.83 19.803 31.99 21.09 42.024.643 5.017-.11 7.167-1.814 8.836-1.705 1.67-6.228 3.875-15.99 3.875-40.587 0-56.878-44.952-41.012-69.06C66.238 46.64 79.582 39.22 95.002 37.12a64 64 0 0 1 8.894-.573M118.5 80.78h46.28c4.275 15.734 3.656 33.07-.544 51.51H131.52c1.9-5.027 2.268-10.574 1.6-15.77-1.527-11.913-7.405-24.065-14.62-35.74m101.553 317.095c6.44 6.84 11.192 15.31 13.37 24.914 3.797 16.736 3.092 31.208-1.767 43.204-4.526 11.175-12.576 19.79-22.29 26h237.19c14.448 0 24.887-5.678 32.2-14.318 7.312-8.64 11.2-20.514 10.705-32.352a47.7 47.7 0 0 0-2.407-13.18l-69.91-8.205 42.017-20.528c-8.32-3.442-18.64-5.537-31.375-5.537H220.053zm-42.668.506a37 37 0 0 0-3.457.153 34.8 34.8 0 0 0-7.824 1.63c-15.11 5.02-25.338 21.54-20.11 36.583 3.673 10.57 15.347 17.71 25.654 13.938l1.555-.57h43.354c.946-6.36.754-13.882-1.358-23.192-3.71-16.358-20.543-28.483-37.815-28.54z"/></svg>';var Wi=class extends Oe(_,"Changelog",6,"right"){constructor(t){super({...t,w:Y,h:Y},3,3,1,[new pe({w:Y,h:Y},Ya)],()=>{this.changelogContainer.setVisible(!this.changelogContainer.desiredVisible,this,!0,1,{direction:"v",offsetSign:-1})},"#9bb56b",!0),this.once("onInitialized",()=>{this.changelogContainer=this.createChangelogContainer(),this.changelogContainer.setVisible(!1,null,!1),this.context.addComponent(this.changelogContainer)})}createChangelogContainer(){let t,e,i=new le(()=>({x:72,y:15+i.h,invertYCoordinate:!0}),!0,"#9bb56b",.1).addChildren(t=new Te({x:310,y:5},12,()=>{i.setVisible(!1,t,!0,1,{direction:"v",offsetSign:-1})}),new j(15,15,313.5,0),new A({x:118,y:4},"Changelog",16),e=new pn({x:4,y:40,w:323,h:220},5.5,75).addChildren(...Bi(Array.from({length:50},()=>new(te(A))({},"Older changelog entries not available",9.5,"#ffffff","center")),()=>new k(0,10))));return i}};var qa='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="800" height="800" fill="#fff" stroke="#fff" stroke-width="12" viewBox="-6 -6 132 132"><path d="M114.251 70.731c2.211 0 4.271-1.793 4.572-3.985 0 0 .422-3.081.422-6.745s-.422-6.745-.422-6.745c-.304-2.193-2.361-3.986-4.572-3.986h-11.433c-2.214 0-4.512-1.411-5.106-3.135s-1.414-7.255.151-8.819l8.08-8.081c1.564-1.565 1.686-4.236.269-5.937l-9.507-9.51c-1.701-1.418-4.371-1.298-5.938.268l-8.08 8.081c-1.564 1.566-4.173 2.196-5.793 1.402s-6.163-4.143-6.163-6.356V5.75c0-2.213-1.794-4.271-3.985-4.572 0 0-3.081-.424-6.745-.424s-6.745.424-6.745.424c-2.193.301-3.988 2.359-3.988 4.572v11.433c0 2.213-1.41 4.511-3.135 5.106s-7.255 1.414-8.82-.151l-8.081-8.081c-1.565-1.565-4.236-1.686-5.936-.269l-9.509 9.509c-1.418 1.701-1.298 4.371.268 5.937l8.08 8.081c1.565 1.565 2.197 4.172 1.402 5.792s-4.143 6.163-6.356 6.163H5.75c-2.213 0-4.271 1.794-4.573 3.986 0 0-.424 3.081-.424 6.744 0 3.665.424 6.744.424 6.744.301 2.194 2.359 3.987 4.573 3.987h11.433c2.213 0 4.511 1.409 5.105 3.135s1.414 7.254-.152 8.818l-8.08 8.081c-1.565 1.565-1.686 4.236-.268 5.938l9.508 9.509c1.701 1.417 4.37 1.299 5.936-.269l8.081-8.08c1.565-1.564 4.172-2.195 5.793-1.401s6.162 4.143 6.162 6.355v11.433c0 2.212 1.794 4.27 3.988 4.57 0 0 3.08.424 6.745.424s6.745-.424 6.745-.424c2.193-.301 3.985-2.358 3.985-4.57v-11.433c0-2.213 1.411-4.512 3.136-5.106s7.256-1.413 8.82.151l8.08 8.081c1.565 1.563 4.236 1.686 5.938.268l9.507-9.506c1.417-1.701 1.299-4.37-.269-5.938l-8.08-8.08c-1.565-1.564-2.197-4.172-1.401-5.793.794-1.62 4.143-6.163 6.355-6.163zM60 81.687c-11.977 0-21.686-9.707-21.686-21.687 0-11.976 9.709-21.686 21.686-21.686S81.687 48.023 81.687 60 71.977 81.687 60 81.687z"/></svg>';var Ju=n=>Math.sqrt(1-Math.pow(n-1,2)),Fi=class n extends _{constructor(e,i,r){super({...e,w:i,h:i},3,3,1,[new pe({w:i,h:i},qa,.8,()=>this.currentGearRotation)],r,"#aaaaaa",!0);this.currentGearRotation=0;this.rotationStartTime=0;this.initialRotation=0;this.isReturning=!1;this.isClicked=!1;let o=()=>{this.isReturning=!1,this.gearRotationInterval&&clearInterval(this.gearRotationInterval),this.gearRotationInterval=setInterval(()=>{this.currentGearRotation+=.004},1)},s=()=>{this.isClicked||(this.gearRotationInterval&&clearInterval(this.gearRotationInterval),this.isReturning=!0,this.initialRotation=this.currentGearRotation,this.rotationStartTime=Date.now())};this.on("onFocus",o),this.on("onBlur",s),this.on("onClick",()=>{this.isClicked=!0}),this.on("onClickedOutside",()=>{this.isClicked=!1,s()})}static{this.RETURN_DURATION=250}render(e){if(super.render(e),this.isReturning){let i=Date.now()-this.rotationStartTime,r=Math.min(i/n.RETURN_DURATION,1);r<1?this.currentGearRotation=this.initialRotation*(1-Ju(r)):(this.currentGearRotation=0,this.isReturning=!1)}}};var Hi=class extends Oe(Fi,"Settings",6,"right"){constructor(t){super(t,Y,()=>{this.settingContainer.setVisible(!this.settingContainer.desiredVisible,this,!0,1,{defaultDurationOverride:150,direction:"v",offsetSign:-1})}),this.once("onInitialized",()=>{this.creditContainer=this.createCreditContainer(),this.settingContainer=this.createSettingContainer(this.creditContainer),this.creditContainer.setVisible(!1,null,!1),this.context.addComponent(this.creditContainer),this.settingContainer.setVisible(!1,null,!1),this.context.addComponent(this.settingContainer)})}createSettingContainer(t){let e=(a,l,h)=>{let u=new At({x:5,y:a-1,w:17,h:17},c=>{u.setToggle(c),Ge.set(l,c)}).setToggle(Ge.get(l));return[u,new A({x:25.5,y:a+1+.5},h,11)]},i=(a,l,h)=>new _({x:5,y:a,w:138,h:14},2,3,1,[new A(()=>({x:45,y:1}),l,11)],h,"#aaaaaa",!0),r,o,s=new le({x:72,y:225.5,invertYCoordinate:!0},!0,"#aaaaaa",.1).addChildren(r=new Te({x:146,y:2},12,()=>{s.setVisible(!1,r,!0,1,{direction:"v",offsetSign:-1})}),new A({x:44,y:4},"Settings",16),...e(40,"keyboard_control","Keyboard movement"),...e(70,"movement_helper","Movement helper"),o=i(100,"Credits",()=>{s.setVisible(!1,o,!0,1,{direction:"v",offsetSign:-1}),t.setVisible(!0,o,!0,1,{direction:"v",offsetSign:-1})}),new j(15,15,150,186));return s}createCreditContainer(){let t,e=new le({x:72,y:220,invertYCoordinate:!0},!0,"#aaaaaa",.1).addChildren(t=new Te({x:174,y:5},12,()=>{e.setVisible(!1,t,!0,1,{direction:"v",offsetSign:-1})}),new A({x:62.5,y:4},"Credits",16),new A({x:6.5,y:35},"florr.io made by Matheus Valadares",12,"#ffffff","left",130),new A({x:1.5,y:77.5},"floooo.io made by Youdi3",12),new A({x:6,y:100},"Some icons by Lorc & Skoll from game-icons.net",10.75,"#ffffff","left",180),new A({x:6,y:140},"Special thanks: Max Nest, k2r_n2iq and people who keep motivating me every time",10.75,"#ffffff","left",180),new j(15,15,178,180.5));return e}};var Yi=class n extends he{static{this.GAP_BETWEEN_BUTTONS=10}constructor(t){super(t);let{GAP_BETWEEN_BUTTONS:e}=n;this.addChildren(new _i({}),new k(0,e),new Ui({}),new k(0,e),new zi({}),new k(0,e),new Wi({}),new k(0,e),new Hi({}))}};var qi=class{constructor(){this.stepPerRender=Math.random()/200;this.tilesetRenderer=new nt;this.backgroundX=0;this.backgroundY=0;this.backgroundWaveStep=0}render(t){this.backgroundX+=.4,this.backgroundY+=Math.sin(this.backgroundWaveStep)*.4,this.backgroundWaveStep+=this.stepPerRender,this.tilesetRenderer.renderTitleTileset({...t,translateX:this.backgroundX,translateY:this.backgroundY})}};var ec=Math.PI*2;function Ga(n,t){return Math.random()*(t-n+1)+n}var Xa=[ms].flat(),Kn=new Set;function Ka(n,t,e,i,r,o,s){function a(u,c){let p=(u+.5)*ec/c;return[Math.sin(p),Math.cos(p)]}function l(u,c,p){return[u[0]*(1-p)+c[0]*p,u[1]*(1-p)+c[1]*p]}n.translate(t,e),n.scale(i,i),n.rotate(r*Math.PI/180),n.beginPath();let h=new Array(s);for(let u=0;u<s;u++)h[u]=a(u,s);for(let u=0;u<s;u++){let c=h[(u+0)%s],p=h[(u+1)%s],d=h[(u+2)%s],f=l(p,c,o/200),m=l(p,d,o/200);n.lineTo(f[0],f[1]),n.quadraticCurveTo(p[0],p[1],m[0],m[1])}n.closePath()}function tc(n,t){return n.flatMap((e,i)=>i?[t(),e]:[e])}var Ve=class extends yt{constructor(e){super(e);this.wavedBackgroundRendererBiome=new qi;this.waveRoomSelfId=-1;this.biome=0;this.CLIENTBOUND_HANDLERS={1:e=>{this.waveRoomSelfId=e.readUInt32()},3:e=>{let i=e.readUInt8(),r=new Array(i);for(let o=0;o<i;o++){let s=e.readUInt32(),a=e.readString()||"Unnamed",l=e.readUInt8();r[o]={id:s,name:a,readyState:l}}this.waveRoomPlayerInformations=r,this.waveRoomCode=e.readString(),this.waveRoomState=e.readUInt8(),this.waveRoomVisible=e.readUInt8(),this.biome=e.readUInt8()},5:e=>{this.squadMenuContainer.setVisible(!1,null,!0,0,{defaultDurationOverride:100}),Ce.switchUI("game");let i=e.readUInt8();Ce.previousCtx&&(Ce.previousCtx.biome=i),Ce.currentCtx&&(Ce.currentCtx.biome=i)},4:e=>{this.resetWaveState(),this.statusTextRef="Squad not found"}};document.onmouseout=this.mouseup,this.lastBackgroundEntitySpawn=Date.now(),this.statusTextRef="Loading...",setTimeout(()=>{this.connectingText.setVisible(!0,null,!1),setTimeout(()=>{this.connectingText.setVisible(!1,null,!0,0),setTimeout(()=>{this.loggingInText.setVisible(!0,null,!0,0),setTimeout(()=>{this.loggingInText.setVisible(!1,null,!0,0),setTimeout(()=>{this.onLoadedComponents.forEach(i=>{i.setVisible(!0,null,!0,0)})},250)},800)},25)},1500)},1)}onInitialize(){this.resetWaveState();{this.addComponents(new Yi({x:13+.5,y:259,invertYCoordinate:!0}));{let i=new(Oe(_,"Link your Discord account to save your progress!",10,"left"))({x:172,y:6,w:162,h:21,invertXCoordinate:!0},2,2,1,[new pe({x:3,y:0,w:21,h:21},Xn,.7),new A({x:7,y:4},"Sign in with Discord",13)],()=>{window.open("unko").document.write("\u307E\u3060\u5B9F\u88C5\u3055\u308C\u3066\u306A\u3044\u308F\u30DC\u30B1\u30FC")},"#5865f2",!0);this.addComponent(i)}}{let i=this.connectingText=new(ct(A,"up"))({x:-100,y:-25,alignFromCenterX:!0,alignFromCenterY:!0},"Connecting...",32),r=this.loggingInText=new(ct(A,"down"))({x:-(200/2),y:-(40/2)-5,alignFromCenterX:!0,alignFromCenterY:!0},"Logging in...",32);this.connectingText.setVisible(!1,null,!1),this.loggingInText.setVisible(!1,null,!1),r.addCollidableComponents(this.connectingText),i.addCollidableComponents(this.loggingInText),this.addComponent(this.connectingText),this.addComponent(this.loggingInText)}let e=new(ct(A))({x:-(250/2),y:-(80/2)-40,alignFromCenterX:!0,alignFromCenterY:!0},"floooo.io",54);e.addCollidableComponents(this.connectingText,this.loggingInText);{this.onLoadedComponents=[];let i=new(ct(A))({x:-108,y:-(50/2)-10,alignFromCenterX:!0,alignFromCenterY:!0},"This pretty little flower is called...",13),r=new(ct(at))({x:-(100/2)-95,y:-(50/2)+3,w:220,h:22,alignFromCenterX:!0,alignFromCenterY:!0},{canvas:this.canvas,value:"",fontSize:15,fontFamily:"Ubuntu",fontColor:"#212121",fontWeight:"bold",placeHolder:"",placeHolderDisplayUnfocusedState:!1,borderColor:"#000000",borderRadius:2,borderWidth:2.5,maxlength:80,padding:1,onkeyup(d,f){let m=f.value;B.packetServerbound.sendWaveRoomChangeName(m)}}),o=!1,s=new(ct(_))({x:-(100/2)+140,y:-(50/2)+4,w:76,h:21,alignFromCenterX:!0,alignFromCenterY:!0},4,3,1,[new A({y:2},"Ready",16),new wt({w:40,h:40},d=>{d.fillStyle="black",d.globalAlpha=de,Ka(d,7,s.h/2-3,10,90,40,3),d.fill()})],()=>{o=!o,this.squadMenuContainer.visible===!1?(B.packetServerbound.sendWaveRoomFindPublic(this.biome),this.squadMenuContainer.setVisible(!0,s,!0,0,{defaultDurationOverride:100}),this.statusTextRef="Creating...",B.packetServerbound.sendWaveRoomChangeReady(1)):B.packetServerbound.sendWaveRoomChangeReady(o?1:0)},"#1dd129",!0),a=new _({x:-(100/2)+140+13,y:-(50/2)+20+17,w:63,h:18,alignFromCenterX:!0,alignFromCenterY:!0},4,3,1,[new A({y:2},"Squad",13),new wt({w:40,h:40},d=>{d.fillStyle="black",d.globalAlpha=de,Ka(d,5,a.h/2-3,9,90,40,4),d.fill()})],()=>{B.packetServerbound.sendWaveRoomCreate(this.biome),this.squadMenuContainer.setVisible(!0,a,!0,0,{defaultDurationOverride:100}),this.statusTextRef="Creating...",B.packetServerbound.sendWaveRoomChangeVisible(1)},"#5a9fdb",!0),l=(d,f,m)=>new _({w:42,h:11},3,3,1,[new A({},d,10)],m,f,!0),h=new Ee({x:-144,y:-(50/2)+20+15,alignFromCenterX:!0,alignFromCenterY:!0}).addChildren(...tc([l("Garden","#2ba35b",()=>{this.biome=0}),l("Desert","#ccba73",()=>{this.biome=1}),l("Ocean","#6089b6",()=>{this.biome=2})],()=>new k(5,0))),u=d=>new Di({w:74.45,h:120},()=>this.waveRoomPlayerInformations[d]?.id,()=>this.waveRoomPlayerInformations[d]?.name,()=>this.waveRoomPlayerInformations[d]?.readyState,()=>this.waveRoomPlayerInformations[d]==null),c,p;this.squadMenuContainer=new le({x:-170,y:-100,alignFromCenterX:!0,alignFromCenterY:!0},!1,"#5aa0db",1,4).addChildren(this.statusText=new A({x:162,y:110},()=>this.statusTextRef,14),this.playerProfileContainer=new Ee({x:9,y:50}).addChildren(u(0),new k(5.5,0),u(1),new k(5.5,0),u(2),new k(5.5,0),u(3)),p=new Te({x:317,y:1+.5},10,()=>{this.squadMenuContainer.setVisible(!1,p,!0,0,{defaultDurationOverride:100}),o=!1,this.resetWaveState(),this.statusTextRef="Loading...",B.packetServerbound.sendWaveRoomLeave()}),new j(15,15,318,196),this.publicToggle=new At({x:11,y:24,w:15,h:15},d=>B.packetServerbound.sendWaveRoomChangeVisible(d?0:1)),new A({x:26,y:26},"Public",10),new A(()=>({x:75,y:31,w:0,h:0}),()=>this.waveRoomVisible===1?"Private squad":this.waveRoomVisible===0?"Waiting for players...":"",8,()=>this.waveRoomVisible===1?"#f0666b":"#ffffff","left"),c=new at({x:187,y:183,w:75,h:14},{canvas:this.canvas,value:"",fontSize:10,fontFamily:"Ubuntu",fontColor:"#212121",fontWeight:"bold",placeHolder:"",placeHolderDisplayUnfocusedState:!1,borderColor:"#000000",borderRadius:2,borderWidth:2,maxlength:20,padding:1}),new _({x:274,y:184,w:46,h:13},2,2.4,1,[new A({x:7,y:1},"Join",10)],()=>B.packetServerbound.sendWaveRoomJoin(c.value),"#1dd129",()=>_a(c.value)),new _({x:208,y:26,w:62,h:12},2,2.4,1,[new A({x:3,y:1},"Find Public",9)],()=>B.packetServerbound.sendWaveRoomFindPublic(this.biome),"#5aa0db",!0),new _({x:280,y:26,w:40,h:12},2,2.4,1,[new A({x:5,y:1},"New",9)],()=>B.packetServerbound.sendWaveRoomCreate(this.biome),"#5aa0db",!0),this.codeText=(()=>{let d="Copy",m=d,g=null,y=new(Ni(A,[new j(1,1,0,0),new A({x:1,y:3},()=>m,9),new j(1,1,0,15)],2,"top",2,!1))({x:10,y:187},()=>"Code: "+(this.waveRoomCode||""),9,"#ffffff","left",null,!0,()=>this.waveRoomCode||""),C=()=>{g&&clearTimeout(g),g=setTimeout(()=>{m=d,g=null},1500)};return y.addListener("onCopySucceed",()=>{m="Copied!",C()}),y.addListener("onCopyFailed",()=>{m="Failed...",C()}),y})(),new A({x:140,y:3},"Squad",14)),this.onLoadedComponents.push(i),this.onLoadedComponents.push(r),this.onLoadedComponents.push(s),this.onLoadedComponents.push(a),this.onLoadedComponents.push(h),i.setVisible(!1,null,!1),r.setVisible(!1,null,!1),s.setVisible(!1,null,!1),a.setVisible(!1,null,!1),h.setVisible(!1,null,!1),this.squadMenuContainer.setVisible(!1,null,!1),this.addComponents(i,r,s,a,h,this.squadMenuContainer),i.addCollidableComponents(this.squadMenuContainer,r),e.addCollidableComponents(this.squadMenuContainer,i),r.addCollidableComponents(this.squadMenuContainer),s.addCollidableComponents(this.squadMenuContainer),this.toggleShowStatusText(!0)}this.addComponent(e)}render(){let e=this.canvas,i=e.getContext("2d"),r=this.canvas.width/P,o=this.canvas.height/P;if(this.wavedBackgroundRendererBiome.render({canvas:e,tileset:Xt.get(this.biome),tileSize:350}),Kn.forEach(a=>{a.x>r+25&&Kn.delete(a)}),Date.now()-this.lastBackgroundEntitySpawn>250){let a=Xa[Math.floor(Math.random()*Xa.length)],l=new J(-1,1,Ga(-100,this.canvas.height/P+100),1,1,1,a,0,!1,!1);Qe(a)?l.nSize=l.size=Ga(.7,1.8)*5:l.nSize=l.size=Math.random()*30+25,l.x=-l.size*2,l.moveSpeed=(Math.random()*16+16)*l.nSize*.02,l.angleSpeed=Math.random()*.1+.2,Kn.add(l),this.lastBackgroundEntitySpawn=Date.now()}let s=Math.min(100,W)/60;Array.from(Kn.values()).toSorted((a,l)=>a.size+l.size).forEach(a=>{qe({ctx:i,entity:a,isSpecimen:!0}),a.x+=a.moveSpeed*s,a.y+=Math.sin(a.angle*.2)*1.5*s,a.angle+=a.angleSpeed*s,a.moveCounter+=W*.002}),this.waveRoomVisible!==this.prevWaveRoomVisible&&this.publicToggle.setToggle(this.waveRoomVisible===0),this.prevWaveRoomVisible=this.waveRoomVisible,this.waveRoomPlayerInformations.length?this.toggleShowStatusText(!1):this.toggleShowStatusText(!0),this.renderComponents()}destroy(){super.destroy(),this.wavedBackgroundRendererBiome=null}onContextChange(){Mt.zoom=1,document.onmouseout=null}resetWaveState(){this.waveRoomPlayerInformations=[],this.waveRoomCode=null,this.waveRoomVisible=1,this.waveRoomState=0}toggleShowStatusText(e){this.statusText.visible!==e&&this.statusText.setVisible(e,null,!1),this.playerProfileContainer.visible!==!e&&this.playerProfileContainer.setVisible(!e,null,!1),this.codeText.visible!==!e&&this.codeText.setVisible(!e,null,!1)}};var ja=Math.PI*2,Gi=class n{constructor(t){this.canvas=t;this.TRANSITION_CONFIGS={title:{initialRadius:t=>Math.max(t.height/P/2+100,t.width/P/2+100),radiusChange:t=>t-(.3+t/40),isComplete:(t,e)=>e<0},game:{initialRadius:()=>0,radiusChange:t=>t+(.2+t/35),isComplete:(t,e)=>e>Math.max(t.height/P/2+100,t.width/P/2+100)}};this.ctx=t.getContext("2d"),this.radius=-1}static{this.STROKE_WIDTH=5}static{this.STROKE_COLOR="#000000"}start(t){let e=this.TRANSITION_CONFIGS[t];this.radius=e.initialRadius(this.canvas)}update(t){let e=this.TRANSITION_CONFIGS[t];return this.radius=e.radiusChange(this.radius),e.isComplete(this.canvas,this.radius)}draw(t,e){let[i,r]=t instanceof Ve?[t,e]:[e,t];i?.render(),this.ctx.save(),this.clipCircle(),r?.render(),this.ctx.restore(),this.drawTransitionBorder()}clipCircle(){let t=this.canvas.width/P,e=this.canvas.height/P;this.ctx.beginPath(),this.ctx.arc(t/2,e/2,this.radius,0,ja),this.ctx.clip("evenodd")}drawTransitionBorder(){let t=this.canvas.width/P,e=this.canvas.height/P;this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t/2,e/2,this.radius,0,ja),this.ctx.lineWidth=n.STROKE_WIDTH,this.ctx.strokeStyle=n.STROKE_COLOR,this.ctx.stroke(),this.ctx.restore()}};var Xi=class{constructor(t){this.canvas=t;this.currentCtx=new Ve(t),this.previousCtx=null,this.transition=new Gi(t),this.isTransitioning=!1}cleanup(){this.previousCtx?.destroy(),this.previousCtx?.cleanupComponentHierarchy(),this.canvas.style.cursor="default",this.isTransitioning=!1}switchUI(t){this.isTransitioning||(this.previousCtx=this.currentCtx,this.previousCtx.onContextChange(),this.previousCtx?.removeEventListeners(),this.canvas.style.cursor="default",this.currentCtx=this.createUI(t),this.isTransitioning=!0,this.transition.start(t))}createUI(t){switch(t){case"title":return new Ve(this.canvas);case"game":return new bt(this.canvas)}}update(){if(!this.isTransitioning){this.currentCtx?.render();return}this.transition.draw(this.currentCtx,this.previousCtx);let t=this.currentCtx instanceof Ve?"title":"game";this.transition.update(t)&&this.cleanup()}};var Ki=class{constructor(t){this.canvas=t;this._zoom=new wi({easingType:"easeOutExpo",duration:500,initValue:1})}set zoom(t){this._zoom.setValue(t)}get zoom(){return this._zoom.getInterpolatedValue()}};function ji(n){return(n&255)<<24|0|(n&65280)<<8|n>>8&65280|n>>24&255}var jn=new ArrayBuffer(8),$a=new Uint8Array(jn),ic=new Uint32Array(jn),Qa=new Float32Array(jn),nc=new Float64Array(jn),rc=new TextDecoder,$i=class{constructor(t){this.set(t)}set(t){return this.at=0,this.buffer=new Uint8Array(t),this}isEOF(){return this.at>=this.buffer.byteLength}readBytes(t){let e=this.buffer.slice(this.at,this.at+t);return this.at+=t,e}readUInt8(){return this.buffer[this.at++]}readInt8(){let t=this.readUInt8();return t>>0^0-(t&1)}readUInt16(){let t=0;return(t|=this.readUInt8()<<0)|this.readUInt8()<<8}readInt16(){let t=this.readUInt16();return t>>0^0-(t&1)}readUInt24(){let t=0;return(t=(t|=this.readUInt8()<<0)|this.readUInt8()<<8)|this.readUInt8()<<16}readInt24(){let t=this.readUInt24();return t>>0^0-(t&1)}readUInt32(){let t=0;return(t=(t=(t|=this.readUInt8()<<0)|this.readUInt8()<<8)|this.readUInt8()<<16)|this.readUInt8()<<24}readInt32(){let t=this.readUInt32();return t>>0^0-(t&1)}readFloat32(){return $a.set(this.buffer.subarray(this.at,this.at+=4)),Qa[0]}readFloat64(){return $a.set(this.buffer.subarray(this.at,this.at+=8)),nc[0]}readVarUInt32(){return Number(this.readVarUInt64())}readVarInt32(){return Number(this.readVarInt64())}readVarUInt64(){let t=0n;for(let e=0;e<64;e+=7){let i=BigInt(this.readUInt8());if(t|=(0x7fn&i)<<BigInt(e),(0x80n&i)===0x0n)break}return t}readVarInt64(){let t=this.readVarUInt64();return 0x1n&t?t=-(t+0x1n)/0x2n:t/=0x2n,t}readVarFloat32(){return ic[0]=ji(this.readVarInt32()),Qa[0]}readBoolean(){return!!this.readUInt8()}readString(){let t=this.at,e=0;for(;;){let r=t+e;if(r>=this.buffer.byteLength)throw new Error("Invalid string: Out of range");if(this.buffer[r]===0)break;e++}let i=this.readBytes(e);return this.readUInt8(),rc.decode(i)}};var Qi=class{constructor(t,e={}){this.clientWebSocket=t;this.adheredClientboundHandlers=e}read(t){let e=new $i(t),i=e.readUInt8(),r=this.computeAdheredClientboundHandlers(this.adheredClientboundHandlers);if(r.hasOwnProperty(i)){r[i](e);return}switch(i){case 7:{this.readPacketConnectionKick(e);break}}}computeAdheredClientboundHandlers(t){return t instanceof Function?t():t}readPacketConnectionKick(t){let e=t.readUInt8();switch(this.clientWebSocket.destroy(),e){case 0:{setTimeout(()=>{location.reload()},500);break}}}};var $n=new ArrayBuffer(8),Za=new Uint8Array($n),oc=new Uint32Array($n),Ja=new Float32Array($n),sc=new Float64Array($n),ac=new TextEncoder,me=class{constructor(){this._buffer=new Array}set buffer(t){this._buffer=Array.from(t)}get buffer(){return new Uint8Array(this._buffer)}writeBytes(t){return t.forEach(e=>this.writeUInt8(e)),this}writeUInt8(t){return this._buffer.push(t),this}writeInt8(t){return t>=0?this.writeUInt8(t):this.writeUInt8(255+t+1),this}writeUInt16(t){return this.writeUInt8((t&255)>>>0),this.writeUInt8((t&65280)>>>8),this}writeInt16(t){return t>=0?this.writeUInt16(t):this.writeUInt16(65535+t+1),this}writeUInt24(t){return this.writeUInt8((t&255)>>>0),this.writeUInt8((t&65280)>>>8),this.writeUInt8((t&16711680)>>>16),this}writeInt24(t){return t>=0?this.writeUInt24(t):this.writeUInt24(16777215+t+1),this}writeUInt32(t){return this.writeUInt8((t&255)>>>0),this.writeUInt8((t&65280)>>>8),this.writeUInt8((t&16711680)>>>16),this.writeUInt8((t&4278190080)>>>24),this}writeInt32(t){return t>=0?this.writeUInt32(t):this.writeUInt32(4294967295+t+1),this}writeFloat32(t){Ja[0]=t;let e=Za.slice(0,4);return this._buffer=this._buffer.concat(Array.from(e)),this}writeFloat64(t){sc[0]=t;let e=Za.slice(0,8);return this._buffer=this._buffer.concat(Array.from(e)),this}writeVarUInt32(t){return this.writeVarUInt64(BigInt(t)),this}writeVarInt32(t){return this.writeVarInt64(BigInt(t)),this}writeVarUInt64(t){do{let e=0x7fn&t;0x0n<(t>>=0x7n)&&(e|=0x80n),this.writeUInt8(Number(e))}while(0x0n<t);return this}writeVarInt64(t){let e=0x2n*t;return t<0&&(e=-(0x2n*t+0x1n)),this.writeVarUInt64(e),this}writeVarFloat32(t){return Ja[0]=t,this.writeVarInt32(ji(oc[0])),this}writeBoolean(t){return this.writeUInt8(Number(t)),this}writeString(t){if(t.length>0){let e=ac.encode(t);this.writeBytes(e)}return this.writeUInt8(0),this}};var So=Math.PI*2;function lc(n){return n%=So,n<0&&(n+=So),Math.round(n/So*255)}var Zi=class{constructor(t){this.clientWebSocket=t}send(t){if(this.clientWebSocket.socket?.readyState!==WebSocket.OPEN)throw new Error("Cannot send a buffer");this.clientWebSocket.socket.send(t)}sendWaveChangeMove(t,e){let i=new me;i.writeUInt8(0);let r=lc(t);i.writeUInt8(r),i.writeUInt8(Math.round(e*255)),this.send(i.buffer)}sendWaveChangeMood(t){let e=new me;e.writeUInt8(1),e.writeUInt8(t),this.send(e.buffer)}sendWaveSwapPetal(t){let e=new me;e.writeUInt8(2),e.writeUInt8(t),this.send(e.buffer)}sendWaveChat(t){let e=new me;e.writeUInt8(3),e.writeString(t),this.send(e.buffer)}sendWaveLeave(){let t=new me;t.writeUInt8(11),this.send(t.buffer)}sendWaveRoomCreate(t){let e=new me;e.writeUInt8(4),e.writeUInt8(t),this.send(e.buffer)}sendWaveRoomJoin(t){let e=new me;e.writeUInt8(5),e.writeString(t),this.send(e.buffer)}sendWaveRoomFindPublic(t){let e=new me;e.writeUInt8(6),e.writeUInt8(t),this.send(e.buffer)}sendWaveRoomChangeReady(t){let e=new me;e.writeUInt8(7),e.writeUInt8(t),this.send(e.buffer)}sendWaveRoomChangeVisible(t){let e=new me;e.writeUInt8(8),e.writeUInt8(t),this.send(e.buffer)}sendWaveRoomChangeName(t){let e=new me;e.writeUInt8(9),e.writeString(t),this.send(e.buffer)}sendWaveRoomLeave(){let t=new me;t.writeUInt8(10),this.send(t.buffer)}};var Ji=class{constructor(t={}){this.socket=null,this.packetServerbound=new Zi(this),this.packetClientbound=new Qi(this,t),this.hasBeenDestroyed=!1,this.clear()}clear(){}connect(){this.socket=new WebSocket(location.protocol.replace("http","ws")+"//"+location.host+"/ws"),this.socket.binaryType="arraybuffer",this.socket.addEventListener("open",()=>{this.onConnect()}),this.socket.addEventListener("close",()=>{this.clear(),this.hasBeenDestroyed||setTimeout(()=>{this.connect()},500)}),this.socket.addEventListener("message",({data:t})=>{t instanceof ArrayBuffer&&(t=new Uint8Array(t),this.packetClientbound.read(t))})}destroy(){this.hasBeenDestroyed=!0,this.socket.close()}onConnect(){}};var Qn=Date.now(),W=0,el=Qn,Ce,B,fe=1,Mt,tl=async()=>{for(let i in Co){let r=parseInt(i);Xt.set(r,await nt.prepareTileset(r))}document.body.removeChild(document.querySelector("#status-container"));let n=document.querySelector("#canvas"),t=n.getContext("2d",{alpha:!1});Ce=new Xi(n),B=new Ji(()=>Ce.currentCtx.CLIENTBOUND_HANDLERS),Mt=new Ki(n),B.connect(),n.addEventListener("contextmenu",i=>{i.preventDefault()}),addEventListener("keydown",i=>{(i.ctrlKey||i.metaKey)&&(i.key==="+"||i.key==="-"||i.key===";")&&i.preventDefault(),(i.keyCode==116||i.ctrlKey&&i.keyCode==82)&&i.preventDefault()},!1),document.body.addEventListener("wheel",i=>{(i.ctrlKey||i.metaKey)&&i.preventDefault()},{passive:!1});function e(i){return i<.0125&&(i=.0125),i>1&&(i=1),i}n.addEventListener("wheel",i=>{let r=i.deltaY*-5e-4*(Mt.zoom*4),o=Mt.zoom+r;Mt.zoom=e(o)}),function i(){Qn=Date.now(),W=Qn-el,el=Qn,fe=Mt.zoom,t.save(),t.scale(P,P),Ce.update(),t.restore(),requestAnimationFrame(i)}()};addEventListener("contextmenu",n=>n.preventDefault());addEventListener("beforeunload",n=>n.preventDefault());document.readyState==="loading"?addEventListener("DOMContentLoaded",tl):tl();})();
